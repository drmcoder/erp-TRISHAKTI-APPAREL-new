import{j as e}from"./query-vendor.BbCCZTU0.js";import{r as l,c as I}from"./react-vendor.BcnQP8kQ.js";import{a as N,C as o,h as L,B as m,b as w}from"./index.BnZjV7b3.js";import{L as S}from"./LoadingSpinner.-iQp5F13.js";import{E as z,F as H}from"./empty-state.CKTdz-Ar.js";import{e as U,f as q,g as G,h as Y}from"./use-work-assignments.HpLChT7p.js";import{A as _}from"./index.BzbuG87M.js";import{F as T}from"./ClockIcon.DbOxfhcH.js";import{F as J}from"./CurrencyRupeeIcon.CCku5vMm.js";import{F as K}from"./ChartBarIcon.BgzBpEol.js";import{F as B}from"./PlayIcon.qCwfGLYk.js";import{F as Q}from"./UserIcon.x-aGQUUd.js";import"./ui-vendor.B7YYMSVe.js";import"./utils-vendor.B0NEtgzl.js";function V({title:d,titleId:u,...y},t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":u},y),d?l.createElement("title",{id:u},d):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const X=l.forwardRef(V),fe=({operatorId:d,operatorName:u,operatorSkills:y})=>{const[t,x]=l.useState(null),[F,P]=l.useState(new Date),[Z,ee]=l.useState(null),[A,j]=l.useState(!1),[f,E]=l.useState("tea"),{data:b,isLoading:C,refetch:$}=U(d),g=q(),D=G(),M=Y(),i=b?.success?b.data?.items||[]:[];l.useEffect(()=>{const s=setInterval(()=>{P(new Date),t&&!t.isOnBreak&&x(a=>a?{...a,currentDuration:Math.floor((Date.now()-a.startTime.getTime())/1e3)}:null)},1e3);return()=>clearInterval(s)},[t]);const h=I.useMemo(()=>{const s=new Date;s.setHours(0,0,0,0);const a=i.filter(r=>new Date(r.assignedDate)>=s),n=a.filter(r=>r.status==="completed"),p=a.filter(r=>["assigned","started"].includes(r.status));return{todayHours:n.reduce((r,c)=>r+(c.actualDuration||0),0)/60,todayEarnings:n.reduce((r,c)=>r+c.estimatedEarnings,0),todayPieces:n.reduce((r,c)=>r+(c.completedPieces||0),0),avgEfficiency:i.length>0?i.reduce((r,c)=>r+c.efficiency,0)/i.length:0,completedAssignments:i.filter(r=>r.status==="completed").length,activeAssignments:p.length}},[i]),k=async s=>{try{await g.mutateAsync({assignmentId:s.id,operatorId:d}),x({assignmentId:s.id,startTime:new Date,currentDuration:0,targetPieces:s.targetPieces||0,completedPieces:s.completedPieces||0,breaksTaken:0,totalBreakTime:0,currentEfficiency:s.efficiency,isOnBreak:!1})}catch(a){console.error("Failed to start work session:",a)}},R=async()=>{if(t)try{t.isOnBreak?(await g.mutateAsync({assignmentId:t.assignmentId,operatorId:d}),x(s=>s?{...s,isOnBreak:!1,breakStartTime:void 0,totalBreakTime:s.totalBreakTime+(s.breakStartTime?Math.floor((Date.now()-s.breakStartTime.getTime())/1e3):0)}:null)):j(!0)}catch(s){console.error("Failed to pause/resume work:",s)}},O=async()=>{if(t)try{await D.mutateAsync({assignmentId:t.assignmentId,breakType:f,reason:`${f.charAt(0).toUpperCase()+f.slice(1)} break`}),x(s=>s?{...s,isOnBreak:!0,breakStartTime:new Date,breaksTaken:s.breaksTaken+1}:null),j(!1)}catch(s){console.error("Failed to start break:",s)}},W=async()=>{if(t)try{await M.mutateAsync({assignmentId:t.assignmentId,completedPieces:t.completedPieces,actualDuration:t.currentDuration,operatorNotes:"Completed via dashboard"}),x(null),$()}catch(s){console.error("Failed to complete work:",s)}},v=s=>{const a=Math.floor(s/3600),n=Math.floor(s%3600/60),p=s%60;return a>0?`${a}:${n.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${n}:${p.toString().padStart(2,"0")}`};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Work Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",u]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(N,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{children:F.toLocaleTimeString()})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.todayHours.toFixed(1),"h"]})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Earnings Today"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₹",h.todayEarnings.toLocaleString()]})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(K,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pieces Today"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:h.todayPieces})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(L,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Efficiency"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[Math.round(h.avgEfficiency*100),"%"]})]})]})})]}),t&&e.jsxs(o,{className:"p-6 border-2 border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${t.isOnBreak?"bg-yellow-500":"bg-green-500"}`}),e.jsx("span",{children:t.isOnBreak?"On Break":"Active Work Session"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{onClick:R,variant:t.isOnBreak?"default":"outline",size:"sm",className:"flex items-center space-x-1",children:t.isOnBreak?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Resume"})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Break"})]})}),e.jsxs(m,{onClick:W,size:"sm",className:"flex items-center space-x-1 bg-green-600 hover:bg-green-700",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"Complete"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Duration"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:v(t.currentDuration)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[t.completedPieces,"/",t.targetPieces]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Efficiency"}),e.jsxs("p",{className:`text-xl font-bold ${t.currentEfficiency>.8?"text-green-600":t.currentEfficiency>.6?"text-yellow-600":"text-red-600"}`,children:[Math.round(t.currentEfficiency*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Breaks"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[t.breaksTaken," (",v(t.totalBreakTime),")"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Work Progress"}),e.jsxs("span",{className:"text-gray-900",children:[Math.round(t.completedPieces/t.targetPieces*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-blue-500 to-green-500",style:{width:`${Math.min(100,t.completedPieces/t.targetPieces*100)}%`}})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"My Assignments"}),e.jsxs(N,{variant:"primary",children:[h.activeAssignments," active"]})]}),i.length===0?e.jsx(z,{icon:Q,title:"No assignments yet",description:"You don't have any work assignments. Check back later or request available work."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(s=>{const a=_[s.status],n=t?.assignmentId===s.id;return e.jsxs(o,{className:`p-4 transition-all duration-200 ${n?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:s.bundleNumber}),e.jsxs(N,{variant:a?.color,className:"flex items-center space-x-1",children:[e.jsx("span",{children:a?.icon}),e.jsx("span",{className:"text-xs",children:a?.label})]})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.operation})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"text-gray-600",children:s.machineType})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[s.progress.toFixed(1),"% complete"]}),e.jsxs("span",{className:"text-green-600 font-medium",children:["₹",s.estimatedEarnings.toLocaleString()]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.progress===100?"bg-green-500":s.progress>50?"bg-blue-500":"bg-yellow-500"}`,style:{width:`${s.progress}%`}})})}),s.status==="assigned"&&!t&&e.jsx(m,{onClick:()=>k(s),disabled:g.isPending,className:"w-full flex items-center space-x-2",children:g.isPending?e.jsx(S,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Start Work"})]})}),s.status==="started"&&!n&&e.jsx(m,{onClick:()=>k(s),variant:"outline",className:"w-full",children:"Resume Work"}),s.status==="completed"&&e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-600",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Completed"})]})]},s.id)})})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(o,{className:"max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Take a Break"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Type"}),e.jsxs("select",{value:f,onChange:s=>E(s.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"tea",children:"Tea Break (15 min)"}),e.jsx("option",{value:"lunch",children:"Lunch Break (60 min)"}),e.jsx("option",{value:"personal",children:"Personal Break (10 min)"}),e.jsx("option",{value:"maintenance",children:"Machine Maintenance"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(m,{variant:"ghost",onClick:()=>j(!1),className:"flex-1",children:"Cancel"}),e.jsx(m,{onClick:O,className:"flex-1",children:"Start Break"})]})]})})]})};export{fe as OperatorWorkDashboard};
