const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/work-assignment-service._pWjxpTL.js","assets/index.CLAiwwTT.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.EZF4ucWh.js","assets/firebase-vendor.D8xw0AXf.js","assets/utils-vendor.B0NEtgzl.js","assets/index.DXujQHlj.css","assets/bundle-service.CrAqiZci.js","assets/enhanced-bundle-service.Cmy7jG_Y.js"])))=>i.map(i=>d[i]);
import{_ as A,B as g,C as p,F as R,a as _}from"./index.CLAiwwTT.js";import{j as e}from"./query-vendor.DpsghfSz.js";import{r as i}from"./react-vendor.CfKEcsXX.js";import{L as I}from"./LoadingSpinner.1kukr6Vo.js";import"./firebase-vendor.D8xw0AXf.js";import{F as $}from"./MagnifyingGlassIcon.BY4e_13K.js";import{F as G}from"./LightBulbIcon.CK1_Ki40.js";import{F as J}from"./HashtagIcon.BDWlCnOX.js";import{F as K}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as X}from"./ClockIcon.B0z2Gpg3.js";import{F as B}from"./UserIcon.BzFG2rMW.js";import"./ui-vendor.EZF4ucWh.js";import"./utils-vendor.B0NEtgzl.js";function Q({title:h,titleId:o,...f},x){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":o},f),h?i.createElement("title",{id:o},h):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const Y=i.forwardRef(Q);function ee({title:h,titleId:o,...f},x){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":o},f),h?i.createElement("title",{id:o},h):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z"}))}const se=i.forwardRef(ee);function ae({title:h,titleId:o,...f},x){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":o},f),h?i.createElement("title",{id:o},h):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const te=i.forwardRef(ae),be=({userRole:h})=>{const[o,f]=i.useState([]),[x,j]=i.useState([]),[D,M]=i.useState(!0),[E,L]=i.useState("grid"),[N,O]=i.useState(""),[m,C]=i.useState({priority:"all",status:"all",machineType:"all",articleNumber:"all"}),[F,V]=i.useState("priority"),[y,w]=i.useState([]),[re,ie]=i.useState(null),[v,T]=i.useState("individual"),[le,W]=i.useState(!1),[P,z]=i.useState({});i.useEffect(()=>{H()},[]);const H=async()=>{M(!0);try{const{workAssignmentService:s}=await A(async()=>{const{workAssignmentService:a}=await import("./work-assignment-service._pWjxpTL.js");return{workAssignmentService:a}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{bundleService:t}=await A(async()=>{const{bundleService:a}=await import("./bundle-service.CrAqiZci.js");return{bundleService:a}},__vite__mapDeps([8,5,1,2,3,4,6,7])),{operatorService:l}=await A(async()=>{const{operatorService:a}=await import("./index.CLAiwwTT.js").then(r=>r.P);return{operatorService:a}},__vite__mapDeps([1,2,3,4,5,6,7])),n=await t.getBundles(),d=await l.getAllOperators();let c=[];if(n&&Array.isArray(n)&&(c=n.map(a=>({id:a.id||`bundle_${Date.now()}_${Math.random()}`,bundleNumber:a.bundleNumber||`B${String(Date.now()).slice(-4)}`,articleNumber:`ART${a.bundleNumber.slice(-3)}`,articleStyle:a.description||"Unknown Style",priority:a.priority==="medium"?"normal":a.priority||"normal",status:a.status==="planning"?"created":a.status==="in-progress"?"in_progress":a.status==="completed"?"completed":"created",sizes:["M"],colors:["White"],totalPieces:a.quantity||0,estimatedTime:a.estimatedHours*60||60,totalValue:a.totalValue||0,requiredSkills:[],dueDate:a.dueDate||new Date(Date.now()+10080*60*1e3),createdDate:a.createdAt||new Date,operations:[{id:`op_${a.id}_default`,name:"General Assembly",nameNepali:"सामान्य जम्मा",machineType:"sewing",requiredSkill:"basic_sewing",timePerPiece:3,pricePerPiece:2,status:"pending"}]}))),c.length===0&&(console.log("No bundles found in Firebase, creating sample data..."),c=[{id:"sample_bundle_1",bundleNumber:"B0001",articleNumber:"3233",articleStyle:"Adult T-Shirt",priority:"normal",status:"created",sizes:["M","L"],colors:["White"],totalPieces:50,estimatedTime:180,totalValue:250,dueDate:new Date(Date.now()+10080*60*1e3),createdDate:new Date,operations:[{id:"op_sample_1",name:"Shoulder Join",nameNepali:"काँध जोड्ने",machineType:"overlock",requiredSkill:"shoulder_join",timePerPiece:4.5,pricePerPiece:2.5,status:"pending"}]}]),f(c),d.success&&d.data){console.log("🔍 Smart Dashboard: Raw operators from Firebase:",d.data);const a=d.data.map(r=>{const S={id:r.id||"unknown",name:r.name||"Unknown Operator",machineType:r.primaryMachine||r.machineTypes?.[0]||"overlock",skillLevel:r.skillLevel||"intermediate",efficiency:r.averageEfficiency||85,currentWorkload:r.currentAssignments?.length||0,maxCapacity:r.maxConcurrentWork||3,specialties:r.machineTypes||[],status:r.isActive?r.availabilityStatus==="available"?"available":r.availabilityStatus==="working"?"busy":r.availabilityStatus==="break"?"break":"available":"offline",hourlyRate:150,todayEarnings:Math.floor(Math.random()*500)};return console.log("🔄 Smart Dashboard: Transformed operator:",S),S});console.log("✅ Smart Dashboard: Final operators:",a),j(a)}else{console.log("⚠️ Smart Dashboard: No operators found, creating sample data...");try{await(await A(()=>import("./enhanced-bundle-service.Cmy7jG_Y.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]))).default.createSampleOperators();const r=await l.getAllOperators();if(r.success&&r.data){const S=r.data.map(u=>({id:u.id||"unknown",name:u.name||"Unknown Operator",machineType:u.primaryMachine||u.machineTypes?.[0]||"overlock",skillLevel:u.skillLevel||"intermediate",efficiency:u.averageEfficiency||85,currentWorkload:u.currentAssignments?.length||0,maxCapacity:u.maxConcurrentWork||3,specialties:u.machineTypes||[],status:u.isActive?"available":"offline",hourlyRate:150,todayEarnings:Math.floor(Math.random()*500)}));j(S)}else j([])}catch(a){console.error("Failed to create sample operators:",a),j([])}}}catch(s){console.error("Failed to load work assignment data:",s),f([]),j([])}finally{M(!1)}},b=[...o.filter(s=>{const t=s.bundleNumber.toLowerCase().includes(N.toLowerCase())||s.articleNumber.includes(N)||s.articleStyle.toLowerCase().includes(N.toLowerCase()),l=m.priority==="all"||s.priority===m.priority,n=m.status==="all"||s.status===m.status,d=m.articleNumber==="all"||s.articleNumber===m.articleNumber,c=m.machineType==="all"||s.operations.some(a=>a.machineType===m.machineType);return t&&l&&n&&d&&c})].sort((s,t)=>{switch(F){case"priority":const l={urgent:4,high:3,normal:2,low:1};return l[t.priority]-l[s.priority];case"value":return t.totalValue-s.totalValue;case"bundleNumber":return s.bundleNumber.localeCompare(t.bundleNumber);default:return 0}}),k=x.filter(s=>s.status==="available"&&s.currentWorkload<s.maxCapacity),Z=s=>{w(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},q=async()=>{if(y.length===0){alert("Please select bundles to assign");return}const s={};for(const t of y){const l=o.find(n=>n.id===t);if(l)for(const n of l.operations){const d=k.filter(c=>c.machineType===n.machineType&&c.specialties.includes(n.requiredSkill)&&c.currentWorkload<c.maxCapacity);if(d.length>0){const c=d.reduce((a,r)=>r.efficiency-r.currentWorkload*10>a.efficiency-a.currentWorkload*10?r:a);s[`${t}_${n.id}`]=c.id,j(a=>a.map(r=>r.id===c.id?{...r,currentWorkload:r.currentWorkload+1}:r))}}}z(t=>({...t,...s})),w([]),alert(`✅ Smart assignment completed!
Assigned ${Object.keys(s).length} operations to operators.`)},U=s=>{switch(s){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(I,{label:"Loading smart assignment dashboard..."})}):e.jsxs("div",{className:"p-4 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:"🧠 Smart Work Assignment"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Efficiently assign ",o.length," bundles to ",x.length," operators with smart algorithms"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white p-2 rounded-lg border",children:[e.jsx(g,{variant:v==="individual"?"primary":"outline",size:"sm",onClick:()=>T("individual"),children:"👤 Individual"}),e.jsx(g,{variant:v==="bulk"?"primary":"outline",size:"sm",onClick:()=>T("bulk"),children:"📦 Bulk"}),e.jsx(g,{variant:v==="smart"?"primary":"outline",size:"sm",onClick:()=>T("smart"),children:"🧠 Smart AI"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search bundles, articles, or styles...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:N,onChange:s=>O(s.target.value)})]})}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.priority,onChange:s=>C(t=>({...t,priority:s.target.value})),children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"urgent",children:"🔴 Urgent"}),e.jsx("option",{value:"high",children:"🟠 High"}),e.jsx("option",{value:"normal",children:"🔵 Normal"}),e.jsx("option",{value:"low",children:"⚪ Low"})]}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.machineType,onChange:s=>C(t=>({...t,machineType:s.target.value})),children:[e.jsx("option",{value:"all",children:"All Machines"}),e.jsx("option",{value:"overlock",children:"Overlock"}),e.jsx("option",{value:"singleNeedle",children:"Single Needle"})]}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:F,onChange:s=>V(s.target.value),children:[e.jsx("option",{value:"priority",children:"Sort by Priority"}),e.jsx("option",{value:"value",children:"Sort by Value"}),e.jsx("option",{value:"bundleNumber",children:"Sort by Bundle #"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{variant:E==="grid"?"primary":"outline",size:"sm",onClick:()=>L("grid"),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(g,{variant:E==="list"?"primary":"outline",size:"sm",onClick:()=>L("list"),children:"📋"})]})]}),v!=="individual"&&e.jsx(p,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"h-5 w-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[y.length," bundles selected"]})]}),y.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"primary",size:"sm",onClick:q,children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Smart Assign"]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>w([]),children:"Clear Selection"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Available Bundles"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Available Operators"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b.filter(s=>s.priority==="urgent").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Urgent Priority"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",b.reduce((s,t)=>s+t.totalValue,0).toFixed(0)]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.floor(b.reduce((s,t)=>s+t.estimatedTime,0)/60),"h"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Est. Time"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:b.map(s=>e.jsxs(p,{className:`p-4 transition-all cursor-pointer hover:shadow-lg ${y.includes(s.id)?"ring-2 ring-blue-500 bg-blue-50":"hover:ring-1 hover:ring-gray-300"}`,onClick:()=>{v!=="individual"&&Z(s.id)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono text-sm text-gray-700",children:s.bundleNumber})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v!=="individual"&&e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${y.includes(s.id)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:y.includes(s.id)&&e.jsx(R,{className:"h-3 w-3 text-white"})}),e.jsx(_,{variant:"outline",className:U(s.priority),children:s.priority})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.articleStyle}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Article: ",s.articleNumber]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),s.sizes.join(", ")]}),e.jsxs("span",{children:[s.totalPieces," pcs"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"$",s.totalValue.toFixed(2)]}),e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),Math.floor(s.estimatedTime/60),"h ",Math.floor(s.estimatedTime%60),"m"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Operations:"}),s.operations.map(t=>{const l=`${s.id}_${t.id}`,n=P[l]?x.find(d=>d.id===P[l]):null;return e.jsx("div",{className:`p-2 rounded border text-xs ${n?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-gray-600",children:t.machineType})]}),e.jsx("div",{className:"text-right",children:n?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:n.name})]}):e.jsx(_,{variant:"outline",size:"sm",children:"Available"})})]})},t.id)})]}),v==="individual"&&e.jsxs(g,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>{w([s.id]),W(!0)},children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Assign to Operator"]})]},s.id))}),b.length===0&&e.jsxs(p,{className:"p-8 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No bundles match your current filters"}),e.jsx(g,{variant:"outline",onClick:()=>{O(""),C({priority:"all",status:"all",machineType:"all",articleNumber:"all"})},className:"mt-4",children:"Clear Filters"})]}),e.jsxs(p,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Available Operators (",k.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx(_,{variant:s.skillLevel==="expert"?"success":s.skillLevel==="intermediate"?"warning":"info",size:"sm",children:s.skillLevel})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Machine: ",s.machineType]}),e.jsxs("p",{children:["Efficiency: ",s.efficiency,"%"]}),e.jsxs("p",{children:["Load: ",s.currentWorkload,"/",s.maxCapacity]}),e.jsxs("p",{children:["Today: $",s.todayEarnings]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.currentWorkload/s.maxCapacity*100}%`}})})})]},s.id))})]})]})};export{be as SmartWorkAssignmentDashboard,be as default};
