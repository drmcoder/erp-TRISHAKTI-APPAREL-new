import{j as e}from"./query-vendor.NFs8Lf8Y.js";import{r as a}from"./react-vendor.BcnQP8kQ.js";import{c as m,v as x,w as u,t as h,x as T,b as D,I as O,B as z}from"./index.B__xpDQO.js";import{L as i}from"./label.Rpc_NHFh.js";import{S as b,a as S,b as P,c as w,d as k}from"./select.D3GNnznR.js";import{p as W}from"./production-lot-service.DtTp8_sT.js";import{t as o}from"./index.wyP5CHuk.js";import{P as B,k as oe,a8 as ne,Q,a5 as de,V as me,g as xe,l as ue}from"./ui-vendor.BnTQXQPs.js";import{f as he}from"./utils-vendor.B0NEtgzl.js";import"./firebase-vendor.m6WcKfT_.js";const V={single_needle:"bg-blue-100 text-blue-800",overlock:"bg-green-100 text-green-800",flatlock:"bg-purple-100 text-purple-800",buttonhole:"bg-orange-100 text-orange-800",button_attach:"bg-pink-100 text-pink-800",cutting:"bg-gray-100 text-gray-800",finishing:"bg-indigo-100 text-indigo-800",pressing:"bg-yellow-100 text-yellow-800"},$={single_needle:"सिंगल निडल",overlock:"ओभरलक",flatlock:"फ्ल्यालक",buttonhole:"बटन होल",button_attach:"बटन एट्याच",cutting:"काटने",finishing:"फिनिशिङ",pressing:"प्रेसिङ"},Ce=({operatorId:C,operatorName:H})=>{const[p,Y]=a.useState([]),[t,N]=a.useState(null),[f,U]=a.useState([]),[pe,L]=a.useState(!1),[A,F]=a.useState(!1),[l,G]=a.useState(""),[j,J]=a.useState(""),[n,K]=a.useState(""),[g,X]=a.useState(""),[d,_]=a.useState(0),[I,R]=a.useState("");a.useEffect(()=>{q(),M()},[C]);const q=async()=>{try{L(!0);const s=await W.getProductionLots({status:"in_progress"});Y(s)}catch(s){console.error("Error loading lots:",s),o.error("Failed to load production lots")}finally{L(!1)}},M=async()=>{try{const s=new Date,r=String(s.getMonth()+1).padStart(2,"0"),v=s.getFullYear(),E=(await W.getOperatorWorkEntries(C,r,v)).filter(c=>new Date(c.workDate.toDate()).toDateString()===s.toDateString());U(E)}catch(s){console.error("Error loading today entries:",s)}},Z=()=>{const s=p.find(c=>c.lotNumber===l),r=s?.processSteps.find(c=>c.id===j),v=s?.colorSizeBreakdown.find(c=>c.color===n),y=v?.sizes.find(c=>c.size===g);if(!s||!r||!v||!y){o.error("Please select all required fields");return}const E={lotNumber:l,articleNumber:s.articleNumber,articleName:s.articleName,stepId:j,operation:r.operation,operationNepali:r.operationNepali,machineType:r.machineType,color:n,size:g,assignedPieces:y.quantity-y.completedQuantity,completedPieces:0,pricePerPiece:r.pricePerPiece,workDate:new Date,status:"in_progress",startTime:new Date,qualityNotes:""};N(E),o.success(`Started work on ${r.operation} - ${n} ${g}`)},ee=s=>{if(t){if(s>t.assignedPieces){o.error(`Cannot exceed assigned pieces (${t.assignedPieces})`);return}N(r=>r?{...r,completedPieces:s}:null),_(s)}},se=async()=>{if(!t||d===0){o.error("Please complete at least 1 piece");return}try{F(!0);const s={operatorId:C,operatorName:H,lotNumber:t.lotNumber,stepId:t.stepId,operation:t.operation,machineType:t.machineType,color:t.color,size:t.size,assignedPieces:t.assignedPieces,completedPieces:d,pricePerPiece:t.pricePerPiece,workDate:new Date,status:"completed",startTime:t.startTime,endTime:new Date,qualityNotes:I};await W.createOperatorWorkEntry(s),o.success(`Saved ${d} pieces - Earned Rs. ${(d*t.pricePerPiece).toFixed(2)}`),N(null),_(0),R(""),q(),M()}catch(s){console.error("Error saving work:",s),o.error("Failed to save work entry")}finally{F(!1)}},te=()=>{t&&(N(s=>s?{...s,status:"assigned"}:null),o.info("Work paused - you can resume later"))},re=()=>p.find(r=>r.lotNumber===l)?.processSteps.filter(r=>r.status==="pending"||r.status==="in_progress")||[],ae=()=>p.find(r=>r.lotNumber===l)?.colorSizeBreakdown||[],ie=()=>p.find(r=>r.lotNumber===l)?.colorSizeBreakdown.find(r=>r.color===n)?.sizes.filter(r=>r.completedQuantity<r.quantity)||[],ce=f.reduce((s,r)=>s+r.totalPrice,0),le=f.reduce((s,r)=>s+r.completedPieces,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Today's Pieces"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:le}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed today"})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Today's Earnings"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["Rs. ",ce.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total earned today"})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsxs(u,{className:"text-sm font-medium flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Active Work"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?"1":"0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"In progress":"No active work"})]})]})]}),t?e.jsxs(m,{className:"border-green-200 bg-green-50",children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(u,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2 text-green-600"}),"Active Work"]}),e.jsxs(T,{children:[t.articleNumber," - ",t.articleName]})]}),e.jsx(D,{className:"bg-green-100 text-green-800",children:"In Progress"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"Operation"}),e.jsx("div",{className:"font-medium",children:t.operation}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.operationNepali})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"Machine"}),e.jsx(D,{className:V[t.machineType],children:$[t.machineType]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"Color/Size"}),e.jsxs("div",{className:"font-medium",children:[t.color," - ",t.size]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"Rate"}),e.jsxs("div",{className:"font-medium",children:["Rs. ",t.pricePerPiece," / piece"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pieceCount",children:"Completed Pieces"}),e.jsx(O,{id:"pieceCount",type:"number",min:"0",max:t.assignedPieces,value:d,onChange:s=>ee(parseInt(s.target.value)||0),placeholder:"Enter completed pieces"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Max: ",t.assignedPieces," pieces | Earnings: Rs. ",(d*t.pricePerPiece).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"qualityNotes",children:"Quality Notes (Optional)"}),e.jsx(O,{id:"qualityNotes",value:I,onChange:s=>R(s.target.value),placeholder:"Any quality issues or notes..."})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(z,{onClick:se,disabled:A||d===0,children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Save Work"]})}),e.jsxs(z,{variant:"outline",onClick:te,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Pause"]})]})]})]}):e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Start New Work"]}),e.jsx(T,{children:"Select a lot and operation to begin working"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Production Lot"}),e.jsxs(b,{value:l,onValueChange:G,children:[e.jsx(S,{children:e.jsx(P,{placeholder:"Select lot number"})}),e.jsx(w,{children:p.map(s=>e.jsxs(k,{value:s.lotNumber,children:[s.lotNumber," - ",s.articleNumber," (",s.totalPieces," pcs)"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Operation"}),e.jsxs(b,{value:j,onValueChange:J,disabled:!l,children:[e.jsx(S,{children:e.jsx(P,{placeholder:"Select operation"})}),e.jsx(w,{children:re().map(s=>e.jsxs(k,{value:s.id,children:[s.operation," (",s.operationNepali,") - Rs. ",s.pricePerPiece]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Color"}),e.jsxs(b,{value:n,onValueChange:K,disabled:!j,children:[e.jsx(S,{children:e.jsx(P,{placeholder:"Select color"})}),e.jsx(w,{children:ae().map(s=>e.jsxs(k,{value:s.color,children:[s.color," (",s.totalPieces," pcs)"]},s.color))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Size"}),e.jsxs(b,{value:g,onValueChange:X,disabled:!n,children:[e.jsx(S,{children:e.jsx(P,{placeholder:"Select size"})}),e.jsx(w,{children:ie().map(s=>e.jsxs(k,{value:s.size,children:[s.size," (",s.quantity-s.completedQuantity," remaining)"]},s.size))})]})]})]}),e.jsxs(z,{onClick:Z,disabled:!l||!j||!n||!g,className:"w-full",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Start Work"]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Today's Work History"]}),e.jsx(T,{children:he(new Date,"EEEE, MMMM d, yyyy")})]}),e.jsx(h,{children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{children:"No work completed today"}),e.jsx("p",{className:"text-sm",children:"Start working to see your progress here"})]}):e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:V[s.machineType],children:$[s.machineType]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.operation," - ",s.color," ",s.size]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.lotNumber," | ",s.completedPieces," pieces"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Rs. ",s.totalPrice.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rs. ",s.pricePerPiece," × ",s.completedPieces]})]})]},s.id))})})]})]})};export{Ce as OperatorPieceTracker,Ce as default};
