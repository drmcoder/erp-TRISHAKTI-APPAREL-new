const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/atomic-operations.m08lulDa.js","assets/firebase-vendor.D8xw0AXf.js","assets/index.CLAiwwTT.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.EZF4ucWh.js","assets/utils-vendor.B0NEtgzl.js","assets/index.DXujQHlj.css"])))=>i.map(i=>d[i]);
import{B as h,C as l,p as z,a as u,_ as q}from"./index.CLAiwwTT.js";import{j as e}from"./query-vendor.DpsghfSz.js";import{r as c}from"./react-vendor.CfKEcsXX.js";import{u as X}from"./useI18n.Cd33OMab.js";import{L as Y}from"./LoadingSpinner.1kukr6Vo.js";import{EnhancedBundleService as k}from"./enhanced-bundle-service.Cmy7jG_Y.js";import{F as A}from"./ClockIcon.B0z2Gpg3.js";import{F as H}from"./HandRaisedIcon.Cfns5nHo.js";import{F as G}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as R}from"./UserIcon.BzFG2rMW.js";import{F as U}from"./ArrowRightIcon.DKQtkxcN.js";import"./ui-vendor.EZF4ucWh.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const me=({userRole:V})=>{const{currentLocale:P}=X(),[g,b]=c.useState([]),[d,y]=c.useState([]),[$,w]=c.useState(!0),[r,O]=c.useState("tap"),[i,j]=c.useState(null),D=s=>P==="ne"&&s.nameNepali||s.name,[n,N]=c.useState({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}});c.useEffect(()=>{v()},[]);const v=async()=>{w(!0);try{const[s,t]=await Promise.all([k.getPendingOperations({limit:20}),k.getAvailableOperators()]);s.success&&s.data&&b(s.data),t.success&&t.data&&y(t.data)}catch(s){console.error("Failed to load data:",s)}finally{w(!1)}},C=(s,t)=>{if(r!=="drag")return;s.preventDefault();const a=s.touches[0],m=s.currentTarget.getBoundingClientRect();N({isDragging:!0,draggedOperation:t,dragSource:{x:a.clientX,y:a.clientY},touchOffset:{x:a.clientX-m.left,y:a.clientY-m.top}})},F=s=>{if(!n.isDragging||!n.draggedOperation)return;s.preventDefault();const t=s.touches[0];N(a=>({...a,dragSource:{x:t.clientX,y:t.clientY}}))},L=s=>{if(!n.isDragging||!n.draggedOperation)return;const t=s.changedTouches[0],m=document.elementFromPoint(t.clientX,t.clientY)?.closest("[data-operator-id]");if(m){const I=m.getAttribute("data-operator-id"),p=d.find(f=>f.id===I);p&&S(n.draggedOperation,p)}N({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}})},M=s=>{r==="tap"&&j(i?.id===s.id?null:s)},E=s=>{r!=="tap"||!i||(S(i,s),j(null))},S=async(s,t)=>{try{const{atomicOperationsService:a}=await q(async()=>{const{atomicOperationsService:o}=await import("./atomic-operations.m08lulDa.js");return{atomicOperationsService:o}},__vite__mapDeps([0,1,2,3,4,5,6,7])),m={id:s.id,machineType:s.machineType||s.machineRequired||s.bundleInfo.machineType||"singleNeedle",operation:s.name||s.operation,skillLevelRequired:s.skillLevel||"intermediate",status:"pending",assignedOperatorId:null,targetPieces:s.quantity||100,ratePerPiece:s.pricePerPiece||10},I={id:t.id,name:t.name,machineTypes:[t.machineType],primaryMachine:t.machineType,skillLevel:t.experience,currentStatus:t.status,currentAssignments:t.currentWorkload,maxConcurrentWork:5},p={workItemId:s.id,operatorId:t.id,supervisorId:"current-supervisor",assignmentData:{workItemId:s.id,operatorId:t.id,assignmentMethod:"drag_drop",estimatedStartTime:new Date,estimatedCompletionTime:new Date(Date.now()+7200*1e3)},timestamp:new Date},f=await a.atomicAssignWork(p);f.success?(b(o=>o.filter(x=>x.id!==s.id)),y(o=>o.map(x=>x.id===t.id?{...x,currentWorkload:x.currentWorkload+1}:x)),B(`✅ ${s.name} assigned to ${t.name}`)):T(`❌ ${f.error||`Failed to assign ${s.name} to ${t.name}`}`)}catch(a){console.error("Assignment failed:",a),T(`❌ Assignment failed: ${a instanceof Error?a.message:"Please try again."}`)}},B=s=>{console.log("Success:",s)},T=s=>{console.error("Error:",s)},W=s=>{switch(s){case"expert":return"success";case"intermediate":return"warning";case"beginner":return"info";default:return"secondary"}},_=s=>{switch(s){case"active":return"text-green-600";case"break":return"text-yellow-600";case"offline":return"text-red-600";default:return"text-gray-600"}};return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Y,{text:"Loading assignment dashboard..."})}):e.jsxs("div",{className:"p-4 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🎯 Drag & Drop Assignment"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Assign operations to operators with ease"})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-lg",children:[e.jsx(h,{variant:r==="tap"?"primary":"ghost",size:"sm",onClick:()=>O("tap"),className:"text-xs",children:"👆 Tap Mode"}),e.jsx(h,{variant:r==="drag"?"primary":"ghost",size:"sm",onClick:()=>O("drag"),className:"text-xs",children:"🤏 Drag Mode"})]})]}),e.jsx(l,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:"💡"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"How to Assign:"}),r==="tap"?e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Tap on a bundle operation below → 2. Tap on an operator → Done! ✅"}):e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Press and hold a bundle operation → 2. Drag to an operator → Release! ✅"})]})]})}),r==="tap"&&i&&e.jsx(l,{className:"p-4 bg-green-50 border-green-200 border-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Selected Operation:"}),e.jsxs("p",{className:"text-green-800",children:[D(i)," - ",i.bundleInfo.bundleNumber]})]})]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"text-green-700",children:"✕ Cancel"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"h-6 w-6 mr-2 text-blue-600"}),"Available Work (",g.length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[g.map(s=>e.jsx(l,{className:`p-4 cursor-pointer transition-all duration-200 ${i?.id===s.id?"border-green-500 border-2 bg-green-50 shadow-lg":"hover:shadow-lg hover:border-blue-300"} ${n.isDragging&&n.draggedOperation?.id===s.id?"opacity-50 transform scale-95":""}`,onTouchStart:t=>C(t,s),onTouchMove:F,onTouchEnd:L,onClick:()=>M(s),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(z,{className:"h-5 w-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:D(s)})})]}),r==="drag"&&e.jsx("div",{className:"flex items-center text-gray-400",children:e.jsx(H,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-800 font-medium",children:["📦 ",e.jsx("strong",{children:s.bundleInfo.bundleNumber})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["🏷️ Batch: ",s.bundleInfo.batchNumber||"B001"," • ",s.bundleInfo.quantity||50," pieces"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),s.smvMinutes,"min/piece"]}),e.jsxs("div",{className:"flex items-center text-blue-600 font-medium",children:["⏱️ Total: ",Math.round((s.bundleInfo.quantity||50)*s.smvMinutes/60),"h"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"$",s.pricePerPiece,"/piece"]}),e.jsxs("div",{className:"flex items-center text-green-700 font-bold",children:["💰 $",((s.bundleInfo.quantity||50)*s.pricePerPiece).toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"text-blue-800 font-medium mb-1",children:"🔍 Last Done By:"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"👷 Maya Patel"}),e.jsx("span",{className:"text-yellow-600",children:"⭐ 9.2/10"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-blue-600",children:"📅 2 days ago"}),e.jsx("span",{className:"text-green-600",children:"⚡ 94% efficiency"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(u,{variant:"outline",className:"text-xs",children:["🔧 ",s.machineType]}),e.jsx(u,{variant:s.bundleInfo.priority==="high"||s.bundleInfo.priority==="urgent"?"destructive":"secondary",className:"text-xs",children:s.bundleInfo.priority==="high"?"🔥 HIGH":s.bundleInfo.priority==="urgent"?"⚡ URGENT":s.bundleInfo.priority==="low"?"📋 LOW":"➖ NORMAL"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["📅 Due: ",s.bundleInfo.dueDate?new Date(s.bundleInfo.dueDate).toLocaleDateString():"Today"]})]})]})},s.id)),g.length===0&&e.jsxs(l,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎉"}),e.jsx("p",{className:"text-gray-600",children:"All operations have been assigned!"}),e.jsx(h,{variant:"primary",onClick:v,className:"mt-4",children:"Refresh List"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(R,{className:"h-6 w-6 mr-2 text-purple-600"}),"Available Operators (",d.filter(s=>s.status==="active").length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[d.filter(s=>s.status==="active").map(s=>e.jsxs(l,{"data-operator-id":s.id,className:`p-4 transition-all duration-200 ${r==="tap"&&i?"cursor-pointer hover:shadow-lg hover:border-purple-300 hover:bg-purple-50":r==="drag"?"border-dashed border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50":"cursor-default"}`,onClick:()=>E(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(R,{className:"h-6 w-6 text-purple-600"})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ${s.status==="active"?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{variant:W(s.experience),size:"sm",children:s.experience}),e.jsx("span",{className:"text-xs text-gray-500",children:s.machineType})]})]})]}),r==="tap"&&i&&e.jsx(U,{className:"h-5 w-5 text-purple-600 animate-pulse"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Efficiency"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:[s.efficiency,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Workload"}),e.jsx("p",{className:"font-semibold text-orange-600",children:s.currentWorkload})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Status"}),e.jsx("p",{className:`font-semibold capitalize ${_(s.status)}`,children:s.status})]})]}),s.specialties.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Specialties:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.specialties.slice(0,2).map(t=>e.jsx(u,{variant:"outline",size:"sm",children:t},t)),s.specialties.length>2&&e.jsxs(u,{variant:"outline",size:"sm",children:["+",s.specialties.length-2]})]})]})]},s.id)),d.filter(s=>s.status==="active").length===0&&e.jsxs(l,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"😴"}),e.jsx("p",{className:"text-gray-600",children:"No operators available right now"}),e.jsx(h,{variant:"outline",onClick:v,className:"mt-4",children:"Refresh List"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(l,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-blue-600 font-bold",children:g.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Operations"})]}),e.jsxs(l,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-purple-600 font-bold",children:d.filter(s=>s.status==="active").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Operators"})]}),e.jsxs(l,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-green-600 font-bold",children:d.reduce((s,t)=>s+t.currentWorkload,0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Assignments"})]})]})]})};export{me as DragDropAssignmentDashboard,me as default};
