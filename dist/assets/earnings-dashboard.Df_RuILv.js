import{j as e}from"./query-vendor.BbCCZTU0.js";import{r as c}from"./react-vendor.BcnQP8kQ.js";import{C as r,d as n,B as f,e as i,f as o,g as T,a as h}from"./index.BnZjV7b3.js";import"./separator.DoYDqNAe.js";import{o as D}from"./operator-wallet-service.CYKz_Xt9.js";import{t as p}from"./index.wyP5CHuk.js";import{s as re,D as Y,I as E,t as $,j as O,C as R,f as Z,g as _,k,E as K,u as U,i as ne,p as ce,q as de,v as ie,T as X,F as oe}from"./ui-vendor.B7YYMSVe.js";import{f as P,g as F,h as xe}from"./utils-vendor.B0NEtgzl.js";import{I as me}from"./Input.D8gd7mOf.js";import{S as B,a as L,b as G,c as I,d as m}from"./select.BqvOc8nJ.js";import{P as he,a as ue,b as je,C as pe}from"./popover.Bs9O0IEU.js";import{P as ge}from"./progress.CT9_BnvS.js";import{F as fe}from"./CurrencyRupeeIcon.CCku5vMm.js";import{F as Ne}from"./ClockIcon.DbOxfhcH.js";import{F as ye}from"./UserGroupIcon.D7JnDaPi.js";import"./base-service.9pve6B0A.js";import"./firebase-vendor.BZUNkHzc.js";import"./firebase.BVb4kvNg.js";import"./utils.k9sMftog.js";import"./index.D7kpLDHr.js";function be({title:d,titleId:s,...g},x){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":s},g),d?c.createElement("title",{id:s},d):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z"}))}const ve=c.forwardRef(be),we={earnings:{label:"Work Completion",color:"bg-green-100 text-green-800",icon:R},payment:{label:"Payment Received",color:"bg-blue-100 text-blue-800",icon:E},hold:{label:"Payment Hold",color:"bg-yellow-100 text-yellow-800",icon:$},bonus:{label:"Bonus",color:"bg-purple-100 text-purple-800",icon:O},deduction:{label:"Deduction",color:"bg-red-100 text-red-800",icon:U}},Pe=({operatorId:d})=>{const[s,g]=c.useState(null),[x,u]=c.useState(!0),[y,S]=c.useState(!1),[b,j]=c.useState("month");c.useEffect(()=>{v()},[d]);const v=async()=>{try{u(!0);const l=await D.getWalletData(d);g(l)}catch(l){console.error("Error loading wallet data:",l),p.error("Failed to load wallet information")}finally{u(!1)}},t=async()=>{try{await D.exportStatement(d,b),p.success("Statement exported successfully")}catch{p.error("Failed to export statement")}},w=async()=>{if(!s||s.availableBalance<=0){p.error("No available balance for payment request");return}try{await D.requestPayment(d),p.success("Payment request submitted"),v()}catch{p.error("Failed to submit payment request")}};if(x)return e.jsx(r,{children:e.jsx(n,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!s)return e.jsx(r,{children:e.jsxs(n,{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Wallet Data Not Available"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to load wallet information for this operator."})]})});const M=Math.min(100,s.goalProgress/s.monthlyGoal*100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Wallet"}),e.jsxs("p",{className:"text-muted-foreground",children:["Financial overview for ",s.operatorName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(f,{variant:"outline",onClick:t,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Export Statement"]}),e.jsxs(f,{onClick:w,disabled:s.availableBalance<=0,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Request Payment"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Available Balance"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₹",s.availableBalance.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for payment"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Hold Amount"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-amber-600",children:["₹",s.holdAmount.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.paymentHolds.filter(l=>l.status==="active").length," active holds"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Monthly Earnings"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["₹",s.monthlyEarnings.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["₹",s.totalEarnings.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-5 w-5"}),e.jsx("span",{children:"Monthly Goal Progress"})]}),e.jsxs(T,{children:["Target: ₹",s.monthlyGoal.toFixed(2)," | Current: ₹",s.goalProgress.toFixed(2)]})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[M.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,M)}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["₹",(s.monthlyGoal-s.goalProgress).toFixed(2)," remaining to reach goal"]})]})})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsx(o,{children:"Performance Metrics"})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Work Completed"}),e.jsxs("span",{className:"font-semibold",children:[s.totalWorkCompleted," pieces"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Avg. per Piece"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.averageEarningsPerPiece.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Weekly Earnings"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.weeklyEarnings.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Daily Average"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.dailyEarnings.toFixed(2)]})]})]})]})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-5 w-5"}),e.jsx("span",{children:"Payment Schedule"})]})}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-1",children:"LAST PAYMENT"}),e.jsx("p",{className:"text-lg font-semibold",children:P(new Date(s.lastPaymentDate),"MMM dd, yyyy")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:F(new Date(s.lastPaymentDate),{addSuffix:!0})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-1",children:"NEXT PAYMENT"}),e.jsx("p",{className:"text-lg font-semibold",children:P(new Date(s.nextPaymentDate),"MMM dd, yyyy")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[F(new Date(s.nextPaymentDate))," from now"]})]})]})})]}),s.paymentHolds.filter(l=>l.status==="active").length>0&&e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{children:"Active Payment Holds"})]}),e.jsx(T,{children:"These amounts are temporarily held pending review"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:s.paymentHolds.filter(l=>l.status==="active").map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",children:l.bundleId}),e.jsx(h,{className:"bg-amber-100 text-amber-800",children:"Hold Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.reason}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F(new Date(l.createdAt),{addSuffix:!0})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-amber-600",children:["-₹",l.amount.toFixed(2)]})})]},l.id))})})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Transactions"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>S(!y),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),y?"Show Less":"View All"]})]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:(y?s.recentTransactions:s.recentTransactions.slice(0,5)).map(l=>{const H=we[l.type],A=H.icon;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${H.color}`,children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.description}),l.bundleId&&e.jsx(h,{variant:"outline",className:"mt-1 text-xs",children:l.bundleId}),e.jsx("p",{className:"text-xs text-muted-foreground",children:P(new Date(l.date),"MMM dd, yyyy HH:mm")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-bold ${l.type==="earnings"||l.type==="payment"||l.type==="bonus"?"text-green-600":"text-red-600"}`,children:[l.type==="earnings"||l.type==="payment"||l.type==="bonus"?"+":"-","₹",Math.abs(l.amount).toFixed(2)]}),e.jsx(h,{className:`text-xs ${l.status==="completed"?"bg-green-100 text-green-800":l.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:l.status})]})]},l.id)})})})]})]})},Se={pending:{label:"Pending Approval",color:"bg-yellow-100 text-yellow-800",icon:k},approved:{label:"Approved",color:"bg-blue-100 text-blue-800",icon:R},paid:{label:"Paid",color:"bg-green-100 text-green-800",icon:R},hold:{label:"On Hold",color:"bg-red-100 text-red-800",icon:k}},Ce={"A+":{label:"Excellent",color:"bg-green-100 text-green-800"},A:{label:"Good",color:"bg-blue-100 text-blue-800"},B:{label:"Average",color:"bg-yellow-100 text-yellow-800"},C:{label:"Below Average",color:"bg-orange-100 text-orange-800"},D:{label:"Poor",color:"bg-red-100 text-red-800"}},De=({operatorId:d})=>{const[s,g]=c.useState([]),[x,u]=c.useState(null),[y,S]=c.useState(!0),[b,j]=c.useState(""),[v,t]=c.useState("all"),[w,M]=c.useState("all"),[l,H]=c.useState({}),[A,J]=c.useState("month"),[z,ee]=c.useState("date"),[W,se]=c.useState("desc");c.useEffect(()=>{te()},[d,A]);const te=async()=>{try{S(!0);const[a,N]=await Promise.all([D.getEarningsHistory(d,A),D.getEarningsSummary(d,A)]);g(a),u(N)}catch(a){console.error("Error loading earnings history:",a),p.error("Failed to load earnings history")}finally{S(!1)}},ae=async()=>{try{await D.exportEarningsHistory(d,{period:A,dateRange:l,format:"xlsx"}),p.success("Earnings data exported successfully")}catch{p.error("Failed to export earnings data")}},q=s.filter(a=>{const N=a.bundleId.toLowerCase().includes(b.toLowerCase())||a.workType.toLowerCase().includes(b.toLowerCase()),C=v==="all"||a.paymentStatus===v,V=w==="all"||a.qualityGrade===w,le=!l.from||!l.to||xe(new Date(a.completedAt),{start:l.from,end:l.to});return N&&C&&V&&le}).sort((a,N)=>{let C=0;switch(z){case"date":C=new Date(a.completedAt).getTime()-new Date(N.completedAt).getTime();break;case"earnings":C=a.totalEarnings-N.totalEarnings;break;case"pieces":C=a.piecesCompleted-N.piecesCompleted;break}return W==="desc"?-C:C});return y?e.jsx(r,{children:e.jsx(n,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Earnings History"}),e.jsx("p",{className:"text-muted-foreground",children:"Detailed breakdown of work completion and earnings"})]}),e.jsxs(f,{onClick:ae,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Export Data"]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["₹",x.totalEarnings.toFixed(2)]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[x.periodComparison.changePercentage>=0?e.jsx(O,{className:"h-3 w-3 mr-1 text-green-500"}):e.jsx(U,{className:"h-3 w-3 mr-1 text-red-500"}),Math.abs(x.periodComparison.changePercentage).toFixed(1),"% vs last period"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Pieces Completed"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalPieces}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total work completed"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Average Rate"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["₹",x.averageRate.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per piece"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Bonus Earned"}),e.jsx(O,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₹",x.bonusEarnings.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quality bonuses"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Deductions"}),e.jsx(U,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["₹",x.penaltyDeductions.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Penalties applied"})]})]})]}),e.jsx(r,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:"Search bundles...",value:b,onChange:a=>j(a.target.value),className:"pl-8"})]}),e.jsxs(B,{value:A,onValueChange:a=>J(a),children:[e.jsx(L,{children:e.jsx(G,{placeholder:"Period"})}),e.jsxs(I,{children:[e.jsx(m,{value:"week",children:"This Week"}),e.jsx(m,{value:"month",children:"This Month"}),e.jsx(m,{value:"quarter",children:"This Quarter"}),e.jsx(m,{value:"year",children:"This Year"})]})]}),e.jsxs(B,{value:v,onValueChange:t,children:[e.jsxs(L,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),e.jsx(G,{placeholder:"Payment Status"})]}),e.jsxs(I,{children:[e.jsx(m,{value:"all",children:"All Status"}),e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"approved",children:"Approved"}),e.jsx(m,{value:"paid",children:"Paid"}),e.jsx(m,{value:"hold",children:"On Hold"})]})]}),e.jsxs(B,{value:w,onValueChange:M,children:[e.jsx(L,{children:e.jsx(G,{placeholder:"Quality Grade"})}),e.jsxs(I,{children:[e.jsx(m,{value:"all",children:"All Grades"}),e.jsx(m,{value:"A+",children:"A+ (Excellent)"}),e.jsx(m,{value:"A",children:"A (Good)"}),e.jsx(m,{value:"B",children:"B (Average)"}),e.jsx(m,{value:"C",children:"C (Below Average)"}),e.jsx(m,{value:"D",children:"D (Poor)"})]})]}),e.jsxs(B,{value:z,onValueChange:a=>ee(a),children:[e.jsx(L,{children:e.jsx(G,{placeholder:"Sort by"})}),e.jsxs(I,{children:[e.jsx(m,{value:"date",children:"Date"}),e.jsx(m,{value:"earnings",children:"Earnings"}),e.jsx(m,{value:"pieces",children:"Pieces"})]})]}),e.jsxs(he,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(f,{variant:"outline",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Date Range"]})}),e.jsx(je,{className:"w-auto p-0",align:"start",children:e.jsx(pe,{mode:"range",selected:{from:l.from,to:l.to},onSelect:a=>H(a||{}),numberOfMonths:2})})]})]})})}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Work Completion Records"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>se(W==="asc"?"desc":"asc"),children:[W==="asc"?"↑":"↓"," Sort"]})})]}),e.jsxs(T,{children:["Showing ",q.length," of ",s.length," records"]})]}),e.jsx(n,{children:q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No earnings records found"}),e.jsx("p",{className:"text-muted-foreground",children:b||v!=="all"||w!=="all"?"No records match your current filters":"No work has been completed yet"})]}):e.jsx("div",{className:"space-y-3",children:q.map(a=>{const N=Se[a.paymentStatus],C=Ce[a.qualityGrade],V=N.icon;return e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{variant:"outline",className:"font-mono",children:a.bundleId}),e.jsxs(h,{className:N.color,children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),N.label]}),e.jsxs(h,{className:C.color,children:["Grade ",a.qualityGrade]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Work Type:"}),e.jsx("p",{className:"font-medium",children:a.workType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pieces:"}),e.jsx("p",{className:"font-bold text-blue-600",children:a.piecesCompleted})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Rate per Piece:"}),e.jsxs("p",{className:"font-medium",children:["₹",a.ratePerPiece.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("p",{className:"font-medium",children:P(new Date(a.completedAt),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-2",children:"Base:"}),e.jsxs("span",{className:"font-semibold",children:["₹",a.totalEarnings.toFixed(2)]})]}),a.bonusAmount&&a.bonusAmount>0&&e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("span",{className:"mr-2",children:"Bonus:"}),e.jsxs("span",{className:"font-semibold",children:["+₹",a.bonusAmount.toFixed(2)]})]}),a.penaltyAmount&&a.penaltyAmount>0&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx("span",{className:"mr-2",children:"Penalty:"}),e.jsxs("span",{className:"font-semibold",children:["-₹",a.penaltyAmount.toFixed(2)]})]})]}),a.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Notes:"}),e.jsx("p",{className:"text-sm bg-muted p-2 rounded mt-1",children:a.notes})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₹",(a.totalEarnings+(a.bonusAmount||0)-(a.penaltyAmount||0)).toFixed(2)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.approvedAt?`Approved ${P(new Date(a.approvedAt),"MMM dd")}`:"Pending approval"})]})]})},a.id)})})})]})]})},Ae={pending:{label:"Pending Review",color:"bg-yellow-100 text-yellow-800",icon:k},approved:{label:"Approved",color:"bg-blue-100 text-blue-800",icon:R},processing:{label:"Processing",color:"bg-purple-100 text-purple-800",icon:k},completed:{label:"Completed",color:"bg-green-100 text-green-800",icon:R},rejected:{label:"Rejected",color:"bg-red-100 text-red-800",icon:X}},Q={minor:{color:"bg-yellow-100 text-yellow-800",label:"Minor Issue"},major:{color:"bg-orange-100 text-orange-800",label:"Major Issue"},critical:{color:"bg-red-100 text-red-800",label:"Critical Issue"}},Ee=({operatorId:d})=>{const[s,g]=c.useState(null),[x,u]=c.useState(!0);c.useEffect(()=>{y()},[d]);const y=async()=>{try{u(!0);const t=await D.getPaymentStatus(d);g(t)}catch(t){console.error("Error loading payment status:",t),p.error("Failed to load payment status")}finally{u(!1)}},S=async()=>{if(s){if(s.currentBalance<s.minimumPayoutThreshold){p.error(`Minimum payout amount is ₹${s.minimumPayoutThreshold}`);return}try{await D.requestPayment(d),p.success("Payment request submitted successfully"),y()}catch{p.error("Failed to submit payment request")}}},b=async()=>{try{await D.downloadPaymentStatement(d),p.success("Payment statement downloaded")}catch{p.error("Failed to download statement")}};if(x)return e.jsx(r,{children:e.jsx(n,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!s)return e.jsx(r,{children:e.jsxs(n,{className:"text-center py-8",children:[e.jsx(ie,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Payment Status Unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to load payment information."})]})});const j=s.currentBalance>=s.minimumPayoutThreshold&&!s.paymentRequests.some(t=>["pending","approved","processing"].includes(t.status)),v=s.currentBalance/s.minimumPayoutThreshold*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Payment Status"}),e.jsxs("p",{className:"text-muted-foreground",children:["Track your payments and balance for ",s.operatorName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(f,{variant:"outline",onClick:b,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Statement"]}),e.jsxs(f,{onClick:S,disabled:!j,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Request Payment"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs(o,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Available Balance"}),e.jsx(E,{className:"h-5 w-5 text-green-600"})]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600",children:["₹",s.currentBalance.toFixed(2)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress to minimum payout"}),e.jsxs("span",{children:[v.toFixed(0),"%"]})]}),e.jsx(ge,{value:Math.min(100,v),className:"h-2"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Minimum: ₹",s.minimumPayoutThreshold," | Need: ₹",Math.max(0,s.minimumPayoutThreshold-s.currentBalance).toFixed(2)," more"]})]}),s.pendingEarnings>0&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Pending Earnings:"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.pendingEarnings.toFixed(2)]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"These will be added once work is approved"})]})]})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsx(o,{children:"Payment Schedule"})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["Next Payment: ",P(s.nextPaymentDate,"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[F(s.nextPaymentDate)," from now"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Frequency:"}),e.jsx("span",{className:"font-medium capitalize",children:s.paymentFrequency.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Method:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium capitalize",children:s.paymentMethod.type.replace("_"," ")}),s.paymentMethod.verified?e.jsx(h,{className:"bg-green-100 text-green-800 text-xs",children:"Verified"}):e.jsx(h,{className:"bg-yellow-100 text-yellow-800 text-xs",children:"Unverified"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.paymentMethod.details})]})]})]})]}),s.activeHolds.length>0&&e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5 text-amber-500"}),e.jsxs("span",{children:["Payment Holds (",s.activeHolds.length,")"]})]}),e.jsx(T,{children:"These amounts are temporarily held pending resolution"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-4",children:s.activeHolds.map(t=>e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(h,{variant:"outline",children:t.bundleId}),e.jsx(h,{className:Q[t.severity].color,children:Q[t.severity].label}),e.jsx(h,{className:"bg-yellow-100 text-yellow-800",children:t.status.replace("_"," ").toUpperCase()})]}),e.jsx("p",{className:"text-sm mb-1",children:t.reason}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Created: ",F(new Date(t.createdAt),{addSuffix:!0})]}),t.estimatedResolutionDate&&e.jsxs("span",{className:"ml-4",children:["Est. Resolution: ",P(new Date(t.estimatedResolutionDate),"MMM dd")]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["-₹",t.amount.toFixed(2)]})})]},t.id))})})]}),s.paymentRequests.length>0&&e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{children:"Payment Requests"})]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-4",children:s.paymentRequests.map(t=>{const w=Ae[t.status],M=w.icon;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(h,{className:w.color,children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),w.label]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Requested ",F(new Date(t.requestedAt),{addSuffix:!0})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Processing Stage: ",t.processingStage]}),t.estimatedCompletionDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Expected completion: ",P(new Date(t.estimatedCompletionDate),"MMM dd, yyyy")]}),t.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600",children:["Reason: ",t.rejectionReason]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold",children:["₹",t.amount.toFixed(2)]}),e.jsxs(f,{variant:"ghost",size:"sm",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Details"]})]})]},t.id)})})})]}),s.upcomingPayments.length>0&&e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(o,{children:"Upcoming Payments"}),e.jsx(T,{children:"Scheduled payments for the next period"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:s.upcomingPayments.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:t.type==="bonus"?"default":"secondary",children:t.type.replace("_"," ").toUpperCase()}),e.jsx(h,{className:t.status==="scheduled"?"bg-blue-100 text-blue-800":t.status==="processing"?"bg-purple-100 text-purple-800":"bg-red-100 text-red-800",children:t.status.toUpperCase()})]}),e.jsx("p",{className:"text-sm mt-1",children:t.description}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Due: ",P(new Date(t.scheduledDate),"MMM dd, yyyy")]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-bold text-green-600",children:["₹",t.amount.toFixed(2)]})})]},t.id))})})]}),s.paymentHistory.length>0&&e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(o,{children:"Recent Payment History"}),e.jsx(T,{children:"Your last few payments"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:s.paymentHistory.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:t.status==="completed"?"bg-green-100 text-green-800":t.status==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:t.status.toUpperCase()}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",t.referenceNumber]})]}),e.jsx("p",{className:"text-sm mt-1",children:t.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[P(new Date(t.paymentDate),"MMM dd, yyyy")," via ",t.method]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-bold text-green-600",children:["₹",t.amount.toFixed(2)]})})]},t.id))})})]})]})},Ze=({userRole:d="supervisor",operatorId:s})=>{const[g,x]=c.useState("overview"),u={totalEarnings:45650,pendingPayments:8750,completedPayments:36900,activeOperators:156,averageEarnings:292.95,paymentRate:96.2},y=[{id:"PAY001",operatorName:"Maya Sharma",operatorId:"op-maya-001",amount:2850,status:"Completed",paymentDate:new Date("2024-12-07"),workPeriod:"Dec 1-7, 2024"},{id:"PAY002",operatorName:"Rajesh Kumar",operatorId:"op-rajesh-002",amount:3200,status:"Processing",paymentDate:new Date("2024-12-07"),workPeriod:"Dec 1-7, 2024"},{id:"PAY003",operatorName:"Priya Singh",operatorId:"op-priya-003",amount:2650,status:"Pending Approval",paymentDate:new Date("2024-12-08"),workPeriod:"Dec 1-7, 2024"}],S=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(fe,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Earnings"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₹",u.totalEarnings.toLocaleString()]})]})]})}),e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:e.jsx(Ne,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Payments"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:["₹",u.pendingPayments.toLocaleString()]})]})]})}),e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ye,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Operators"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u.activeOperators})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Performance"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Success Rate"}),e.jsxs("span",{className:"text-sm font-medium text-green-600",children:[u.paymentRate,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${u.paymentRate}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Earnings/Operator"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["₹",u.averageEarnings]})]})]})]}),e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Breakdown"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Completed"})]}),e.jsxs("span",{className:"text-sm font-medium",children:["₹",u.completedPayments.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Pending"})]}),e.jsxs("span",{className:"text-sm font-medium",children:["₹",u.pendingPayments.toLocaleString()]})]})]})]})]}),e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Payments"}),e.jsx(f,{variant:"outline",size:"sm",children:"View All Payments"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Payment ID"}),e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Operator"}),e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Amount"}),e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Period"}),e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 text-sm font-medium text-gray-600",children:"Date"})]})}),e.jsx("tbody",{children:y.map(j=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-3 text-sm font-medium text-gray-900",children:j.id}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:j.operatorName}),e.jsx("p",{className:"text-xs text-gray-500",children:j.operatorId})]})}),e.jsxs("td",{className:"py-3 text-sm font-medium text-gray-900",children:["₹",j.amount.toLocaleString()]}),e.jsx("td",{className:"py-3 text-sm text-gray-600",children:j.workPeriod}),e.jsx("td",{className:"py-3",children:e.jsx(h,{variant:j.status==="Completed"?"default":j.status==="Processing"?"secondary":"outline",children:j.status})}),e.jsx("td",{className:"py-3 text-sm text-gray-600",children:j.paymentDate.toLocaleDateString()})]},j.id))})]})})]})]}),b=()=>{switch(g){case"overview":return S();case"wallet":return e.jsx(Pe,{operatorId:s||"op-maya-001"});case"history":return e.jsx(De,{operatorId:s});case"payments":return e.jsx(Ee,{userRole:d});default:return S()}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(ve,{className:"h-8 w-8 text-green-600"}),e.jsx("span",{children:"Earnings & Payments"})]}),e.jsx("p",{className:"text-gray-600",children:"Manage operator earnings and payment processing"})]}),d==="supervisor"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:"outline",children:"Generate Report"}),e.jsx(f,{children:"Process Payments"})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>x("overview"),className:`py-2 px-1 border-b-2 font-medium text-sm ${g==="overview"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Overview"}),(d==="operator"||s)&&e.jsx("button",{onClick:()=>x("wallet"),className:`py-2 px-1 border-b-2 font-medium text-sm ${g==="wallet"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"My Wallet"}),e.jsx("button",{onClick:()=>x("history"),className:`py-2 px-1 border-b-2 font-medium text-sm ${g==="history"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Earnings History"}),e.jsx("button",{onClick:()=>x("payments"),className:`py-2 px-1 border-b-2 font-medium text-sm ${g==="payments"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Payment Status"})]})}),b()]})};export{Ze as EarningsDashboard};
