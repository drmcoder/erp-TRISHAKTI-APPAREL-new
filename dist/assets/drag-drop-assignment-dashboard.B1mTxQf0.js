const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/atomic-operations.BD-reO0z.js","assets/firebase-vendor.m6WcKfT_.js","assets/index.B__xpDQO.js","assets/query-vendor.NFs8Lf8Y.js","assets/react-vendor.BcnQP8kQ.js","assets/ui-vendor.BnTQXQPs.js","assets/utils-vendor.B0NEtgzl.js","assets/index.B7mSI82B.css"])))=>i.map(i=>d[i]);
import{B as v,c as h,z as L,b as O,_ as z}from"./index.B__xpDQO.js";import{j as e}from"./query-vendor.NFs8Lf8Y.js";import{r as g}from"./react-vendor.BcnQP8kQ.js";import{L as W}from"./LoadingSpinner.BqqE1w83.js";import{F as D}from"./ClockIcon.DbOxfhcH.js";import{F as X}from"./HandRaisedIcon.iA2fgNMv.js";import{F as Y}from"./CurrencyDollarIcon.CyMFdc0e.js";import{F as P}from"./UserIcon.x-aGQUUd.js";import{F as H}from"./ArrowRightIcon.xKte5yv4.js";import"./ui-vendor.BnTQXQPs.js";import"./utils-vendor.B0NEtgzl.js";import"./firebase-vendor.m6WcKfT_.js";class A{static async getAvailableOperationsForOperator(i,s){try{return await new Promise(a=>setTimeout(a,500)),{success:!0,data:[{id:"BND-3233-M-001-OP-1",bundleId:"bundle_1",operationId:"shoulder_join",name:"Shoulder Join",nameNepali:"काँध जोड्ने",machineType:s,sequenceOrder:1,pricePerPiece:2.5,smvMinutes:4.5,status:"pending",prerequisites:[],isOptional:!1,qualityCheckRequired:!0,defectTolerance:5,bundleInfo:{bundleNumber:"BND-3233-M-001",articleNumber:"3233",articleStyle:"Adult T-shirt",size:"M",priority:"normal"}}]}}catch(r){return console.error("Failed to get available operations:",r),{success:!1,error:"Failed to fetch available operations"}}}static async selfAssignOperation(i,s,r){try{return await new Promise(o=>setTimeout(o,1e3)),{success:!0,data:{operatorId:i,operatorName:s,operationId:r,operationName:"Mock Operation",assignedAt:new Date}}}catch(a){return console.error("Self-assignment failed:",a),{success:!1,error:"Self-assignment failed"}}}static async submitPartsComplaint(i){try{return await new Promise(r=>setTimeout(r,800)),{success:!0,data:{id:`complaint_${Date.now()}`,...i,reportedBy:"current_operator",reportedByName:"Current Operator",reportedAt:new Date,status:"reported",replacedParts:[],resolution:"parts_replaced"}}}catch(s){return console.error("Failed to submit parts complaint:",s),{success:!1,error:"Failed to submit complaint"}}}static async getPartsComplaints(i){try{return await new Promise(s=>setTimeout(s,600)),{success:!0,data:[]}}catch(s){return console.error("Failed to get parts complaints:",s),{success:!1,error:"Failed to fetch parts complaints"}}}static async updateComplaintStatus(i,s,r){try{return await new Promise(a=>setTimeout(a,500)),{success:!0}}catch(a){return console.error("Failed to update complaint status:",a),{success:!1,error:"Failed to update complaint status"}}}static async getPendingOperations(i){try{return await new Promise(r=>setTimeout(r,800)),{success:!0,data:this.generateMockPendingOperations(i?.limit||50)}}catch(s){return console.error("Failed to get pending operations:",s),{success:!1,error:"Failed to fetch pending operations"}}}static async getAvailableOperators(){try{return await new Promise(s=>setTimeout(s,400)),{success:!0,data:[{id:"op_1",name:"Maya Patel",machineType:"overlock",efficiency:94.5,currentWorkload:2,experience:"expert",specialties:["shoulder_join","side_seam"],status:"active"},{id:"op_2",name:"Rajesh Kumar",machineType:"singleNeedle",efficiency:91.2,currentWorkload:1,experience:"expert",specialties:["sleeve_attach","hem_finish"],status:"active"}]}}catch(i){return console.error("Failed to get operators:",i),{success:!1,error:"Failed to fetch operators"}}}static async autoSmartAssign(i,s){try{return await new Promise(a=>setTimeout(a,2e3)),{success:!0,data:i.map((a,o)=>({operatorId:s[o%s.length].id,operatorName:s[o%s.length].name,operationId:a,operationName:`Operation ${o+1}`,assignedAt:new Date}))}}catch(r){return console.error("Auto smart assignment failed:",r),{success:!1,error:"Auto assignment failed"}}}static async bulkBatchAssign(i,s){try{return await new Promise(a=>setTimeout(a,1500)),{success:!0,data:[]}}catch(r){return console.error("Bulk assignment failed:",r),{success:!1,error:"Bulk assignment failed"}}}static async getBundleTrackingData(i){try{return await new Promise(r=>setTimeout(r,1e3)),{success:!0,data:this.generateMockTrackingData(100)}}catch(s){return console.error("Failed to get bundle tracking data:",s),{success:!1,error:"Failed to fetch tracking data"}}}static async updateBundleStatus(i,s,r){try{return await new Promise(a=>setTimeout(a,300)),{success:!0}}catch(a){return console.error("Failed to update bundle status:",a),{success:!1,error:"Failed to update bundle status"}}}static generateMockPendingOperations(i){const s=[],r=["3233","3265","3401"],a=["S","M","L","XL"],o=["overlock","singleNeedle"],y=["low","normal","high","urgent"],c=[{name:"Shoulder Join",nameNepali:"काँध जोड्ने",price:2.5,time:4.5},{name:"Side Seam",nameNepali:"छेउ सिलाई",price:3,time:5},{name:"Sleeve Attach",nameNepali:"आस्तीन लगाउने",price:4,time:7}];for(let p=1;p<=i;p++){const l=r[Math.floor(Math.random()*r.length)],x=a[Math.floor(Math.random()*a.length)],m=o[Math.floor(Math.random()*o.length)],f=y[Math.floor(Math.random()*y.length)],u=c[Math.floor(Math.random()*c.length)];s.push({id:`BND-${l}-${x}-${String(p).padStart(3,"0")}-OP-1`,bundleId:`bundle_${p}`,operationId:u.name.toLowerCase().replace(" ","_"),name:u.name,nameNepali:u.nameNepali,machineType:m,sequenceOrder:1,pricePerPiece:u.price,smvMinutes:u.time,status:"pending",prerequisites:[],isOptional:!1,qualityCheckRequired:Math.random()>.7,defectTolerance:5,priority:f,articleNumber:l,size:x,createdAt:new Date(Date.now()-Math.random()*24*60*60*1e3),bundleInfo:{bundleNumber:`BND-${l}-${x}-${String(p).padStart(3,"0")}`,articleNumber:l,articleStyle:"Mock Article",size:x,priority:f}})}return s}static generateMockTrackingData(i){const s=[],r=["created","cutting","sewing","quality","finished","shipped"];for(let a=1;a<=i;a++){const o=r[Math.floor(Math.random()*r.length)];s.push({id:`bundle_${a}`,bundleNumber:`BND-3233-M-${String(a).padStart(3,"0")}`,batchId:`batch_${Math.floor(a/50)+1}`,batchNumber:`BATCH-${String(Math.floor(a/50)+1).padStart(3,"0")}`,lotId:`lot_${Math.floor(a/500)+1}`,lotNumber:`LOT-${String(Math.floor(a/500)+1).padStart(2,"0")}`,articleNumber:"3233",articleStyle:"Adult T-shirt",size:"M",quantity:1,createdAt:new Date(Date.now()-Math.random()*7*24*60*60*1e3),status:o,plannedDuration:4+Math.random()*8,actualDuration:o!=="created"?4+Math.random()*8:void 0,efficiency:85+Math.random()*15,defectRate:Math.random()*5,reworkCount:Math.floor(Math.random()*3),assignedOperators:[`op_${Math.floor(Math.random()*8)+1}`],supervisorId:"supervisor_1",priority:"normal",totalCost:50+Math.random()*100,totalEarnings:80+Math.random()*150,materialCost:30+Math.random()*50,qualityScore:6+Math.random()*4,qualityIssues:Math.random()>.8?["Minor issue"]:[],milestones:[]})}return s}}const ne=({userRole:$})=>{const[i,s]=g.useState([]),[r,a]=g.useState([]),[o,y]=g.useState(!0),[c,p]=g.useState("tap"),[l,x]=g.useState(null),[m,f]=g.useState({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}});g.useEffect(()=>{u()},[]);const u=async()=>{y(!0);try{const[t,n]=await Promise.all([A.getPendingOperations({limit:20}),A.getAvailableOperators()]);t.success&&t.data&&s(t.data),n.success&&n.data&&a(n.data)}catch(t){console.error("Failed to load data:",t)}finally{y(!1)}},I=(t,n)=>{if(c!=="drag")return;t.preventDefault();const d=t.touches[0],b=t.currentTarget.getBoundingClientRect();f({isDragging:!0,draggedOperation:n,dragSource:{x:d.clientX,y:d.clientY},touchOffset:{x:d.clientX-b.left,y:d.clientY-b.top}})},F=t=>{if(!m.isDragging||!m.draggedOperation)return;t.preventDefault();const n=t.touches[0];f(d=>({...d,dragSource:{x:n.clientX,y:n.clientY}}))},C=t=>{if(!m.isDragging||!m.draggedOperation)return;const n=t.changedTouches[0],b=document.elementFromPoint(n.clientX,n.clientY)?.closest("[data-operator-id]");if(b){const T=b.getAttribute("data-operator-id"),w=r.find(M=>M.id===T);w&&k(m.draggedOperation,w)}f({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}})},_=t=>{c==="tap"&&x(l?.id===t.id?null:t)},B=t=>{c!=="tap"||!l||(k(l,t),x(null))},k=async(t,n)=>{try{const{atomicOperationsService:d}=await z(async()=>{const{atomicOperationsService:j}=await import("./atomic-operations.BD-reO0z.js");return{atomicOperationsService:j}},__vite__mapDeps([0,1,2,3,4,5,6,7])),b={id:t.id,machineType:t.machineType||t.machineRequired||t.bundleInfo.machineType||"singleNeedle",operation:t.name||t.operation,skillLevelRequired:t.skillLevel||"intermediate",status:"pending",assignedOperatorId:null,targetPieces:t.quantity||100,ratePerPiece:t.pricePerPiece||10},T={id:n.id,name:n.name,machineTypes:[n.machineType],primaryMachine:n.machineType,skillLevel:n.experience,currentStatus:n.status,currentAssignments:n.currentWorkload,maxConcurrentWork:5},w={workItemId:t.id,operatorId:n.id,supervisorId:"current-supervisor",assignmentData:{workItemId:t.id,operatorId:n.id,assignmentMethod:"drag_drop",estimatedStartTime:new Date,estimatedCompletionTime:new Date(Date.now()+7200*1e3)},timestamp:new Date},M=await d.atomicAssignWork(w);M.success?(s(j=>j.filter(N=>N.id!==t.id)),a(j=>j.map(N=>N.id===n.id?{...N,currentWorkload:N.currentWorkload+1}:N)),R(`✅ ${t.name} assigned to ${n.name}`)):S(`❌ ${M.error||`Failed to assign ${t.name} to ${n.name}`}`)}catch(d){console.error("Assignment failed:",d),S(`❌ Assignment failed: ${d instanceof Error?d.message:"Please try again."}`)}},R=t=>{console.log("Success:",t)},S=t=>{console.error("Error:",t)},q=t=>{switch(t){case"expert":return"success";case"intermediate":return"warning";case"beginner":return"info";default:return"secondary"}},E=t=>{switch(t){case"active":return"text-green-600";case"break":return"text-yellow-600";case"offline":return"text-red-600";default:return"text-gray-600"}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(W,{text:"Loading assignment dashboard..."})}):e.jsxs("div",{className:"p-4 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🎯 Drag & Drop Assignment"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Assign operations to operators with ease"})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-lg",children:[e.jsx(v,{variant:c==="tap"?"primary":"ghost",size:"sm",onClick:()=>p("tap"),className:"text-xs",children:"👆 Tap Mode"}),e.jsx(v,{variant:c==="drag"?"primary":"ghost",size:"sm",onClick:()=>p("drag"),className:"text-xs",children:"🤏 Drag Mode"})]})]}),e.jsx(h,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:"💡"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"How to Assign:"}),c==="tap"?e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Tap on a bundle operation below → 2. Tap on an operator → Done! ✅"}):e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Press and hold a bundle operation → 2. Drag to an operator → Release! ✅"})]})]})}),c==="tap"&&l&&e.jsx(h,{className:"p-4 bg-green-50 border-green-200 border-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Selected Operation:"}),e.jsxs("p",{className:"text-green-800",children:[l.name," - ",l.bundleInfo.bundleNumber]})]})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>x(null),className:"text-green-700",children:"✕ Cancel"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(D,{className:"h-6 w-6 mr-2 text-blue-600"}),"Available Work (",i.length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[i.map(t=>e.jsxs(h,{className:`p-4 cursor-pointer transition-all duration-200 ${l?.id===t.id?"border-green-500 border-2 bg-green-50 shadow-lg":"hover:shadow-lg hover:border-blue-300"} ${m.isDragging&&m.draggedOperation?.id===t.id?"opacity-50 transform scale-95":""}`,onTouchStart:n=>I(n,t),onTouchMove:F,onTouchEnd:C,onClick:()=>_(t),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.nameNepali})]})]}),c==="drag"&&e.jsx("div",{className:"flex items-center text-gray-400",children:e.jsx(X,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"flex items-center text-gray-600",children:e.jsx("span",{className:"font-medium text-blue-600",children:t.bundleInfo.bundleNumber})}),e.jsx(O,{variant:"secondary",children:t.machineType})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),t.smvMinutes,"min"]}),e.jsxs("span",{className:"flex items-center font-semibold text-green-600",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"$",t.pricePerPiece]})]})]})]},t.id)),i.length===0&&e.jsxs(h,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎉"}),e.jsx("p",{className:"text-gray-600",children:"All operations have been assigned!"}),e.jsx(v,{variant:"primary",onClick:u,className:"mt-4",children:"Refresh List"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(P,{className:"h-6 w-6 mr-2 text-purple-600"}),"Available Operators (",r.filter(t=>t.status==="active").length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[r.filter(t=>t.status==="active").map(t=>e.jsxs(h,{"data-operator-id":t.id,className:`p-4 transition-all duration-200 ${c==="tap"&&l?"cursor-pointer hover:shadow-lg hover:border-purple-300 hover:bg-purple-50":c==="drag"?"border-dashed border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50":"cursor-default"}`,onClick:()=>B(t),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(P,{className:"h-6 w-6 text-purple-600"})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ${t.status==="active"?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{variant:q(t.experience),size:"sm",children:t.experience}),e.jsx("span",{className:"text-xs text-gray-500",children:t.machineType})]})]})]}),c==="tap"&&l&&e.jsx(H,{className:"h-5 w-5 text-purple-600 animate-pulse"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Efficiency"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:[t.efficiency,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Workload"}),e.jsx("p",{className:"font-semibold text-orange-600",children:t.currentWorkload})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Status"}),e.jsx("p",{className:`font-semibold capitalize ${E(t.status)}`,children:t.status})]})]}),t.specialties.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Specialties:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.specialties.slice(0,2).map(n=>e.jsx(O,{variant:"outline",size:"sm",children:n},n)),t.specialties.length>2&&e.jsxs(O,{variant:"outline",size:"sm",children:["+",t.specialties.length-2]})]})]})]},t.id)),r.filter(t=>t.status==="active").length===0&&e.jsxs(h,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"😴"}),e.jsx("p",{className:"text-gray-600",children:"No operators available right now"}),e.jsx(v,{variant:"outline",onClick:u,className:"mt-4",children:"Refresh List"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-blue-600 font-bold",children:i.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Operations"})]}),e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-purple-600 font-bold",children:r.filter(t=>t.status==="active").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Operators"})]}),e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-green-600 font-bold",children:r.reduce((t,n)=>t+n.currentWorkload,0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Assignments"})]})]})]})};export{ne as DragDropAssignmentDashboard,ne as default};
