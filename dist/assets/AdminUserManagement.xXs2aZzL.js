import{j as e}from"./query-vendor.DpsghfSz.js";import{r as l}from"./react-vendor.CfKEcsXX.js";import{D as B,E as b,C as m,B as o,j as z,A as M,I as c,n as E,a as S}from"./index.CLAiwwTT.js";import{U as h,p as H}from"./permission-service.Bw3z8bJ_.js";import{F as O}from"./MagnifyingGlassIcon.BY4e_13K.js";import{F as k}from"./ShieldCheckIcon.7Wn9Ltzi.js";import{F as y}from"./UserIcon.BzFG2rMW.js";import{F as Q}from"./PencilIcon.8W3cwjlG.js";import"./ui-vendor.EZF4ucWh.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";function W({title:p,titleId:i,...f},g){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":i},f),p?l.createElement("title",{id:i},p):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const G=l.forwardRef(W),le=({adminId:p})=>{const[i,f]=l.useState([]),[g,C]=l.useState(!0),[U,j]=l.useState(null),[R,v]=l.useState(!1),[J,A]=l.useState(null),[d,L]=l.useState(""),[x,$]=l.useState("all"),[a,n]=l.useState({username:"",email:"",name:"",role:"supervisor",department:"",password:"",confirmPassword:""}),[w,F]=l.useState(!1);l.useEffect(()=>{u()},[]);const u=async()=>{try{C(!0),j(null);const s=await h.getAllUsers();if(s.success){const r=B(s.data).filter(t=>t.role==="admin"||t.role==="supervisor");f(r)}else j(s.error||"Failed to load users")}catch(s){j("Error loading users"),console.error("Error loading users:",s)}finally{C(!1)}},P=async s=>{if(s.preventDefault(),a.password!==a.confirmPassword){alert("Passwords do not match!");return}if(a.password.length<8){alert("Password must be at least 8 characters long!");return}try{F(!0);const r={username:a.username,email:a.email,name:a.name,role:a.role,department:a.department,active:!0,settings:{theme:"system",language:"en",notifications:{email:!0,push:!0,workAssignment:!0,qualityIssues:!0}}},t=await h.createUser(r);t.success?(t.data&&await H.setUserRole(t.data.id,a.role),alert(`${a.role.charAt(0).toUpperCase()+a.role.slice(1)} account created successfully!`),n({username:"",email:"",name:"",role:"supervisor",department:"",password:"",confirmPassword:""}),v(!1),await u()):alert(`Failed to create ${a.role}: ${t.error}`)}catch(r){alert(`Error creating ${a.role}`),console.error("Error creating user:",r)}finally{F(!1)}},D=async(s,r)=>{if(confirm(`Are you sure you want to delete user "${r}"? This action cannot be undone.`))try{const t=await h.deleteUser(s);t.success?(alert("User deleted successfully!"),await u()):alert(`Failed to delete user: ${t.error}`)}catch(t){alert("Error deleting user"),console.error("Error deleting user:",t)}},q=async(s,r)=>{try{const t=await h.updateUser(s,{active:!r});t.success?(alert(`User ${r?"deactivated":"activated"} successfully!`),await u()):alert(`Failed to update user status: ${t.error}`)}catch(t){alert("Error updating user status"),console.error("Error updating user status:",t)}},N=i.filter(s=>{const r=d===""||b(s.name).toLowerCase().includes(d.toLowerCase())||b(s.username).toLowerCase().includes(d.toLowerCase())||b(s.email).toLowerCase().includes(d.toLowerCase()),t=x==="all"||s.role===x;return r&&t}),I=s=>{switch(s){case"admin":return e.jsx(k,{className:"h-5 w-5 text-red-600"});case"supervisor":return e.jsx(y,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(y,{className:"h-5 w-5 text-gray-600"})}},T=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"supervisor":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"})}):U?e.jsxs(m,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:U}),e.jsx(o,{onClick:u,children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(z,{className:"h-8 w-8 text-blue-600"}),e.jsx("span",{children:"User Management"})]}),e.jsx("p",{className:"text-gray-600",children:"Create and manage admin and supervisor accounts"})]}),e.jsxs(o,{onClick:()=>v(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Create User"]})]}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(c,{type:"text",placeholder:"Search users by name, username, or email...",value:d,onChange:s=>L(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:x,onChange:s=>$(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"supervisor",children:"Supervisors"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Admin Accounts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.role==="admin").length})]})]})}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Supervisor Accounts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.role==="supervisor").length})]})]})}),e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-90vh overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New User Account"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{value:a.role,onChange:s=>n(r=>({...r,role:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"supervisor",children:"Supervisor"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx(c,{type:"text",value:a.name,onChange:s=>n(r=>({...r,name:s.target.value})),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),e.jsx(c,{type:"text",value:a.username,onChange:s=>n(r=>({...r,username:s.target.value.toLowerCase()})),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx(c,{type:"email",value:a.email,onChange:s=>n(r=>({...r,email:s.target.value})),placeholder:"Enter email address",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsx(c,{type:"text",value:a.department,onChange:s=>n(r=>({...r,department:s.target.value})),placeholder:"e.g., Production, Quality, Management"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),e.jsx(c,{type:"password",value:a.password,onChange:s=>n(r=>({...r,password:s.target.value})),placeholder:"Enter password (minimum 8 characters)",required:!0,minLength:8})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password *"}),e.jsx(c,{type:"password",value:a.confirmPassword,onChange:s=>n(r=>({...r,confirmPassword:s.target.value})),placeholder:"Confirm password",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>{v(!1),n({username:"",email:"",name:"",role:"supervisor",department:"",password:"",confirmPassword:""})},disabled:w,children:"Cancel"}),e.jsx(o,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:w,children:w?"Creating...":`Create ${a.role.charAt(0).toUpperCase()+a.role.slice(1)}`})]})]})]})}),e.jsxs(m,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-lg font-semibold",children:["Users (",N.length,")"]})}),N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:d||x!=="all"?"No users match your filters":"No users found"})]}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[I(s.role),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx(S,{className:T(s.role),children:s.role}),!s.active&&e.jsx(S,{variant:"secondary",children:"Inactive"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["@",s.username," • ",s.email]}),s.department&&e.jsx("p",{className:"text-xs text-gray-500",children:s.department})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>q(s.id,s.active),className:s.active?"text-orange-600 border-orange-600":"text-green-600 border-green-600",children:s.active?"Deactivate":"Activate"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>A(s),className:"text-blue-600 border-blue-600",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>D(s.id,s.name),className:"text-red-600 border-red-600",children:e.jsx(G,{className:"h-4 w-4"})})]})]})},s.id))})]})]})};export{le as default};
