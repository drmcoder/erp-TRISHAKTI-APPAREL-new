import{j as e}from"./query-vendor.DpsghfSz.js";import{r}from"./react-vendor.CfKEcsXX.js";import{m as A,C as n,F as B,I as F,a as x,B as g,n as D}from"./index.CUWf0ERd.js";import{L}from"./LoadingSpinner.DUO60hBS.js";import{F as O}from"./ClockIcon.B0z2Gpg3.js";import{F as W}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as E}from"./MagnifyingGlassIcon.BY4e_13K.js";import"./ui-vendor.D450QVBF.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const z=[{id:"bundle_1",bundleNumber:"BND-3233-M-001",articleId:"art_1",articleNumber:"3233",articleStyle:"Adult T-shirt",size:"M",rollId:"roll_1",rollNumber:"Roll1",rollColor:"Blue",templateId:"template_1",templateName:"3233 Template",templateCode:"3233",status:"created",priority:"normal",operations:[{id:"BND-3233-M-001-OP-1",bundleId:"bundle_1",operationId:"op_1",name:"Shoulder Join",nameNepali:"काँध जोड्ने",description:"Join front and back shoulders",machineType:"overlock",sequenceOrder:1,pricePerPiece:2.5,smvMinutes:4.5,status:"pending",prerequisites:[],isOptional:!1,qualityCheckRequired:!0,defectTolerance:5},{id:"BND-3233-M-001-OP-2",bundleId:"bundle_1",operationId:"op_2",name:"Side Seam",nameNepali:"छेउ सिलाई",description:"Sew side seams",machineType:"overlock",sequenceOrder:2,pricePerPiece:3,smvMinutes:5,status:"pending",prerequisites:["op_1"],isOptional:!1,qualityCheckRequired:!0,defectTolerance:5},{id:"BND-3233-M-001-OP-3",bundleId:"bundle_1",operationId:"op_3",name:"Sleeve Attach",nameNepali:"आस्तीन लगाउने",description:"Attach sleeves to body",machineType:"singleNeedle",sequenceOrder:3,pricePerPiece:4,smvMinutes:7,status:"pending",prerequisites:["op_2"],isOptional:!1,qualityCheckRequired:!0,defectTolerance:3}],createdAt:new Date,createdBy:"System",totalValue:9.5,totalSMV:16.5}],S=[{id:"DYNAMIC_OPERATOR_ID",name:"DYNAMIC_OPERATOR_NAME",machineType:"overlock",efficiency:94.5,currentWorkload:2},{id:"op_rajesh_002",name:"Rajesh Kumar",machineType:"singleNeedle",efficiency:91.2,currentWorkload:1},{id:"op_priya_003",name:"Priya Singh",machineType:"overlock",efficiency:89.8,currentWorkload:0},{id:"op_amit_004",name:"Amit Patel",machineType:"singleNeedle",efficiency:85.6,currentWorkload:3}],ae=({userRole:V="supervisor"})=>{const[c,k]=r.useState(z),[$,J]=r.useState(null),[l,j]=r.useState(null),[m,f]=r.useState(""),[d,C]=r.useState(""),[u,T]=r.useState("all"),[h,I]=r.useState("all"),[N,y]=r.useState(!1),[M,o]=r.useState(!1),v=()=>{const s=[];return c.forEach(a=>{a.operations.forEach(t=>{t.status==="pending"&&(t.prerequisites.every(q=>a.operations.some(w=>w.operationId===q&&w.status==="completed"))||t.prerequisites.length===0)&&s.push({...t,bundleInfo:a})})}),s},p=v().filter(s=>{const a=d===""||s.name.toLowerCase().includes(d.toLowerCase())||s.bundleInfo.bundleNumber.toLowerCase().includes(d.toLowerCase())||s.bundleInfo.articleNumber.toLowerCase().includes(d.toLowerCase()),t=u==="all"||s.status===u,i=h==="all"||s.machineType===h;return a&&t&&i}),b=s=>S.filter(a=>a.machineType===s),_=async()=>{if(!(!l||!m)){y(!0);try{await new Promise(a=>setTimeout(a,1e3));const s=S.find(a=>a.id===m);if(!s)return;k(a=>a.map(t=>({...t,operations:t.operations.map(i=>i.id===l.id?{...i,status:"assigned",assignedOperatorId:s.id,assignedOperatorName:s.name,assignedAt:new Date}:i)}))),o(!1),j(null),f("")}catch(s){console.error("Assignment failed:",s),alert("Failed to assign operation. Please try again.")}finally{y(!1)}}},P=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"assigned":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-purple-100 text-purple-800";case"completed":return"bg-green-100 text-green-800";case"quality_failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=s=>{switch(s){case"overlock":return"⚡";case"singleNeedle":return"🪡";case"doubleNeedle":return"🪡🪡";default:return"🔧"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(A,{className:"h-8 w-8 text-blue-600"}),e.jsx("span",{children:"Bundle Assignment"})]}),e.jsx("p",{className:"text-gray-600",children:"Assign operations to operators for production"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(A,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Bundles"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:c.length})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Available Ops"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:v().length})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Assigned Ops"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:c.reduce((s,a)=>s+a.operations.filter(t=>t.status==="assigned").length,0)})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(W,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["Rs. ",c.reduce((s,a)=>s+a.totalValue,0).toFixed(2)]})]})]})})]}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(F,{placeholder:"Search operations, bundles, articles...",value:d,onChange:s=>C(s.target.value),className:"pl-10"})]})}),e.jsxs("select",{value:u,onChange:s=>T(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Available"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs("select",{value:h,onChange:s=>I(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Machines"}),e.jsx("option",{value:"overlock",children:"Overlock"}),e.jsx("option",{value:"singleNeedle",children:"Single Needle"}),e.jsx("option",{value:"doubleNeedle",children:"Double Needle"})]})]})}),e.jsxs(n,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Available Operations (",p.length,")"]})}),p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No operations available"}),e.jsx("p",{className:"text-gray-500",children:"All operations are either assigned or waiting for prerequisites."})]}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsx(x,{variant:"secondary",className:"font-mono text-xs",children:s.bundleInfo.bundleNumber}),e.jsx("span",{className:"text-lg",children:R(s.machineType)}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.nameNepali,")"]}),e.jsx(x,{className:P(s.status),children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Article:"}),e.jsxs("span",{className:"font-medium ml-1",children:[s.bundleInfo.articleNumber," (",s.bundleInfo.size,")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Machine:"}),e.jsx("span",{className:"font-medium ml-1 capitalize",children:s.machineType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Price:"}),e.jsxs("span",{className:"font-medium text-green-600 ml-1",children:["Rs. ",s.pricePerPiece]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"SMV:"}),e.jsxs("span",{className:"font-medium text-blue-600 ml-1",children:[s.smvMinutes," min"]})]})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s.description})]}),e.jsxs("div",{className:"ml-4",children:[s.status==="pending"&&e.jsxs(g,{onClick:()=>{j(s),o(!0)},className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Assign"})]}),s.status==="assigned"&&s.assignedOperatorName&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600",children:s.assignedOperatorName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Assigned ",s.assignedAt?new Date(s.assignedAt).toLocaleDateString():""]})]})]})]})},s.id))})]}),M&&l&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:()=>o(!1)}),e.jsxs("div",{className:"inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Assign Operation"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-500",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Bundle: ",c.find(s=>s.id===l.bundleId)?.bundleNumber]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Machine: ",l.machineType," | Price: Rs. ",l.pricePerPiece]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Operator (",l.machineType,")"]}),e.jsxs("select",{value:m,onChange:s=>f(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Choose operator..."}),b(l.machineType).map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.efficiency,"% efficiency (",s.currentWorkload," jobs)"]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Available Operators:"}),b(l.machineType).map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(x,{variant:"outline",children:[s.efficiency,"%"]}),e.jsxs(x,{variant:s.currentWorkload===0?"success":s.currentWorkload<=2?"warning":"danger",children:[s.currentWorkload," jobs"]})]})]},s.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(g,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(g,{onClick:_,disabled:!m||N,children:N?e.jsx(L,{size:"sm"}):"Assign Operation"})]})]})]})})]})};export{ae as BundleAssignmentDashboard,ae as default};
