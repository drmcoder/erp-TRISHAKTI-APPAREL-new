import{j as e}from"./query-vendor.DpsghfSz.js";import{r as n}from"./react-vendor.CfKEcsXX.js";import{a as c,C as y,i as $,I as P,B as N,z as J}from"./index.B3OoR7j1.js";import{L as T}from"./LoadingSpinner.rP8tyFue.js";import{E as K,F as Q}from"./empty-state.n-hYHaS-.js";import{u as U,a as V,b as X,c as _}from"./use-work-assignments.CevcF46Y.js";import{F as I}from"./MagnifyingGlassIcon.BY4e_13K.js";import{F as ee}from"./ChartBarIcon.CTULyxD7.js";import{F as se}from"./ClockIcon.B0z2Gpg3.js";import{F as ae}from"./CurrencyRupeeIcon.7xrTRvUQ.js";import"./ui-vendor.D5U9TC-3.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";import"./index.DNGanYzG.js";function te({title:l,titleId:p,...o},g){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":p},o),l?n.createElement("title",{id:p},l):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const W=n.forwardRef(te),je=({operatorId:l,operatorName:p,operatorSkills:o,maxConcurrentWork:g,onRequestSubmitted:z})=>{const[d,E]=n.useState(""),[f,O]=n.useState("all"),[m,j]=n.useState(null),[L,w]=n.useState(""),{data:C,isLoading:k}=U(l),{data:S,isLoading:Z}=V(l),{data:q}=X(l),b=_(),A=C?.success?C.data||[]:[],F=S?.success?S.data||[]:[],R=q?.success?q.data?.items||[]:[],x=n.useMemo(()=>A.map(s=>{const a=F.find(i=>i.id===s.id),t=M(s,o);return{...s,recommendationScore:a?.recommendationScore,recommendationReasons:a?.recommendationReasons,estimatedCompletion:a?.estimatedCompletion,compatibilityLevel:t.level,isRecommended:!!a&&a.recommendationScore>75}}),[A,F,o]),r=n.useMemo(()=>{let s=x;if(d){const a=d.toLowerCase();s=s.filter(t=>t.operation.toLowerCase().includes(a)||t.machineType.toLowerCase().includes(a)||t.bundleId.toLowerCase().includes(a))}switch(f){case"recommended":s=s.filter(a=>a.isRecommended);break;case"compatible":s=s.filter(a=>a.compatibilityLevel==="perfect"||a.compatibilityLevel==="good");break}return s.sort((a,t)=>{if(a.isRecommended&&!t.isRecommended)return-1;if(!a.isRecommended&&t.isRecommended)return 1;const i=a.recommendationScore||0,u=t.recommendationScore||0;if(i!==u)return u-i;const h={perfect:4,good:3,acceptable:2,challenging:1};return h[t.compatibilityLevel]-h[a.compatibilityLevel]})},[x,d,f]),D=async s=>{try{await b.mutateAsync({workItemId:s.id,operatorId:l,reason:L||`Self-assignment request for ${s.operation}`}),j(null),w(""),z?.(s.id)}catch(a){console.error("Failed to create assignment request:",a)}};function M(s,a){const t=[];let i=0;a.primaryMachine===s.machineType?(i+=30,t.push("Primary machine match")):a.machineTypes.includes(s.machineType)?(i+=20,t.push("Machine compatible")):(i-=20,t.push("Machine type mismatch"));const u=["beginner","intermediate","advanced","expert"],h=u.indexOf(a.skillLevel),B=u.indexOf(s.skillLevelRequired);if(h>=B?(i+=25,h===B?t.push("Perfect skill level match"):t.push("Overqualified (good for quality)")):(i-=15,t.push("Requires higher skill level")),a.specializations?.length){const H=Y(s.operation);a.specializations.includes(H)&&(i+=15,t.push("Specialization match"))}return i>=60?{level:"perfect",reasons:t}:i>=40?{level:"good",reasons:t}:i>=20?{level:"acceptable",reasons:t}:{level:"challenging",reasons:t}}function Y(s){const a=s.toLowerCase();return a.includes("cut")?"cutting":a.includes("sew")||a.includes("stitch")?"sewing":a.includes("embroi")?"embroidery":a.includes("finish")||a.includes("press")?"finishing":"general"}const G=s=>{switch(s){case"perfect":return"border-green-500 bg-green-50";case"good":return"border-blue-500 bg-blue-50";case"acceptable":return"border-yellow-500 bg-yellow-50";case"challenging":return"border-red-500 bg-red-50";default:return"border-gray-200"}},v=R.length<g;return k||Z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Available Work"}),e.jsxs("p",{className:"text-gray-600",children:["Browse and request work assignments â€¢ ",p]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(c,{variant:v?"success":"warning",children:[R.length,"/",g," assignments"]})})]}),!v&&e.jsx(y,{className:"p-4 border-orange-200 bg-orange-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-800 font-medium",children:"At Maximum Capacity"}),e.jsxs("p",{className:"text-orange-700 text-sm",children:["You're currently assigned to ",R.length," work items. Complete some assignments to take on new work."]})]})]})}),e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(P,{placeholder:"Search by operation, machine type, or bundle...",value:d,onChange:s=>E(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("select",{value:f,onChange:s=>O(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsxs("option",{value:"all",children:["All Work (",x.length,")"]}),e.jsxs("option",{value:"recommended",children:["ðŸŒŸ Recommended (",x.filter(s=>s.isRecommended).length,")"]}),e.jsxs("option",{value:"compatible",children:["âœ… Compatible (",x.filter(s=>s.compatibilityLevel==="perfect"||s.compatibilityLevel==="good").length,")"]})]})})]})}),e.jsx("div",{children:r.length===0?e.jsx(K,{icon:ee,title:"No work items found",description:d||f!=="all"?"Try adjusting your search or filters":"No work items are currently available for self-assignment"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(s=>e.jsxs(y,{className:`p-4 transition-all duration-200 hover:shadow-md ${G(s.compatibilityLevel)} ${s.isRecommended?"ring-2 ring-blue-400":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.operation}),s.isRecommended&&e.jsx(W,{className:"h-4 w-4 text-blue-500"})]}),e.jsx(c,{variant:s.isRecommended?"primary":"secondary",className:"text-xs",children:s.compatibilityLevel})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.machineType})]}),e.jsx(c,{variant:"outline",className:"text-xs",children:s.skillLevelRequired})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[s.estimatedDuration,"min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:["â‚¹",(s.ratePerPiece*s.targetPieces).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Bundle: ",s.bundleId]}),e.jsxs("span",{className:"text-gray-600",children:[s.targetPieces," pieces"]})]})]}),s.isRecommended&&s.recommendationReasons&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-1",children:[e.jsx(W,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"AI Recommendation"}),e.jsxs(c,{variant:"primary",className:"text-xs",children:[s.recommendationScore,"% match"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.recommendationReasons.slice(0,2).map((a,t)=>e.jsx(c,{variant:"outline",className:"text-xs",children:a},t))})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:M(s,o).reasons.slice(0,3).map((a,t)=>e.jsx(c,{variant:"outline",className:`text-xs ${a.includes("mismatch")||a.includes("higher skill")?"text-red-600 border-red-300":"text-green-600 border-green-300"}`,children:a},t))})}),s.estimatedCompletion&&e.jsx("div",{className:"mb-4 text-xs text-gray-600",children:e.jsxs("span",{children:["Est. completion: ",s.estimatedCompletion.toLocaleDateString()]})}),e.jsx(N,{onClick:()=>j(s.id),disabled:!v||b.isPending,className:"w-full",variant:s.isRecommended?"default":"outline",children:v?"Request Assignment":"At Capacity"}),s.isBlocked&&e.jsxs("div",{className:"mt-2 flex items-center space-x-1 text-red-600",children:[e.jsx($,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:["Blocked: ",s.blockingReason]})]})]},s.id))})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(y,{className:"max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Request Assignment"}),e.jsx(N,{variant:"ghost",onClick:()=>j(null),className:"p-1",children:e.jsx(J,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Request assignment for this work item? Your request will be reviewed by a supervisor."}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded border",children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.find(s=>s.id===m)?.operation}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.find(s=>s.id===m)?.machineType," â€¢",r.find(s=>s.id===m)?.targetPieces," pieces"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (optional)"}),e.jsx(P,{placeholder:"Why do you want this assignment?",value:L,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(N,{variant:"ghost",onClick:()=>j(null),className:"flex-1",children:"Cancel"}),e.jsx(N,{onClick:()=>{const s=r.find(a=>a.id===m);D(s)},disabled:b.isPending,className:"flex-1",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Submitting..."})]}):"Submit Request"})]})]})})]})};export{je as SelfAssignmentInterface,je as default};
