const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.B3OoR7j1.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.D5U9TC-3.js","assets/firebase-vendor.D8xw0AXf.js","assets/utils-vendor.B0NEtgzl.js","assets/index.CZ3Rcx0c.css"])))=>i.map(i=>d[i]);
import{B as N,C as m,p as G,a as j,_ as A}from"./index.B3OoR7j1.js";import{j as e}from"./query-vendor.DpsghfSz.js";import{r as g}from"./react-vendor.CfKEcsXX.js";import{u as H}from"./useI18n.Cd33OMab.js";import{L as V}from"./LoadingSpinner.rP8tyFue.js";import{EnhancedBundleService as k}from"./enhanced-bundle-service.CeWC5GFY.js";import{F as R}from"./ClockIcon.B0z2Gpg3.js";import{F as J}from"./HandRaisedIcon.Cfns5nHo.js";import{F as K}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as E}from"./UserIcon.BzFG2rMW.js";import{F as Z}from"./ArrowRightIcon.DKQtkxcN.js";import"./ui-vendor.D5U9TC-3.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const he=({userRole:ee})=>{const{currentLocale:F}=H(),[y,v]=g.useState([]),[h,$]=g.useState([]),[L,I]=g.useState(!0),[c,T]=g.useState("tap"),[o,O]=g.useState(null),P=s=>F==="ne"&&s.nameNepali||s.name,[x,S]=g.useState({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}});g.useEffect(()=>{D()},[]);const D=async()=>{I(!0);try{console.log("🔍 Drag & Drop: Loading ALL unassigned operations from production lots...");const[s,a]=await Promise.all([k.getUnassignedBundleOperations(),k.getAvailableOperators()]);if(s.success&&s.data){console.log(`✅ Found ${s.data.length} unassigned operations for drag & drop`);const n=s.data.map(t=>({id:t.id,bundleId:t.bundleId,operationId:t.id,name:t.operation,nameNepali:t.operationNepali,sequenceOrder:1,machineType:t.machineType,status:t.status,assignedOperator:null,targetPieces:t.targetPieces||50,completedPieces:0,pricePerPiece:t.pricePerPiece||5,smvMinutes:t.smvMinutes||5,prerequisites:[],isOptional:!1,qualityCheckRequired:!1,defectTolerance:5,operationName:t.operation,operationNameNepali:t.operationNepali,skillLevel:t.requiredSkill||"basic",quantity:t.targetPieces||50,priority:t.priority||"normal",bundleInfo:{id:t.bundleId,bundleNumber:t.bundleNumber||`Bundle-${t.bundleId?.substring(0,8)}`,articleNumber:t.articleNumber||"ART001",description:`${t.garmentType||"Garment"} - ${t.operation}`,garmentType:t.garmentType||"Shirt",targetQuantity:t.targetPieces||50,createdDate:new Date,priority:t.priority||"normal",status:"in_production",dueDate:t.dueDate,batchNumber:t.lotNumber||"LOT001",quantity:t.targetPieces||50}}));console.log(`📦 Formatted ${n.length} operations for assignment UI`),v(n),n.length===0&&console.log("🎉 All operations have been assigned! No unassigned work found.")}else console.log("⚠️ No unassigned operations found or failed to load"),v([]);a.success&&a.data&&(console.log(`✅ Found ${a.data.length} operators for assignment`),$(a.data))}catch(s){console.error("❌ Failed to load drag & drop assignment data:",s),v([])}finally{I(!1)}},C=(s,a)=>{if(c!=="drag")return;s.preventDefault();const n=s.touches[0],t=s.currentTarget.getBoundingClientRect();S({isDragging:!0,draggedOperation:a,dragSource:{x:n.clientX,y:n.clientY},touchOffset:{x:n.clientX-t.left,y:n.clientY-t.top}})},M=s=>{if(!x.isDragging||!x.draggedOperation)return;s.preventDefault();const a=s.touches[0];S(n=>({...n,dragSource:{x:a.clientX,y:a.clientY}}))},B=s=>{if(!x.isDragging||!x.draggedOperation)return;const a=s.changedTouches[0],t=document.elementFromPoint(a.clientX,a.clientY)?.closest("[data-operator-id]");if(t){const f=t.getAttribute("data-operator-id"),w=h.find(b=>b.id===f);w&&_(x.draggedOperation,w)}S({isDragging:!1,draggedOperation:null,dragSource:{x:0,y:0},touchOffset:{x:0,y:0}})},q=s=>{c==="tap"&&O(o?.id===s.id?null:s)},z=s=>{c!=="tap"||!o||(_(o,s),O(null))},_=async(s,a)=>{console.log("🎯 Starting assignment process:",{operation:s.name,operator:a.name});try{console.log("🔧 Using simplified assignment logic for drag & drop");const{updateDoc:n,doc:t}=await A(async()=>{const{updateDoc:i,doc:r}=await import("./firebase-vendor.D8xw0AXf.js").then(d=>d.al);return{updateDoc:i,doc:r}},[]),{db:f}=await A(async()=>{const{db:i}=await import("./index.B3OoR7j1.js").then(r=>r.O);return{db:i}},__vite__mapDeps([0,1,2,3,4,5,6])),w=await A(async()=>{const{query:i,collection:r,where:d,getDocs:u}=await import("./firebase-vendor.D8xw0AXf.js").then(l=>l.al);return{query:i,collection:r,where:d,getDocs:u}},[]).then(({query:i,collection:r,where:d,getDocs:u})=>u(i(r(f,"production_lots"),d("status","!=","completed"))));let b=!1;for(const i of w.docs){const r=i.data();let d=!1;if(r.processSteps&&Array.isArray(r.processSteps)){const u=r.processSteps.map(l=>l.id===s.id||l.operation===s.operation?(console.log(`✅ Found operation ${l.operation} in lot ${i.id}, assigning to ${a.name}`),d=!0,{...l,assignedOperators:[{operatorId:a.id,operatorName:a.name,assignedAt:new Date().toISOString(),targetPieces:l.targetPieces||50}],status:"in_progress",assignedAt:new Date().toISOString()}):l);if(d){await n(t(f,"production_lots",i.id),{processSteps:u,lastUpdated:new Date().toISOString()}),b=!0,console.log(`✅ Successfully assigned ${s.operation} to ${a.name} in lot ${i.id}`);break}}else if(r.bundles&&Array.isArray(r.bundles)){const u=r.bundles.map(l=>{if(l.operations&&Array.isArray(l.operations)){const Y=l.operations.map(p=>p.id===s.id||p.operation===s.operation&&p.id===s.id?(console.log(`✅ Found operation ${p.operation} in bundle ${l.bundleNumber}, assigning to ${a.name}`),d=!0,{...p,assignedOperatorId:a.id,assignedOperatorName:a.name,assignedAt:new Date().toISOString(),status:"assigned"}):p);return{...l,operations:Y}}return l});if(d){await n(t(f,"production_lots",i.id),{bundles:u,lastUpdated:new Date().toISOString()}),b=!0,console.log(`✅ Successfully assigned ${s.operation} to ${a.name} in lot ${i.id} (legacy)`);break}}}if(b)v(i=>i.filter(r=>r.id!==s.id)),$(i=>i.map(r=>r.id===a.id?{...r,currentWorkload:r.currentWorkload+1}:r)),U(`✅ ${s.operation} assigned to ${a.name}`),console.log("🎉 Assignment completed successfully");else throw new Error(`Operation ${s.operation} not found in any production lot`)}catch(n){console.error("❌ Assignment failed:",n),W(`❌ Assignment failed: ${n instanceof Error?n.message:"Please try again."}`)}},U=s=>{console.log("Success:",s)},W=s=>{console.error("Error:",s)},Q=s=>{switch(s){case"expert":return"success";case"intermediate":return"warning";case"beginner":return"info";default:return"secondary"}},X=s=>{switch(s){case"active":return"text-green-600";case"break":return"text-yellow-600";case"offline":return"text-red-600";default:return"text-gray-600"}};return L?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(V,{}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading assignment dashboard..."})]}):e.jsxs("div",{className:"p-4 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🎯 Drag & Drop Assignment"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Assign operations to operators with ease"})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-lg",children:[e.jsx(N,{variant:c==="tap"?"primary":"ghost",size:"sm",onClick:()=>T("tap"),className:"text-xs",children:"👆 Tap Mode"}),e.jsx(N,{variant:c==="drag"?"primary":"ghost",size:"sm",onClick:()=>T("drag"),className:"text-xs",children:"🤏 Drag Mode"})]})]}),e.jsx(m,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:"💡"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"How to Assign:"}),c==="tap"?e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Tap on a bundle operation below → 2. Tap on an operator → Done! ✅"}):e.jsx("p",{className:"text-blue-800 text-sm mt-1",children:"1. Press and hold a bundle operation → 2. Drag to an operator → Release! ✅"})]})]})}),c==="tap"&&o&&e.jsx(m,{className:"p-4 bg-green-50 border-green-200 border-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Selected Operation:"}),e.jsxs("p",{className:"text-green-800",children:[P(o)," - ",o.bundleInfo.bundleNumber]})]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>O(null),className:"text-green-700",children:"✕ Cancel"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(R,{className:"h-6 w-6 mr-2 text-blue-600"}),"Available Work (",y.length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[y.map(s=>e.jsx(m,{className:`p-4 cursor-pointer transition-all duration-200 ${o?.id===s.id?"border-green-500 border-2 bg-green-50 shadow-lg":"hover:shadow-lg hover:border-blue-300"} ${x.isDragging&&x.draggedOperation?.id===s.id?"opacity-50 transform scale-95":""}`,onTouchStart:a=>C(a,s),onTouchMove:M,onTouchEnd:B,onClick:()=>q(s),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(G,{className:"h-5 w-5 text-blue-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:P(s)})})]}),c==="drag"&&e.jsx("div",{className:"flex items-center text-gray-400",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-800 font-medium",children:["📦 ",e.jsx("strong",{children:s.bundleInfo.bundleNumber})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["🏷️ Batch: ",s.bundleInfo.batchNumber||"B001"," • ",s.bundleInfo.targetQuantity||50," pieces"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),s.smvMinutes,"min/piece"]}),e.jsxs("div",{className:"flex items-center text-blue-600 font-medium",children:["⏱️ Total: ",Math.round((s.bundleInfo.targetQuantity||50)*s.smvMinutes/60),"h"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"$",s.pricePerPiece,"/piece"]}),e.jsxs("div",{className:"flex items-center text-green-700 font-bold",children:["💰 $",((s.bundleInfo.targetQuantity||50)*s.pricePerPiece).toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"text-blue-800 font-medium mb-1",children:"🔍 Last Done By:"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"👷 Maya Patel"}),e.jsx("span",{className:"text-yellow-600",children:"⭐ 9.2/10"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-blue-600",children:"📅 2 days ago"}),e.jsx("span",{className:"text-green-600",children:"⚡ 94% efficiency"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(j,{variant:"outline",className:"text-xs",children:["🔧 ",s.machineType]}),e.jsx(j,{variant:s.bundleInfo.priority==="high"||s.bundleInfo.priority==="urgent"?"destructive":"secondary",className:"text-xs",children:s.bundleInfo.priority==="high"?"🔥 HIGH":s.bundleInfo.priority==="urgent"?"⚡ URGENT":s.bundleInfo.priority==="low"?"📋 LOW":"➖ NORMAL"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["📅 Due: ",s.bundleInfo.dueDate?new Date(s.bundleInfo.dueDate).toLocaleDateString():"Today"]})]})]})},s.id)),y.length===0&&e.jsxs(m,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎉"}),e.jsx("p",{className:"text-gray-600",children:"All operations have been assigned!"}),e.jsx(N,{variant:"primary",onClick:D,className:"mt-4",children:"Refresh List"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(E,{className:"h-6 w-6 mr-2 text-purple-600"}),"Available Operators (",h.filter(s=>s.status==="active").length,")"]})}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[h.filter(s=>s.status==="active").map(s=>e.jsxs(m,{"data-operator-id":s.id,className:`p-4 transition-all duration-200 ${c==="tap"&&o?"cursor-pointer hover:shadow-lg hover:border-purple-300 hover:bg-purple-50":c==="drag"?"border-dashed border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50":"cursor-default"}`,onClick:()=>z(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-full",children:e.jsx(E,{className:"h-6 w-6 text-purple-600"})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ${s.status==="active"?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{variant:Q(s.experience),size:"sm",children:s.experience}),e.jsx("span",{className:"text-xs text-gray-500",children:s.machineType})]})]})]}),c==="tap"&&o&&e.jsx(Z,{className:"h-5 w-5 text-purple-600 animate-pulse"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Efficiency"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:[s.efficiency,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Workload"}),e.jsx("p",{className:"font-semibold text-orange-600",children:s.currentWorkload})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Status"}),e.jsx("p",{className:`font-semibold capitalize ${X(s.status)}`,children:s.status})]})]}),s.specialties.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Specialties:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.specialties.slice(0,2).map(a=>e.jsx(j,{variant:"outline",size:"sm",children:a},a)),s.specialties.length>2&&e.jsxs(j,{variant:"outline",size:"sm",children:["+",s.specialties.length-2]})]})]})]},s.id)),h.filter(s=>s.status==="active").length===0&&e.jsxs(m,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"😴"}),e.jsx("p",{className:"text-gray-600",children:"No operators available right now"}),e.jsx(N,{variant:"outline",onClick:D,className:"mt-4",children:"Refresh List"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-blue-600 font-bold",children:y.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Operations"})]}),e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-purple-600 font-bold",children:h.filter(s=>s.status==="active").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Operators"})]}),e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl text-green-600 font-bold",children:h.reduce((s,a)=>s+a.currentWorkload,0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Assignments"})]})]})]})};export{he as DragDropAssignmentDashboard,he as default};
