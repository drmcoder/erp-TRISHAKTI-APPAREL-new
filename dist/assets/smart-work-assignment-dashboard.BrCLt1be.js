const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.BVzmBZ5p.js","assets/firebase-vendor.D8xw0AXf.js","assets/index.CUWf0ERd.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.D450QVBF.js","assets/utils-vendor.B0NEtgzl.js","assets/index.CF9gheD0.css","assets/enhanced-bundle-service.4aZXwVEN.js"])))=>i.map(i=>d[i]);
import{_ as C,B as g,C as p,F as O,a as T}from"./index.CUWf0ERd.js";import{j as e}from"./query-vendor.DpsghfSz.js";import{r as l}from"./react-vendor.CfKEcsXX.js";import{L as U}from"./LoadingSpinner.DUO60hBS.js";import{EnhancedBundleService as q}from"./enhanced-bundle-service.4aZXwVEN.js";import{F as _}from"./MagnifyingGlassIcon.BY4e_13K.js";import{F as G}from"./LightBulbIcon.CK1_Ki40.js";import{F as K}from"./HashtagIcon.BDWlCnOX.js";import{F as X}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as J}from"./ClockIcon.B0z2Gpg3.js";import{F as $}from"./UserIcon.BzFG2rMW.js";import"./ui-vendor.D450QVBF.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";function Q({title:h,titleId:c,...f},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":c},f),h?l.createElement("title",{id:c},h):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const Y=l.forwardRef(Q);function ee({title:h,titleId:c,...f},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":c},f),h?l.createElement("title",{id:c},h):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z"}))}const se=l.forwardRef(ee);function te({title:h,titleId:c,...f},x){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":c},f),h?l.createElement("title",{id:c},h):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const ae=l.forwardRef(te),we=({userRole:h})=>{const[c,f]=l.useState([]),[x,j]=l.useState([]),[B,P]=l.useState(!0),[M,D]=l.useState("grid"),[w,E]=l.useState(""),[m,S]=l.useState({priority:"all",status:"all",machineType:"all",articleNumber:"all"}),[F,R]=l.useState("priority"),[y,b]=l.useState([]),[re,ie]=l.useState(null),[v,A]=l.useState("individual"),[le,W]=l.useState(!1),[L,V]=l.useState({});l.useEffect(()=>{z()},[]);const z=async()=>{P(!0);try{const{workAssignmentService:s}=await C(async()=>{const{workAssignmentService:t}=await import("./index.BVzmBZ5p.js");return{workAssignmentService:t}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{operatorService:i}=await C(async()=>{const{operatorService:t}=await import("./index.CUWf0ERd.js").then(a=>a.P);return{operatorService:t}},__vite__mapDeps([2,3,4,5,1,6,7]));console.log("🔍 Smart Assignment: Loading work from production lots (correct workflow)...");const n=await s.getWorkBundles();let o=[];if(n.success&&n.data&&n.data.items.length>0)console.log(`✅ Found ${n.data.items.length} production lots with work`),o=n.data.items.map(t=>(console.log("📦 Processing production lot bundle:",{id:t.id,bundleNumber:t.bundleNumber,articleNumber:t.articleNumber,totalPieces:t.totalPieces,status:t.status}),{id:t.id,bundleNumber:t.bundleNumber,articleNumber:t.articleNumber,articleStyle:t.articleStyle||t.articleNumber||"Unknown Style",priority:t.priority||"normal",status:t.status==="pending"?"created":t.status==="in-progress"?"in_progress":t.status==="completed"?"completed":"created",sizes:t.sizes||["M"],colors:t.colors||["White"],totalPieces:t.totalPieces||0,estimatedTime:t.estimatedTime||180,totalValue:t.totalValue||0,dueDate:t.dueDate?new Date(t.dueDate):new Date(Date.now()+10080*60*1e3),createdDate:t.createdDate?new Date(t.createdDate):new Date,operations:t.workItems||[{id:`op_${t.id}_main`,name:"Main Operation",nameNepali:"मुख्य काम",machineType:"sewing",requiredSkill:"basic_sewing",timePerPiece:3,pricePerPiece:2,status:"pending"}]})),console.log(`✅ Smart Assignment: Processed ${o.length} production lot bundles for display`);else{console.log("⚠️ No production lots found. Running bundle generation process...");try{console.log("🔧 Generating production lots from WIP entries...");const t=await q.generateProductionLotsFromWIP();if(t.success){console.log(`🎉 Generated ${t.data?.generated||0} production lots`);const a=await s.getWorkBundles();a.success&&a.data?.items.length>0&&(o=a.data.items.map(r=>({id:r.id,bundleNumber:r.bundleNumber,articleNumber:r.articleNumber,articleStyle:r.articleStyle||r.articleNumber||"Generated Bundle",priority:r.priority||"normal",status:"created",sizes:r.sizes||["M"],colors:r.colors||["White"],totalPieces:r.totalPieces||50,estimatedTime:r.estimatedTime||180,totalValue:r.totalValue||250,dueDate:r.dueDate?new Date(r.dueDate):new Date(Date.now()+10080*60*1e3),createdDate:r.createdDate?new Date(r.createdDate):new Date,operations:r.workItems||[{id:`op_${r.id}_main`,name:"Main Operation",nameNepali:"मुख्य काम",machineType:"sewing",requiredSkill:"basic_sewing",timePerPiece:3,pricePerPiece:2,status:"pending"}]})),console.log(`✅ Loaded ${o.length} generated production lot bundles`))}else console.log("⚠️ Bundle generation failed:",t.error)}catch(t){console.error("Failed to generate production lots:",t)}}f(o);const d=await i.getAllOperators();if(d.success&&d.data){console.log("🔍 Smart Dashboard: Raw operators from Firebase:",d.data);const t=d.data.map(a=>{const r={id:a.id||"unknown",name:a.name||"Unknown Operator",machineType:a.primaryMachine||a.machineTypes?.[0]||"overlock",skillLevel:a.skillLevel||"intermediate",efficiency:a.averageEfficiency||85,currentWorkload:a.currentAssignments?.length||0,maxCapacity:a.maxConcurrentWork||3,specialties:a.machineTypes||[],status:a.isActive?a.availabilityStatus==="available"?"available":a.availabilityStatus==="working"?"busy":a.availabilityStatus==="break"?"break":"available":"offline",hourlyRate:150,todayEarnings:Math.floor(Math.random()*500)};return console.log("🔄 Smart Dashboard: Transformed operator:",r),r});console.log("✅ Smart Dashboard: Final operators:",t),j(t)}else{console.log("⚠️ Smart Dashboard: No operators found, creating sample data...");try{await(await C(()=>import("./enhanced-bundle-service.4aZXwVEN.js"),__vite__mapDeps([8,2,3,4,5,1,6,7]))).default.createSampleOperators();const a=await i.getAllOperators();if(a.success&&a.data){const r=a.data.map(u=>({id:u.id||"unknown",name:u.name||"Unknown Operator",machineType:u.primaryMachine||u.machineTypes?.[0]||"overlock",skillLevel:u.skillLevel||"intermediate",efficiency:u.averageEfficiency||85,currentWorkload:u.currentAssignments?.length||0,maxCapacity:u.maxConcurrentWork||3,specialties:u.machineTypes||[],status:u.isActive?"available":"offline",hourlyRate:150,todayEarnings:Math.floor(Math.random()*500)}));j(r)}else j([])}catch(t){console.error("Failed to create sample operators:",t),j([])}}}catch(s){console.error("Failed to load work assignment data:",s),f([]),j([])}finally{P(!1)}},N=[...c.filter(s=>{const i=s.bundleNumber.toLowerCase().includes(w.toLowerCase())||s.articleNumber.includes(w)||s.articleStyle.toLowerCase().includes(w.toLowerCase()),n=m.priority==="all"||s.priority===m.priority,o=m.status==="all"||s.status===m.status,d=m.articleNumber==="all"||s.articleNumber===m.articleNumber,t=m.machineType==="all"||s.operations.some(a=>a.machineType===m.machineType);return i&&n&&o&&d&&t})].sort((s,i)=>{switch(F){case"priority":const n={urgent:4,high:3,normal:2,low:1};return n[i.priority]-n[s.priority];case"value":return i.totalValue-s.totalValue;case"bundleNumber":return s.bundleNumber.localeCompare(i.bundleNumber);default:return 0}}),k=x.filter(s=>s.status==="available"&&s.currentWorkload<s.maxCapacity),I=s=>{b(i=>i.includes(s)?i.filter(n=>n!==s):[...i,s])},Z=async()=>{if(y.length===0){alert("Please select bundles to assign");return}const s={};for(const i of y){const n=c.find(o=>o.id===i);if(n)for(const o of n.operations){const d=k.filter(t=>t.machineType===o.machineType&&t.specialties.includes(o.requiredSkill)&&t.currentWorkload<t.maxCapacity);if(d.length>0){const t=d.reduce((a,r)=>r.efficiency-r.currentWorkload*10>a.efficiency-a.currentWorkload*10?r:a);s[`${i}_${o.id}`]=t.id,j(a=>a.map(r=>r.id===t.id?{...r,currentWorkload:r.currentWorkload+1}:r))}}}V(i=>({...i,...s})),b([]),alert(`✅ Smart assignment completed!
Assigned ${Object.keys(s).length} operations to operators.`)},H=s=>{switch(s){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(U,{label:"Loading smart assignment dashboard..."})}):e.jsxs("div",{className:"p-4 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:"🧠 Smart Work Assignment"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Efficiently assign ",c.length," bundles to ",x.length," operators with smart algorithms"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white p-2 rounded-lg border",children:[e.jsx(g,{variant:v==="individual"?"primary":"outline",size:"sm",onClick:()=>A("individual"),children:"👤 Individual"}),e.jsx(g,{variant:v==="bulk"?"primary":"outline",size:"sm",onClick:()=>A("bulk"),children:"📦 Bulk"}),e.jsx(g,{variant:v==="smart"?"primary":"outline",size:"sm",onClick:()=>A("smart"),children:"🧠 Smart AI"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search bundles, articles, or styles...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:w,onChange:s=>E(s.target.value)})]})}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.priority,onChange:s=>S(i=>({...i,priority:s.target.value})),children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"urgent",children:"🔴 Urgent"}),e.jsx("option",{value:"high",children:"🟠 High"}),e.jsx("option",{value:"normal",children:"🔵 Normal"}),e.jsx("option",{value:"low",children:"⚪ Low"})]}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:m.machineType,onChange:s=>S(i=>({...i,machineType:s.target.value})),children:[e.jsx("option",{value:"all",children:"All Machines"}),e.jsx("option",{value:"overlock",children:"Overlock"}),e.jsx("option",{value:"singleNeedle",children:"Single Needle"})]}),e.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:F,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"priority",children:"Sort by Priority"}),e.jsx("option",{value:"value",children:"Sort by Value"}),e.jsx("option",{value:"bundleNumber",children:"Sort by Bundle #"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{variant:M==="grid"?"primary":"outline",size:"sm",onClick:()=>D("grid"),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(g,{variant:M==="list"?"primary":"outline",size:"sm",onClick:()=>D("list"),children:"📋"})]})]}),v!=="individual"&&e.jsx(p,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[y.length," bundles selected"]})]}),y.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"primary",size:"sm",onClick:Z,children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Smart Assign"]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>b([]),children:"Clear Selection"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Available Bundles"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Available Operators"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:N.filter(s=>s.priority==="urgent").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Urgent Priority"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",N.reduce((s,i)=>s+i.totalValue,0).toFixed(0)]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"})]}),e.jsxs(p,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[Math.floor(N.reduce((s,i)=>s+i.estimatedTime,0)/60),"h"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Est. Time"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:N.map(s=>e.jsxs(p,{className:`p-4 transition-all cursor-pointer hover:shadow-lg ${y.includes(s.id)?"ring-2 ring-blue-500 bg-blue-50":"hover:ring-1 hover:ring-gray-300"}`,onClick:()=>{v!=="individual"&&I(s.id)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono text-sm text-gray-700",children:s.bundleNumber})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v!=="individual"&&e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${y.includes(s.id)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:y.includes(s.id)&&e.jsx(O,{className:"h-3 w-3 text-white"})}),e.jsx(T,{variant:"outline",className:H(s.priority),children:s.priority})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.articleStyle}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Article: ",s.articleNumber]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),s.sizes.join(", ")]}),e.jsxs("span",{children:[s.totalPieces," pcs"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"$",s.totalValue.toFixed(2)]}),e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),Math.floor(s.estimatedTime/60),"h ",Math.floor(s.estimatedTime%60),"m"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Operations:"}),s.operations.map(i=>{const n=`${s.id}_${i.id}`,o=L[n]?x.find(d=>d.id===L[n]):null;return e.jsx("div",{className:`p-2 rounded border text-xs ${o?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-gray-600",children:i.machineType})]}),e.jsx("div",{className:"text-right",children:o?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:o.name})]}):e.jsx(T,{variant:"outline",size:"sm",children:"Available"})})]})},i.id)})]}),v==="individual"&&e.jsxs(g,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>{b([s.id]),W(!0)},children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Assign to Operator"]})]},s.id))}),N.length===0&&e.jsxs(p,{className:"p-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No bundles match your current filters"}),e.jsx(g,{variant:"outline",onClick:()=>{E(""),S({priority:"all",status:"all",machineType:"all",articleNumber:"all"})},className:"mt-4",children:"Clear Filters"})]}),e.jsxs(p,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),"Available Operators (",k.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx(T,{variant:s.skillLevel==="expert"?"success":s.skillLevel==="intermediate"?"warning":"info",size:"sm",children:s.skillLevel})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Machine: ",s.machineType]}),e.jsxs("p",{children:["Efficiency: ",s.efficiency,"%"]}),e.jsxs("p",{children:["Load: ",s.currentWorkload,"/",s.maxCapacity]}),e.jsxs("p",{children:["Today: $",s.todayEarnings]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.currentWorkload/s.maxCapacity*100}%`}})})})]},s.id))})]})]})};export{we as SmartWorkAssignmentDashboard,we as default};
