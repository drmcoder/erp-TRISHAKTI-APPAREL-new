const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.CLAiwwTT.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.EZF4ucWh.js","assets/firebase-vendor.D8xw0AXf.js","assets/utils-vendor.B0NEtgzl.js","assets/index.DXujQHlj.css"])))=>i.map(i=>d[i]);
import{h as c,g as l,_ as N}from"./index.CLAiwwTT.js";import{e as m,q as p,g as d,l as w,h as g,d as b,u as A,T as n,c as O}from"./firebase-vendor.D8xw0AXf.js";import"./query-vendor.DpsghfSz.js";import"./react-vendor.CfKEcsXX.js";import"./ui-vendor.EZF4ucWh.js";import"./utils-vendor.B0NEtgzl.js";class R{static async getAvailableOperationsForOperator(t,a){try{const r=m(c,l.BUNDLE_OPERATIONS),s=m(c,l.PRODUCTION_BUNDLES),e=p(r,d("status","==","pending"),d("machineType","==",a),w(20)),o=await g(e),i=[];for(const u of o.docs){const h={id:u.id,...u.data()};if(h.assignedOperatorId!==null&&h.assignedOperatorId!==void 0)continue;const y=p(s,d("id","==",h.bundleId)),f=await g(y);if(!f.empty){const D=f.docs[0].data();i.push({...h,bundleInfo:D})}}return{success:!0,data:i}}catch(r){return console.error("Failed to get available operations:",r),{success:!1,error:"Failed to fetch available operations"}}}static async selfAssignOperation(t,a,r){try{const s=b(c,l.BUNDLE_OPERATIONS,r);await A(s,{assignedOperatorId:t,assignedOperatorName:a,assignedAt:n.now(),status:"assigned",updatedAt:n.now()});const e=m(c,l.BUNDLE_OPERATIONS),o=p(e,d("__name__","==",r)),i=await g(o);let u="Unknown Operation";return i.empty||(u=i.docs[0].data().name||"Unknown Operation"),{success:!0,data:{operatorId:t,operatorName:a,operationId:r,operationName:u,assignedAt:new Date}}}catch(s){return console.error("Self-assignment failed:",s),{success:!1,error:"Self-assignment failed"}}}static async submitPartsComplaint(t){try{const a=m(c,l.PARTS_COMPLAINTS),r={...t,reportedBy:"current_operator",reportedByName:"Current Operator",reportedAt:new Date,status:"reported",replacedParts:[],resolution:"parts_replaced",createdAt:n.now(),updatedAt:n.now()};return{success:!0,data:{id:(await O(a,r)).id,...r}}}catch(a){return console.error("Failed to submit parts complaint:",a),{success:!1,error:"Failed to submit complaint"}}}static async getPartsComplaints(t){try{const a=m(c,l.PARTS_COMPLAINTS);let r;return t?r=p(a,d("supervisorId","==",t)):r=p(a,d("status","in",["reported","acknowledged","replacing"])),{success:!0,data:(await g(r)).docs.map(o=>({id:o.id,...o.data()}))}}catch(a){return console.error("Failed to get parts complaints:",a),{success:!1,error:"Failed to fetch parts complaints"}}}static async updateComplaintStatus(t,a,r){try{const s=b(c,l.PARTS_COMPLAINTS,t),e={status:a,updatedAt:n.now()};return r&&(e.supervisorNotes=r),e[`${a}At`]=n.now(),await A(s,e),{success:!0}}catch(s){return console.error("Failed to update complaint status:",s),{success:!1,error:"Failed to update complaint status"}}}static async getPendingOperations(t){try{const a=m(c,l.BUNDLE_OPERATIONS),r=m(c,l.PRODUCTION_BUNDLES);let s;t?.machineType?s=p(a,d("status","==","pending"),d("machineType","==",t.machineType),w(t?.limit||50)):s=p(a,d("status","==","pending"),w(t?.limit||50));const e=await g(s);console.log("🔍 Firebase getPendingOperations - operations count:",e.docs.length);const o=[];for(const i of e.docs){const u={id:i.id,...i.data()},h=p(r,d("id","==",u.bundleId)),y=await g(h);if(!y.empty){const f=y.docs[0].data();if(t?.priority&&f.priority!==t.priority||t?.articleNumber&&f.articleNumber!==t.articleNumber)continue;o.push({...u,bundleInfo:f})}}return{success:!0,data:o}}catch(a){return console.error("Failed to get pending operations:",a),{success:!1,error:"Failed to fetch pending operations"}}}static async getAvailableOperators(){try{const{operatorService:t}=await N(async()=>{const{operatorService:s}=await import("./index.CLAiwwTT.js").then(e=>e.P);return{operatorService:s}},__vite__mapDeps([0,1,2,3,4,5,6])),a=await t.getAllOperators();if(a.success&&a.data){console.log("🔍 Raw operators from Firebase:",a.data);const s=a.data.map(e=>{const o={id:e.id||"unknown",name:e.name||"Unknown Operator",machineType:e.primaryMachine||e.machineTypes?.[0]||"overlock",efficiency:e.averageEfficiency||85,currentWorkload:e.currentAssignments?.length||0,experience:e.skillLevel||"intermediate",specialties:e.machineTypes||[],status:e.isActive?"active":"offline"};return console.log("🔄 Transformed operator:",o),o});return console.log("✅ Final operator profiles:",s),{success:!0,data:s}}console.log("⚠️ No operators found in Firebase, creating sample operators..."),await this.createSampleOperators();const r=await t.getAllOperators();return r.success&&r.data?{success:!0,data:r.data.map(e=>({id:e.id||"unknown",name:e.name||"Unknown Operator",machineType:e.primaryMachine||e.machineTypes?.[0]||"overlock",efficiency:e.averageEfficiency||85,currentWorkload:e.currentAssignments?.length||0,experience:e.skillLevel||"intermediate",specialties:e.machineTypes||[],status:e.isActive?"active":"offline"}))}:{success:!0,data:[]}}catch(t){return console.error("Failed to get operators:",t),{success:!1,error:"Failed to fetch operators"}}}static async autoSmartAssign(t,a){try{return await new Promise(s=>setTimeout(s,2e3)),{success:!0,data:t.map((s,e)=>({operatorId:a[e%a.length].id,operatorName:a[e%a.length].name,operationId:s,operationName:`Operation ${e+1}`,assignedAt:new Date}))}}catch(r){return console.error("Auto smart assignment failed:",r),{success:!1,error:"Auto assignment failed"}}}static async bulkBatchAssign(t,a){try{return await new Promise(s=>setTimeout(s,1500)),{success:!0,data:[]}}catch(r){return console.error("Bulk assignment failed:",r),{success:!1,error:"Bulk assignment failed"}}}static async getBundleTrackingData(t){try{const a=m(c,l.BUNDLE_TRACKING);let r;t?.status?r=p(a,d("status","==",t.status)):t?.lot?r=p(a,d("lotNumber","==",t.lot)):t?.batch?r=p(a,d("batchNumber","==",t.batch)):r=p(a);let e=(await g(r)).docs.map(o=>({id:o.id,...o.data()}));if(t?.timeframe){const o=new Date;let i;switch(t.timeframe){case"today":i=new Date(o.getFullYear(),o.getMonth(),o.getDate());break;case"week":i=new Date(o.getTime()-10080*60*1e3);break;case"month":i=new Date(o.getFullYear(),o.getMonth(),1);break;default:i=new Date(0)}e=e.filter(u=>(u.createdAt instanceof Date?u.createdAt:new Date(u.createdAt))>=i)}return{success:!0,data:e}}catch(a){return console.error("Failed to get bundle tracking data:",a),{success:!1,error:"Failed to fetch tracking data"}}}static async updateBundleStatus(t,a,r){try{const s=b(c,l.BUNDLE_TRACKING,t),e={status:a,updatedAt:n.now()};return r&&(e.currentOperatorId=r),e[`${a}At`]=n.now(),await A(s,e),{success:!0}}catch(s){return console.error("Failed to update bundle status:",s),{success:!1,error:"Failed to update bundle status"}}}static async createSampleData(){try{console.log("🔧 Creating sample bundle data for development...");const t=m(c,l.PRODUCTION_BUNDLES),a=m(c,l.BUNDLE_OPERATIONS),r=[{id:"bundle_1",bundleNumber:"BND-3233-M-001",articleNumber:"3233",articleStyle:"Adult T-shirt",size:"M",quantity:50,priority:"normal",batchNumber:"B0001",dueDate:new Date(Date.now()+4320*60*1e3),createdAt:n.now(),updatedAt:n.now()},{id:"bundle_2",bundleNumber:"BND-3233-L-002",articleNumber:"3233",articleStyle:"Adult T-shirt",size:"L",quantity:50,priority:"high",batchNumber:"B0001",dueDate:new Date(Date.now()+2880*60*1e3),createdAt:n.now(),updatedAt:n.now()}],s=[{id:"op_1",bundleId:"bundle_1",operationId:"shoulder_join",name:"Shoulder Join",nameNepali:"काँध जोड्ने",machineType:"overlock",sequenceOrder:1,pricePerPiece:2.5,smvMinutes:4.5,status:"pending",prerequisites:[],isOptional:!1,qualityCheckRequired:!0,defectTolerance:5,assignedOperatorId:null,createdAt:n.now(),updatedAt:n.now()},{id:"op_2",bundleId:"bundle_1",operationId:"side_seam",name:"Side Seam",nameNepali:"छेउ सिलाई",machineType:"singleNeedle",sequenceOrder:2,pricePerPiece:3,smvMinutes:5,status:"pending",prerequisites:["shoulder_join"],isOptional:!1,qualityCheckRequired:!0,defectTolerance:3,assignedOperatorId:null,createdAt:n.now(),updatedAt:n.now()},{id:"op_3",bundleId:"bundle_2",operationId:"sleeve_attach",name:"Sleeve Attach",nameNepali:"आस्तीन लगाउने",machineType:"overlock",sequenceOrder:3,pricePerPiece:4,smvMinutes:7,status:"pending",prerequisites:["side_seam"],isOptional:!1,qualityCheckRequired:!0,defectTolerance:2,assignedOperatorId:null,createdAt:n.now(),updatedAt:n.now()}];for(const e of r)await O(t,e),console.log(`✅ Created bundle: ${e.bundleNumber}`);for(const e of s)await O(a,e),console.log(`✅ Created operation: ${e.name}`);return console.log("🎉 Sample data created successfully!"),{success:!0}}catch(t){return console.error("Failed to create sample data:",t),{success:!1,error:"Failed to create sample data"}}}static async createSampleOperators(){try{console.log("🔧 Creating sample operators for development...");const{operatorService:t}=await N(async()=>{const{operatorService:r}=await import("./index.CLAiwwTT.js").then(s=>s.P);return{operatorService:r}},__vite__mapDeps([0,1,2,3,4,5,6])),a=[{username:"maya_patel",name:"Maya Patel",employeeId:"TSA-EMP-0001",email:"maya.patel@tsa.com",phone:"+977-9841234567",primaryMachine:"overlock",machineTypes:["overlock","singleNeedle"],skillLevel:"expert",shift:"morning",address:"Kathmandu, Nepal"},{username:"priya_singh",name:"Priya Singh",employeeId:"TSA-EMP-0002",email:"priya.singh@tsa.com",phone:"+977-9841234568",primaryMachine:"singleNeedle",machineTypes:["singleNeedle","flatlock"],skillLevel:"intermediate",shift:"morning",address:"Lalitpur, Nepal"},{username:"rajesh_kumar",name:"Rajesh Kumar",employeeId:"TSA-EMP-0003",email:"rajesh.kumar@tsa.com",phone:"+977-9841234569",primaryMachine:"overlock",machineTypes:["overlock"],skillLevel:"expert",shift:"afternoon",address:"Bhaktapur, Nepal"},{username:"sita_sharma",name:"Sita Sharma",employeeId:"TSA-EMP-0004",email:"sita.sharma@tsa.com",phone:"+977-9841234570",primaryMachine:"cutting",machineTypes:["cutting","manual"],skillLevel:"intermediate",shift:"morning",address:"Pokhara, Nepal"}];for(const r of a){const s=await t.createOperator(r);s.success?console.log(`✅ Created operator: ${r.name}`):console.error(`❌ Failed to create operator ${r.name}:`,s.error)}return console.log("🎉 Sample operators created successfully!"),{success:!0}}catch(t){return console.error("Failed to create sample operators:",t),{success:!1,error:"Failed to create sample operators"}}}}export{R as EnhancedBundleService,R as default};
