import{j as e}from"./query-vendor.DpsghfSz.js";import{r as h}from"./react-vendor.CfKEcsXX.js";import{C as f,c as g,d as b,e as B,B as k,b as S,I as v,a as w}from"./index.CLAiwwTT.js";import{L as x}from"./label.D0ghwUEZ.js";import{S as L,a as z,b as A,c as q,d as X}from"./select.D3_Pn-VW.js";import{S as se}from"./separator.BgmWzbHV.js";import{p as V}from"./production-lot-service.C58jgk8y.js";import{t as E}from"./index.LBReXyrD.js";import{P as te,g as ae,d as re,L as le,h as ie,M as G,i as ce,j as ne}from"./ui-vendor.EZF4ucWh.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const oe=[{value:"tshirt",label:"T-Shirt",labelNepali:"टी-शर्ट"},{value:"polo",label:"Polo T-Shirt",labelNepali:"पोलो टी-शर्ट"},{value:"shirt",label:"Shirt",labelNepali:"शर्ट"},{value:"pants",label:"Pants",labelNepali:"प्यान्ट"},{value:"other",label:"Other",labelNepali:"अन्य"}],de=["Black","White","Navy","Gray","Red","Blue","Green","Yellow","Purple","Pink","Orange","Brown","Maroon","Olive","Turquoise"],me=["XXS","XS","S","M","L","XL","XXL","XXXL"],ye=({mode:r="create",lotId:y,onClose:j})=>{const[a,m]=h.useState({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"tshirt",totalPieces:0,colorSizeBreakdown:[],status:"cutting",createdBy:"management",notes:""}),[I,Q]=h.useState({}),[o,P]=h.useState(["Black"]),[i,T]=h.useState(["M","L","XL"]),[ue,M]=h.useState(!1),[O,R]=h.useState(!1);h.useEffect(()=>{_(),r!=="create"&&y?$():F()},[r,y]),h.useEffect(()=>{D()},[o,i]);const _=()=>{const s=V.getProcessTemplates();Q(s)},$=async()=>{y&&(M(!0),M(!1))},F=()=>{const s=o.map(t=>({color:t,totalPieces:0,sizes:i.map(u=>({size:u,quantity:0,completedQuantity:0}))}));m(t=>({...t,colorSizeBreakdown:s}))},D=()=>{if(!a.colorSizeBreakdown)return;const s=a.colorSizeBreakdown,t=o.map(l=>{const p=s.find(n=>n.color===l),c=i.map(n=>{const d=p?.sizes.find(C=>C.size===n);return{size:n,quantity:d?.quantity||0,completedQuantity:d?.completedQuantity||0}});return{color:l,sizes:c,totalPieces:c.reduce((n,d)=>n+d.quantity,0)}}),u=t.reduce((l,p)=>l+p.totalPieces,0);m(l=>({...l,colorSizeBreakdown:t,totalPieces:u}))},Y=(s,t,u)=>{if(!a.colorSizeBreakdown)return;const l=a.colorSizeBreakdown.map(c=>{if(c.color===s){const n=c.sizes.map(d=>d.size===t?{...d,quantity:u}:d);return{...c,sizes:n,totalPieces:n.reduce((d,C)=>d+C.quantity,0)}}return c}),p=l.reduce((c,n)=>c+n.totalPieces,0);m(c=>({...c,colorSizeBreakdown:l,totalPieces:p}))},H=s=>{o.includes(s)||P([...o,s])},W=s=>{o.length>1&&P(o.filter(t=>t!==s))},Z=s=>{i.includes(s)||T([...i,s])},J=s=>{i.length>1&&T(i.filter(t=>t!==s))},K=async()=>{if(!a.lotNumber||!a.articleNumber||!a.garmentType||a.totalPieces===0){E.error("Please fill all required fields and ensure total pieces > 0");return}try{R(!0);const s={lotNumber:a.lotNumber,articleNumber:a.articleNumber,articleName:a.articleName||a.articleNumber,garmentType:a.garmentType,totalPieces:a.totalPieces,colorSizeBreakdown:a.colorSizeBreakdown,currentStep:1,status:"in_progress",createdBy:a.createdBy,notes:a.notes||""},t=await V.createProductionLot(s);E.success(`Production lot ${t.lotNumber} created successfully!`),j&&j(),r==="create"&&(m({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"tshirt",totalPieces:0,colorSizeBreakdown:[],status:"cutting",createdBy:"management",notes:""}),P(["Black"]),T(["M","L","XL"]),F())}catch(s){console.error("Error saving lot:",s),E.error("Failed to create production lot")}finally{R(!1)}},N=I[a.garmentType||"tshirt"],U=N?.steps?.length||0,ee=a.totalPieces&&N?a.totalPieces*N.steps.reduce((s,t)=>s+t.pricePerPiece,0):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{children:e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),r==="create"?"Create Production Lot":r==="edit"?"Edit Production Lot":"View Production Lot"]}),e.jsx(B,{children:r==="create"?"Set up a new production lot with article details and quantity breakdown":r==="edit"?"Modify production lot details":"View production lot information"})]}),j&&e.jsx(k,{variant:"outline",onClick:j,children:"Close"})]})})}),e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2"}),"Basic Information"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"lotNumber",children:"Lot Number"}),e.jsx(v,{id:"lotNumber",value:a.lotNumber||"",onChange:s=>m(t=>({...t,lotNumber:s.target.value})),disabled:r==="view",placeholder:"LOT001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"articleNumber",children:"Article Number*"}),e.jsx(v,{id:"articleNumber",value:a.articleNumber||"",onChange:s=>m(t=>({...t,articleNumber:s.target.value})),disabled:r==="view",placeholder:"8082"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"articleName",children:"Article Name"}),e.jsx(v,{id:"articleName",value:a.articleName||"",onChange:s=>m(t=>({...t,articleName:s.target.value})),disabled:r==="view",placeholder:"Polo T-Shirt"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Garment Type*"}),e.jsxs(L,{value:a.garmentType||"tshirt",onValueChange:s=>m(t=>({...t,garmentType:s})),disabled:r==="view",children:[e.jsx(z,{children:e.jsx(A,{})}),e.jsx(q,{children:oe.map(s=>e.jsxs(X,{value:s.value,children:[s.label," (",s.labelNepali,")"]},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Total Pieces"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{value:a.totalPieces||0,disabled:!0,className:"bg-muted"}),e.jsx(w,{variant:"secondary",children:"Auto-calculated"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",className:"w-full min-h-[80px] p-3 border rounded-md",value:a.notes||"",onChange:s=>m(t=>({...t,notes:s.target.value})),disabled:r==="view",placeholder:"Additional notes about this production lot..."})]})]})]}),N&&e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),"Process Template: ",N.name]}),e.jsxs(B,{children:[U," steps | Est. Rs. ",ee.toFixed(2)," total production cost"]})]}),e.jsx(S,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:N.steps.map((s,t)=>e.jsxs("div",{className:"flex items-center p-3 border rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold mr-3",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:s.operation}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.operationNepali}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(w,{variant:"outline",className:"text-xs",children:s.machineType}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["Rs. ",s.pricePerPiece,"/pc"]})]})]})]},t))})})]}),e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Color & Size Breakdown"]}),e.jsx(B,{children:"Configure the quantity distribution across colors and sizes"})]}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Colors"]}),e.jsxs(L,{onValueChange:H,children:[e.jsx(z,{className:"w-48",children:e.jsx(A,{placeholder:"Add color"})}),e.jsx(q,{children:de.filter(s=>!o.includes(s)).map(s=>e.jsx(X,{value:s,children:s},s))})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(s=>e.jsxs(w,{variant:"outline",className:"flex items-center",children:[s,o.length>1&&e.jsx("button",{onClick:()=>W(s),className:"ml-2 text-xs hover:text-red-500",children:e.jsx(G,{className:"h-3 w-3"})})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{className:"flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Sizes"]}),e.jsxs(L,{onValueChange:Z,children:[e.jsx(z,{className:"w-48",children:e.jsx(A,{placeholder:"Add size"})}),e.jsx(q,{children:me.filter(s=>!i.includes(s)).map(s=>e.jsx(X,{value:s,children:s},s))})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>e.jsxs(w,{variant:"outline",className:"flex items-center",children:[s,i.length>1&&e.jsx("button",{onClick:()=>J(s),className:"ml-2 text-xs hover:text-red-500",children:e.jsx(G,{className:"h-3 w-3"})})]},s))})]}),e.jsx(se,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{children:"Quantity Distribution"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Color"}),i.map(s=>e.jsx("th",{className:"text-center p-2 font-medium",children:s},s)),e.jsx("th",{className:"text-center p-2 font-medium",children:"Total"})]})}),e.jsx("tbody",{children:a.colorSizeBreakdown?.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2 font-medium",children:s.color}),i.map(t=>{const u=s.sizes.find(l=>l.size===t);return e.jsx("td",{className:"p-2",children:e.jsx(v,{type:"number",min:"0",value:u?.quantity||0,onChange:l=>Y(s.color,t,parseInt(l.target.value)||0),disabled:r==="view",className:"w-16 text-center"})},t)}),e.jsx("td",{className:"p-2 text-center font-medium",children:s.totalPieces})]},s.color))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 font-bold",children:[e.jsx("td",{className:"p-2",children:"TOTAL"}),i.map(s=>{const t=a.colorSizeBreakdown?.reduce((u,l)=>{const p=l.sizes.find(c=>c.size===s);return u+(p?.quantity||0)},0)||0;return e.jsx("td",{className:"p-2 text-center",children:t},s)}),e.jsx("td",{className:"p-2 text-center text-lg",children:a.totalPieces})]})})]})})]})]})]}),r!=="view"&&e.jsx(f,{children:e.jsx(S,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[j&&e.jsx(k,{variant:"outline",onClick:j,children:"Cancel"}),e.jsx(k,{onClick:K,disabled:O||a.totalPieces===0,children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),r==="create"?"Create Production Lot":"Save Changes"]})})]})})})]})};export{ye as ProductionLotManager,ye as default};
