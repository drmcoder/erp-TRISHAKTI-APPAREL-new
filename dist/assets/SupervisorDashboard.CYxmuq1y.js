import{j as e}from"./query-vendor.NFs8Lf8Y.js";import{c as T,r as l}from"./react-vendor.BcnQP8kQ.js";import{p as n,P as d,a as R}from"./index.nxVTfIuo.js";import{L as b}from"./LoadingSpinner.BqqE1w83.js";import{B as o,b as x,c as i}from"./index.B__xpDQO.js";import"./firebase-vendor.m6WcKfT_.js";import"./operator-service.ea3XhWLu.js";import"./notification-service.CokO_XAL.js";import"./damage-report-service.CoCQ_gjd.js";import"./operator-wallet-service.BuDOx5T4.js";import"./ui-vendor.BnTQXQPs.js";import"./utils-vendor.B0NEtgzl.js";const F=T.memo(({supervisorId:a})=>{const[h,E]=l.useState(null),[p,w]=l.useState(!0),[v,y]=l.useState(null),[g,S]=l.useState(null),[c,A]=l.useState({canViewDashboard:!1,canViewTeam:!1,canAssignWork:!1,canApproveAssignments:!1,canViewTeamPerformance:!1,canManageSchedule:!1});l.useEffect(()=>{V(),m()},[a]);const V=async()=>{try{await n.loadUserPermissions(a),A({canViewDashboard:n.hasPermission(a,d.SUPERVISOR_VIEW_DASHBOARD.id),canViewTeam:n.hasPermission(a,d.SUPERVISOR_VIEW_TEAM.id),canAssignWork:n.hasPermission(a,d.SUPERVISOR_ASSIGN_WORK.id),canApproveAssignments:n.hasPermission(a,d.SUPERVISOR_APPROVE_ASSIGNMENTS.id),canViewTeamPerformance:n.hasPermission(a,d.SUPERVISOR_VIEW_TEAM_PERFORMANCE.id),canManageSchedule:n.hasPermission(a,d.SUPERVISOR_MANAGE_TEAM_SCHEDULE.id)})}catch(s){console.error("Failed to load permissions:",s),n.setUserRole(a,"SUPERVISOR"),A({canViewDashboard:!0,canViewTeam:!0,canAssignWork:!0,canApproveAssignments:!0,canViewTeamPerformance:!0,canManageSchedule:!0})}},m=async()=>{try{const s=await R.getDashboard(a);s.success?E(s.data):y(s.error||"Failed to load dashboard data")}catch{y("Error loading dashboard data")}finally{w(!1)}},P=async(s,r,D)=>{try{S(s);const u=await R.processAssignmentApproval(s,a,r,D);u.success?(await m(),alert(`Assignment ${r}d successfully!`)):alert(`Failed to ${r} assignment: ${u.error}`)}catch{alert(`Error processing ${r}`)}finally{S(null)}};if(p&&!h)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(b,{size:"lg"})});if(!c.canViewDashboard)return e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-600",children:"You don't have permission to access the Supervisor Dashboard."}),e.jsx("p",{className:"text-sm text-red-500 mt-2",children:"Please contact your administrator for access."})]})});if(v)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600",children:v}),e.jsx(o,{onClick:m,className:"mt-4",children:"Retry"})]});if(!h)return null;const{supervisor:j,teamProductivity:t,pendingApprovals:N,teamOperators:f=[]}=h;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx(x,{variant:"default",className:"bg-green-100 text-green-800",children:"👥 SUPERVISOR DASHBOARD"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:j.name}),e.jsxs("p",{className:"text-gray-600",children:[j.supervisorLevel," Supervisor • Team Size: ",f.length]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{onClick:m,disabled:p,size:"sm",variant:"outline",children:p?e.jsx(b,{size:"sm"}):"🔄 Refresh"}),e.jsx(x,{variant:"success",children:"Active"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Lines: ",j.responsibleLines?.length||0]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Team Efficiency"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[Math.round(t.teamEfficiency*100),"%"]})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Average Quality"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[Math.round(t.averageQuality*100),"%"]})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Team Health"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:t.teamHealthScore})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:N.length})]})]}),c.canViewTeam&&e.jsxs(i,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Team Members"}),f.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No team members assigned"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx(x,{variant:s.currentStatus==="working"?"success":"secondary",children:s.currentStatus})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[s.skillLevel," • ",s.primaryMachine]}),c.canViewTeamPerformance&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(s.averageEfficiency*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Quality:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(s.qualityScore*100),"%"]})]})]})]},s.id))})]}),c.canApproveAssignments&&e.jsxs(i,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Pending Assignment Approvals"}),N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No pending approvals"}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Work Assignment Request"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Operator: ",s.operatorName||s.operatorId]})]}),e.jsx(x,{variant:"warning",children:"Pending"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Work Item:"})," ",s.workItemId]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Requested:"})," ",new Date(s.requestedAt?.seconds*1e3).toLocaleString()]}),s.reason&&e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{size:"sm",onClick:()=>P(s.id,"approve"),disabled:g===s.id,className:"bg-green-600 hover:bg-green-700",children:g===s.id?e.jsx(b,{size:"sm"}):"Approve"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>{const r=prompt("Rejection reason (optional):");P(s.id,"reject",r||void 0)},disabled:g===s.id,className:"text-red-600 border-red-600 hover:bg-red-50",children:"Reject"})]})]},s.id))})]}),c.canViewTeamPerformance&&t.recommendedActions.length>0&&e.jsxs(i,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Performance Recommendations"}),e.jsx("div",{className:"space-y-2",children:t.recommendedActions.map((s,r)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("p",{className:"text-sm",children:s})]},r))})]}),c.canViewTeamPerformance&&t.teamHealthScore<60&&e.jsxs(i,{className:"p-6 bg-red-50 border-red-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"⚠️ Team Health Alert"}),e.jsxs("p",{className:"text-red-700 mb-4",children:["Your team health score is ",t.teamHealthScore,". Immediate attention required."]}),e.jsx("div",{className:"space-y-1",children:t.recommendedActions.slice(0,3).map((s,r)=>e.jsxs("p",{className:"text-sm text-red-600",children:["• ",s]},r))})]})]})});export{F as SupervisorDashboard};
