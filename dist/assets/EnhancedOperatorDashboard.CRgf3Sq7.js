import{j as e}from"./query-vendor.NFs8Lf8Y.js";import{r as c}from"./react-vendor.BcnQP8kQ.js";import{c as n,v as l,w as d,x as g,b as m,t as x,I as F,B as P}from"./index.B__xpDQO.js";import{L as h}from"./label.Rpc_NHFh.js";import{e as N}from"./enhanced-production-service.C9lU_1TR.js";import{t as i}from"./index.wyP5CHuk.js";import{p as Q,P as C,I as Y,k as U,Q as A,C as z,V,g as G,l as M,u as J}from"./ui-vendor.BnTQXQPs.js";import{f as K}from"./utils-vendor.B0NEtgzl.js";import"./firebase-vendor.m6WcKfT_.js";const f={single_needle:"bg-blue-100 text-blue-800",overlock:"bg-green-100 text-green-800",flatlock:"bg-purple-100 text-purple-800",buttonhole:"bg-orange-100 text-orange-800",button_attach:"bg-pink-100 text-pink-800",cutting:"bg-gray-100 text-gray-800",finishing:"bg-indigo-100 text-indigo-800"},u={single_needle:"सिंगल निडल",overlock:"ओभरलक",flatlock:"फ्ल्यालक",buttonhole:"बटन होल",button_attach:"बटन एट्याच",cutting:"काटने",finishing:"फिनिशिङ"},le=({operatorId:p,operatorName:E,machineTypes:v})=>{const[S,D]=c.useState([]),[t,y]=c.useState(null),[j,O]=c.useState([]),[a,b]=c.useState(0),[T,k]=c.useState(""),[_,W]=c.useState(!1);c.useEffect(()=>{w(),R()},[p]);const w=async()=>{try{W(!0);const s=await N.getAvailableWorkForOperator(p,v);D(s)}catch(s){console.error("Error loading available work:",s),i.error("Failed to load available work")}finally{W(!1)}},R=async()=>{try{const s=new Date,o=(await N.getOperatorMonthlyWork(p,s.getMonth()+1,s.getFullYear())).sessions.filter(H=>new Date(H.workDate.toDate()).toDateString()===s.toDateString());O(o)}catch(s){console.error("Error loading today sessions:",s)}},$=async(s,r)=>{try{const o=await N.assignBundleStepToOperator(s.id,r.stepNumber,p,E);y(o),b(0),k(""),i.success(`Started ${r.operation} on ${s.bundleNumber}`),w()}catch(o){console.error("Error starting work:",o),i.error("Failed to start work")}},I=async()=>{if(!t||a===0){i.error("Please enter completed pieces");return}if(a>t.assignedPieces){i.error(`Cannot exceed assigned pieces (${t.assignedPieces})`);return}try{await N.completeOperatorWork(t.id,a,T);const s=a*t.pricePerPiece;i.success(`Completed ${a} pieces - Earned Rs. ${s.toFixed(2)}`),y(null),b(0),k(""),w(),R()}catch(s){console.error("Error completing work:",s),i.error("Failed to complete work")}},L=()=>{y(null),i.info("Work paused - you can resume later")},q=j.reduce((s,r)=>s+r.completedPieces,0),B=j.reduce((s,r)=>s+r.totalEarning,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{children:e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),E]}),e.jsxs(g,{children:["Machine Skills: ",v.map(s=>u[s]||s).join(", ")]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:v.map(s=>e.jsx(m,{className:f[s],children:u[s]||s},s))})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsx(l,{className:"pb-3",children:e.jsxs(d,{className:"text-sm font-medium flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Today's Pieces"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed today"})]})]}),e.jsxs(n,{children:[e.jsx(l,{className:"pb-3",children:e.jsxs(d,{className:"text-sm font-medium flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Today's Earnings"]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["Rs. ",B.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total earned today"})]})]}),e.jsxs(n,{children:[e.jsx(l,{className:"pb-3",children:e.jsxs(d,{className:"text-sm font-medium flex items-center",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Work Sessions"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?"Active work in progress":"No active work"})]})]})]}),t?e.jsxs(n,{className:"border-green-200 bg-green-50",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(A,{className:"h-5 w-5 mr-2 text-green-600"}),"Active Work"]}),e.jsxs(g,{children:["Bundle: ",t.bundleNumber," | Operation: ",t.operation]})]}),e.jsx(m,{className:"bg-green-100 text-green-800",children:"In Progress"})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Machine Type"}),e.jsx(m,{className:f[t.machineType],children:u[t.machineType]||t.machineType})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Assigned Pieces"}),e.jsxs("div",{className:"font-medium",children:[t.assignedPieces," pcs"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Rate"}),e.jsxs("div",{className:"font-medium",children:["Rs. ",t.pricePerPiece," / piece"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Potential Earning"}),e.jsxs("div",{className:"font-medium text-green-600",children:["Rs. ",(t.assignedPieces*t.pricePerPiece).toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"completedPieces",children:"Completed Pieces*"}),e.jsx(F,{id:"completedPieces",type:"number",min:"0",max:t.assignedPieces,value:a,onChange:s=>b(parseInt(s.target.value)||0),placeholder:"Enter completed pieces"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Max: ",t.assignedPieces," pieces | Earnings: Rs. ",(a*t.pricePerPiece).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"qualityNotes",children:"Quality Notes (Optional)"}),e.jsx(F,{id:"qualityNotes",value:T,onChange:s=>k(s.target.value),placeholder:"Any quality issues..."})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(P,{onClick:I,disabled:a===0,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Complete Work"]}),e.jsxs(P,{variant:"outline",onClick:L,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Pause"]})]})]})]}):e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Available Work"]}),e.jsx(g,{children:"Select a bundle and operation to start working"})]}),e.jsx(x,{children:_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading available work..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{children:"No work available for your machine types"}),e.jsx("p",{className:"text-sm",children:"Check back later for new assignments"})]}):e.jsx("div",{className:"space-y-3",children:S.map(({bundle:s,step:r},o)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{variant:"outline",className:"font-mono",children:s.bundleNumber}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[r.operation," (",r.operationNepali,")"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.color," ",s.size," - ",s.pieces," pieces"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-green-600",children:["Rs. ",r.pricePerPiece," / piece"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: Rs. ",(s.pieces*r.pricePerPiece).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsx(m,{className:f[r.machineType],children:u[r.machineType]||r.machineType}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),r.estimatedMinutes," min"]}),e.jsxs("span",{children:["Step ",r.stepNumber]})]}),e.jsxs(P,{onClick:()=>$(s,r),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Start Work"]})]}),r.dependencies.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Requires completion of steps: ",r.dependencies.join(", ")]})})]},`${s.id}-${r.stepNumber}`))})})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Today's Work History"]}),e.jsx(g,{children:K(new Date,"EEEE, MMMM d, yyyy")})]}),e.jsx(x,{children:j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{children:"No work completed today"}),e.jsx("p",{className:"text-sm",children:"Start working to see your progress here"})]}):e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{className:f[s.machineType],children:u[s.machineType]||s.machineType}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.operation," - ",s.bundleNumber]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.completedPieces," / ",s.assignedPieces," pieces"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Rs. ",s.totalEarning.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Rs. ",s.pricePerPiece," × ",s.completedPieces]})]})]},s.id))})})]})]})};export{le as EnhancedOperatorDashboard,le as default};
