import{j as e}from"./query-vendor.BbCCZTU0.js";import{r as f}from"./react-vendor.BcnQP8kQ.js";import{C as h,e as v,f as y,g as Z,d as S,a as U,B as F}from"./index.BnZjV7b3.js";import{I as g}from"./Input.D8gd7mOf.js";import{L as d}from"./label.BNDYRuzi.js";import{S as I,a as K,b as _,c as $,d as G}from"./select.BqvOc8nJ.js";import{d as A,s as C,r as x,a as j,g as J}from"./firebase.BVb4kvNg.js";import{e as R,c as z,s as L}from"./firebase-vendor.BZUNkHzc.js";import{t as u}from"./index.wyP5CHuk.js";import{_ as ee,$ as se,a0 as te,a1 as ae,a2 as re,P as le,a3 as oe,a4 as ce}from"./ui-vendor.B7YYMSVe.js";import"./utils-vendor.B0NEtgzl.js";class ie{async createCuttingDroplet(t){try{return{id:(await R(z(A,"cuttingDroplets"),{...t,createdAt:L()})).id,...t,createdAt:new Date}}catch(c){throw console.error("Error creating cutting droplet:",c),c}}async createBundlesFromCutting(t){return[]}}const O=new ie;class ne{static async testFirestore(){try{console.log("🧪 Testing Firestore connection...");const t=await R(z(A,"test"),{message:"TSA Production System Test",timestamp:L(),test:!0});return console.log("✅ Firestore write successful:",t.id),!0}catch(t){return console.error("❌ Firestore test failed:",t),!1}}static async testRealtimeDatabase(){try{console.log("🧪 Testing Realtime Database connection..."),await C(x(j,"test/connection"),{message:"TSA Production System Live Test",timestamp:Date.now(),status:"connected"});const t=await J(x(j,"test/connection"));return t.exists()?(console.log("✅ Realtime Database test successful:",t.val()),!0):(console.error("❌ Realtime Database read failed: No data"),!1)}catch(t){return console.error("❌ Realtime Database test failed:",t),!1}}static async testTSAProductionFlow(){try{console.log("🧪 Testing TSA Production Flow...");const t={lotNumber:"TEST001",articleNumber:"8082",garmentType:"polo",status:"cutting",colorSizeData:[{color:"Blue",rollsUsed:2,kgUsed:5.5,layers:20,sizes:[{size:"XL",pieces:30,bundlesCreated:0},{size:"2XL",pieces:30,bundlesCreated:0}],totalPieces:60}],createdAt:L()},c=await R(z(A,"cuttingDroplets"),t);return console.log("✅ Cutting droplet created:",c.id),await C(x(j,`live_production/cutting_droplets/${c.id}`),{id:c.id,lotNumber:"TEST001",articleNumber:"8082",status:"cutting",totalPieces:60,lastUpdated:Date.now()}),console.log("✅ Live production status updated"),await C(x(j,"live_production/operators/test_operator"),{operatorId:"test_operator",operatorName:"Test Operator",status:"available",machineType:null,currentBundle:null,lastActivity:Date.now()}),console.log("✅ Operator status updated"),!0}catch(t){return console.error("❌ TSA Production Flow test failed:",t),!1}}static async runAllTests(){console.log("🚀 Starting TSA Production System Database Tests..."),console.log("");const t={firestore:await this.testFirestore(),realtime:await this.testRealtimeDatabase(),production:await this.testTSAProductionFlow()};console.log(""),console.log("📊 Test Results:"),console.log("================"),console.log(`Firestore:        ${t.firestore?"✅ PASSED":"❌ FAILED"}`),console.log(`Realtime DB:      ${t.realtime?"✅ PASSED":"❌ FAILED"}`),console.log(`Production Flow:  ${t.production?"✅ PASSED":"❌ FAILED"}`),console.log(""),Object.values(t).every(b=>b)?(console.log("🎉 All tests PASSED! TSA Production System is ready."),console.log(""),console.log("✅ Database Architecture Active:"),console.log("   - Firestore: Structured data, complex queries"),console.log("   - Realtime DB: Live updates, real-time dashboards"),console.log(""),console.log("🔄 Your TSA Production Workflow:"),console.log("   1. Management → Cutting Entry (Firestore + RT DB)"),console.log("   2. System → Bundle Creation (Firestore + RT DB)"),console.log("   3. Supervisor → Bundle Assignment (Firestore + RT DB)"),console.log("   4. Operators → Piece Tracking (Firestore + RT DB)"),console.log("   5. Live Dashboard → Real-time Updates (RT DB)")):(console.log("❌ Some tests FAILED. Please check your Firebase configuration."),console.log(""),console.log("🔧 Troubleshooting:"),console.log("   1. Check Firebase project configuration"),console.log("   2. Verify authentication is working"),console.log("   3. Check database rules permissions"),console.log("   4. Ensure environment variables are set correctly"))}static async cleanupTestData(){try{console.log("🧹 Cleaning up test data..."),await C(x(j,"test"),null),await C(x(j,"live_production/operators/test_operator"),null),console.log("✅ Test data cleanup completed")}catch(t){console.error("❌ Cleanup failed:",t)}}}const de=["Blue","Green","Black","White","Red","Navy","Gray","Yellow","Pink","Purple"],M=["S","M","L","XL","2XL","3XL"],ue=[{value:"tshirt",label:"T-Shirt (3233#)",example:"3233#"},{value:"polo",label:"Polo T-Shirt (8082#)",example:"8082#"},{value:"shirt",label:"Shirt",example:"5512#"},{value:"pants",label:"Pants",example:"7890#"}],Se=()=>{const[a,t]=f.useState({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"polo",totalRolls:0,totalKg:0,colorSizeData:[],createdBy:"management",status:"cutting"}),[c,b]=f.useState(["Blue","Green","Black"]),[B,T]=f.useState(!1),[k,E]=f.useState(!1);f.useEffect(()=>{V()},[c]);const V=()=>{const s=c.map(r=>{const l=a.colorSizeData?.find(i=>i.color===r);return{color:r,rollsUsed:l?.rollsUsed||0,kgUsed:l?.kgUsed||0,layers:l?.layers||20,sizes:M.map(i=>{const m=l?.sizes.find(N=>N.size===i);return{size:i,pieces:m?.pieces||0,bundlesCreated:0}}),totalPieces:l?.totalPieces||0}});t(r=>({...r,colorSizeData:s}))},w=(s,r,l)=>{if(!a.colorSizeData)return;const i=a.colorSizeData.map(o=>{if(o.color===s){const n={...o,[r]:l};return(r==="layers"||r==="sizes")&&(n.totalPieces=n.sizes.reduce((p,P)=>p+P.pieces,0)),n}return o}),m=i.reduce((o,n)=>o+n.rollsUsed,0),N=i.reduce((o,n)=>o+n.kgUsed,0);t(o=>({...o,colorSizeData:i,totalRolls:m,totalKg:N}))},X=(s,r,l)=>{if(!a.colorSizeData)return;const i=a.colorSizeData.map(o=>{if(o.color===s){const n=o.sizes.map(p=>p.size===r?{...p,pieces:l}:p);return{...o,sizes:n,totalPieces:n.reduce((p,P)=>p+P.pieces,0)}}return o}),m=i.reduce((o,n)=>o+n.rollsUsed,0),N=i.reduce((o,n)=>o+n.kgUsed,0);t(o=>({...o,colorSizeData:i,totalRolls:m,totalKg:N}))},q=s=>{c.includes(s)||b([...c,s])},W=s=>{c.length>1&&b(c.filter(r=>r!==s))},Y=async()=>{if(!a.lotNumber||!a.articleNumber||!a.garmentType){u.error("Please fill all required fields");return}const s=a.colorSizeData?.reduce((r,l)=>r+l.totalPieces,0)||0;if(s===0){u.error("Please enter piece quantities");return}try{E(!0);const r={lotNumber:a.lotNumber,articleNumber:a.articleNumber,articleName:a.articleName||a.articleNumber,garmentType:a.garmentType,totalRolls:a.totalRolls,totalKg:a.totalKg,colorSizeData:a.colorSizeData,createdBy:a.createdBy,status:"cutting"},l=await O.createCuttingDroplet(r);u.success(`Cutting droplet ${l.lotNumber} created successfully! Total: ${s} pieces`),t({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"polo",totalRolls:0,totalKg:0,colorSizeData:[],createdBy:"management",status:"cutting"}),b(["Blue","Green","Black"])}catch(r){console.error("Error saving cutting droplet:",r),u.error("Failed to create cutting droplet")}finally{E(!1)}},H=async()=>{if(!a.lotNumber){u.error("Please save the cutting droplet first");return}try{T(!0);const s=await O.createBundlesFromCutting("temp_id");u.success(`Created ${s.length} production bundles ready for sewing line`)}catch{u.error("Failed to create bundles")}finally{T(!1)}},Q=async()=>{try{T(!0),u.info("Testing Firebase connection..."),await ne.runAllTests(),u.success("Firebase test completed! Check console for results.")}catch{u.error("Firebase test failed! Check console for details.")}finally{T(!1)}},D=a.colorSizeData?.reduce((s,r)=>s+r.totalPieces,0)||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{children:e.jsxs(v,{children:[e.jsxs(y,{className:"flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Cutting Droplet Entry"]}),e.jsx(Z,{children:"Enter WIP Excel data from cutting department - rolls, colors, sizes, and piece quantities"})]})}),e.jsxs(h,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(se,{className:"h-5 w-5 mr-2"}),"Lot Information"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lotNumber",children:"Lot Number*"}),e.jsx(g,{id:"lotNumber",value:a.lotNumber||"",onChange:s=>t(r=>({...r,lotNumber:s.target.value})),placeholder:"LOT001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"articleNumber",children:"Article Number*"}),e.jsx(g,{id:"articleNumber",value:a.articleNumber||"",onChange:s=>t(r=>({...r,articleNumber:s.target.value})),placeholder:"8082"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Garment Type*"}),e.jsxs(I,{value:a.garmentType,onValueChange:s=>t(r=>({...r,garmentType:s})),children:[e.jsx(K,{children:e.jsx(_,{})}),e.jsx($,{children:ue.map(s=>e.jsx(G,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"articleName",children:"Article Name"}),e.jsx(g,{id:"articleName",value:a.articleName||"",onChange:s=>t(r=>({...r,articleName:s.target.value})),placeholder:"Polo T-Shirt"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Total Rolls"}),e.jsx(g,{value:a.totalRolls||0,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Total KG"}),e.jsx(g,{value:a.totalKg||0,disabled:!0,className:"bg-muted"})]})]})]})]}),e.jsxs(h,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Color Configuration"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Available Colors"}),e.jsxs(I,{onValueChange:q,children:[e.jsx(K,{className:"w-48",children:e.jsx(_,{placeholder:"Add color"})}),e.jsx($,{children:de.filter(s=>!c.includes(s)).map(s=>e.jsx(G,{value:s,children:s},s))})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsxs(U,{variant:"outline",className:"flex items-center",children:[s,c.length>1&&e.jsx("button",{onClick:()=>W(s),className:"ml-2 text-xs hover:text-red-500",children:e.jsx(ae,{className:"h-3 w-3"})})]},s))})]})]}),e.jsx("div",{className:"space-y-4",children:a.colorSizeData?.map((s,r)=>e.jsxs(h,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx("div",{className:`w-4 h-4 rounded-full mr-2 ${s.color.toLowerCase()==="blue"?"bg-blue-500":s.color.toLowerCase()==="green"?"bg-green-500":s.color.toLowerCase()==="black"?"bg-black":s.color.toLowerCase()==="red"?"bg-red-500":"bg-gray-500"}`}),s.color," Color Data"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Rolls Used"}),e.jsx(g,{type:"number",min:"0",value:s.rollsUsed,onChange:l=>w(s.color,"rollsUsed",parseFloat(l.target.value)||0),placeholder:"Number of fabric rolls"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"KG Used"}),e.jsx(g,{type:"number",min:"0",step:"0.1",value:s.kgUsed,onChange:l=>w(s.color,"kgUsed",parseFloat(l.target.value)||0),placeholder:"Fabric weight in KG"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Layers"}),e.jsx(g,{type:"number",min:"1",value:s.layers,onChange:l=>w(s.color,"layers",parseInt(l.target.value)||20),placeholder:"Number of layers cut"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Size Quantities (Pieces per size)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:M.map(l=>{const i=s.sizes.find(m=>m.size===l);return e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-sm",children:l}),e.jsx(g,{type:"number",min:"0",value:i?.pieces||0,onChange:m=>X(s.color,l,parseInt(m.target.value)||0),placeholder:"0",className:"text-center"})]},l)})}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsxs("span",{className:"font-medium",children:["Total ",s.color," Pieces:"]}),e.jsxs(U,{variant:"secondary",className:"text-lg font-bold",children:[s.totalPieces," pcs"]})]})]})]})]},s.color))}),e.jsxs(h,{className:"border-green-200 bg-green-50",children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Cutting Summary"]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalRolls}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Rolls"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.totalKg?.toFixed(1)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total KG"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Colors"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Pieces"})]})]})})]}),e.jsx(h,{children:e.jsx(S,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(F,{variant:"outline",onClick:Q,disabled:B,children:"🧪 Test Firebase"}),e.jsxs(F,{variant:"outline",onClick:H,disabled:B||D===0,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Create Bundles for Sewing Line"]}),e.jsx(F,{onClick:Y,disabled:k||D===0,className:"bg-green-600 hover:bg-green-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Save Cutting Droplet"]})})]})})})]})};export{Se as CuttingDropletManager,Se as default};
