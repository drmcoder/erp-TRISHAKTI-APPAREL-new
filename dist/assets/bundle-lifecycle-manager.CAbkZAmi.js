import{j as e}from"./query-vendor.DpsghfSz.js";import{r as x}from"./react-vendor.CfKEcsXX.js";import{C as u,b as p,c as C,a as w,B as o,d as Q,e as _,I as m}from"./index.CLAiwwTT.js";import{L as r}from"./label.D0ghwUEZ.js";import{S as T,a as S,b as B,c as k,d as n}from"./select.D3_Pn-VW.js";import"./separator.BgmWzbHV.js";import{P as K,a as W,b as X,C as Z}from"./popover.ElchNiQT.js";import{bundleService as v}from"./bundle-service.CrAqiZci.js";import{t as h}from"./index.LBReXyrD.js";import{P as q,A as O,T as E,C as D,a as ee,b as ae,S as se,c as te,R as le,d as ie,U as ne,e as re,f as ce}from"./ui-vendor.EZF4ucWh.js";import{e as L,f as de}from"./utils-vendor.B0NEtgzl.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils.k9sMftog.js";import"./index.CgqrbJCd.js";const oe=[{name:"Cutting",nameNepali:"काट्ने",machineType:"cutting",estimatedHours:2},{name:"Overlock",nameNepali:"ओभरलक",machineType:"overlock",estimatedHours:1.5},{name:"Flatlock",nameNepali:"फ्ल्यालक",machineType:"flatlock",estimatedHours:2},{name:"Button Hole",nameNepali:"बटन होल",machineType:"buttonhole",estimatedHours:3},{name:"Button Attach",nameNepali:"बटन लगाउने",machineType:"button_attach",estimatedHours:1},{name:"Quality Check",nameNepali:"गुणस्तर जाँच",machineType:"quality_check",estimatedHours:.5},{name:"Finishing",nameNepali:"फिनिशिङ",machineType:"finishing",estimatedHours:1},{name:"Pressing",nameNepali:"प्रेसिङ",machineType:"pressing",estimatedHours:.5}],ue={draft:{label:"Draft",color:"bg-gray-100 text-gray-800",icon:se},active:{label:"Active",color:"bg-blue-100 text-blue-800",icon:ae},on_hold:{label:"On Hold",color:"bg-yellow-100 text-yellow-800",icon:ee},completed:{label:"Completed",color:"bg-green-100 text-green-800",icon:D},cancelled:{label:"Cancelled",color:"bg-red-100 text-red-800",icon:E},archived:{label:"Archived",color:"bg-gray-100 text-gray-800",icon:O}},me={low:{label:"Low",color:"bg-green-100 text-green-800"},medium:{label:"Medium",color:"bg-yellow-100 text-yellow-800"},high:{label:"High",color:"bg-orange-100 text-orange-800"},urgent:{label:"Urgent",color:"bg-red-100 text-red-800"}},Be=({mode:t,bundleId:j,onSave:I,onCancel:U})=>{const[s,d]=x.useState(null),[$,H]=x.useState(!1),[F,P]=x.useState(!1),[y,R]=x.useState("overview");x.useEffect(()=>{t!=="create"&&j?M():t==="create"&&b()},[t,j]);const M=async()=>{if(!j){t==="view"&&b();return}try{H(!0);const a=await v.getBundleLifecycle(j);d(a)}catch(a){console.error("Error loading bundle:",a),h.error("Failed to load bundle data"),b()}finally{H(!1)}},b=()=>{const a={id:"",bundleId:`BDL${Date.now()}`,orderNumber:"",client:"",garmentType:"",totalQuantity:0,completedQuantity:0,currentStage:null,stages:oe.map((i,l)=>({id:`stage_${l+1}`,name:i.name,nameNepali:i.nameNepali,sequence:l+1,status:"pending",requiredQuantity:0,completedQuantity:0,machineType:i.machineType,estimatedHours:i.estimatedHours,qualityCheckpoint:i.machineType==="quality_check",dependencies:l>0?[`stage_${l}`]:[],notes:""})),priority:"medium",status:"draft",createdAt:new Date,targetCompletionDate:L(new Date,7),estimatedCompletionDate:L(new Date,7),assignedOperators:[],notes:"",qualityRequirements:[],costBreakdown:{materialCost:0,laborCost:0,overheadCost:0,totalCost:0,profitMargin:0,sellingPrice:0},attachments:[]};d(a)},V=async()=>{if(s)try{P(!0);let a;t==="create"?(a=await v.createBundleLifecycle(s),h.success("Bundle created successfully")):(a=await v.updateBundleLifecycle(s.id,s),h.success("Bundle updated successfully")),d(a),I?.(a)}catch(a){console.error("Error saving bundle:",a),h.error("Failed to save bundle")}finally{P(!1)}},G=async()=>{if(s)try{const a={...s,id:"",bundleId:`BDL${Date.now()}`,status:"draft",completedQuantity:0,createdAt:new Date,startedAt:void 0,actualCompletionDate:void 0,stages:s.stages.map(l=>({...l,status:"pending",completedQuantity:0,startDate:void 0,endDate:void 0,actualHours:void 0}))},i=await v.createBundleLifecycle(a);h.success("Bundle cloned successfully"),d(i)}catch{h.error("Failed to clone bundle")}},c=(a,i)=>{s&&d(l=>l?{...l,[a]:i}:null)},g=(a,i)=>{s&&d(l=>l?{...l,stages:l.stages.map(N=>N.id===a?{...N,...i}:N)}:null)},z=()=>{if(!s)return;const a={id:`stage_${Date.now()}`,name:"New Stage",nameNepali:"नयाँ चरण",sequence:s.stages.length+1,status:"pending",requiredQuantity:s.totalQuantity,completedQuantity:0,machineType:"manual",estimatedHours:1,qualityCheckpoint:!1,dependencies:[],notes:""};d(i=>i?{...i,stages:[...i.stages,a]}:null)},Y=a=>{s&&d(i=>i?{...i,stages:i.stages.filter(l=>l.id!==a)}:null)};if($)return e.jsx(u,{children:e.jsx(p,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});if(!s)return e.jsx(u,{children:e.jsxs(p,{className:"text-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Bundle Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to load bundle data"})]})});const f=ue[s.status],A=me[s.priority],J=f.icon;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.bundleId}),e.jsxs(w,{className:f.color,children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),f.label]}),e.jsx(w,{className:A.color,children:A.label})]}),e.jsx("p",{className:"text-muted-foreground",children:t==="create"?"Create new bundle lifecycle":t==="edit"?"Edit bundle details and stages":"View bundle lifecycle and progress"})]}),e.jsxs("div",{className:"flex space-x-2",children:[t!=="create"&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"outline",onClick:G,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Clone"]}),s.status==="completed"&&e.jsxs(o,{variant:"outline",onClick:()=>c("status","archived"),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Archive"]})]}),t!=="view"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:U,children:"Cancel"}),e.jsxs(o,{onClick:V,disabled:F,children:[F?e.jsx(le,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(D,{className:"h-4 w-4 mr-2"}),t==="create"?"Create Bundle":"Save Changes"]})]})]})]})})}),e.jsx(u,{children:e.jsx(p,{className:"pt-6",children:e.jsx("div",{className:"flex space-x-1 border-b",children:[{id:"overview",label:"Overview",icon:q},{id:"stages",label:"Stages",icon:ie},{id:"quality",label:"Quality",icon:D},{id:"costs",label:"Costs",icon:ne}].map(a=>{const i=a.icon;return e.jsxs("button",{onClick:()=>R(a.id),className:`flex items-center space-x-2 px-4 py-2 rounded-t-lg transition-colors ${y===a.id?"bg-primary text-primary-foreground border-b-2 border-primary":"hover:bg-muted"}`,children:[e.jsx(i,{className:"h-4 w-4"}),e.jsx("span",{children:a.label})]},a.id)})})})}),y==="overview"&&e.jsxs(u,{children:[e.jsxs(C,{children:[e.jsx(Q,{children:"Bundle Overview"}),e.jsx(_,{children:"Basic information and settings"})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"orderNumber",children:"Order Number"}),e.jsx(m,{id:"orderNumber",value:s.orderNumber,onChange:a=>c("orderNumber",a.target.value),disabled:t==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"client",children:"Client"}),e.jsx(m,{id:"client",value:s.client,onChange:a=>c("client",a.target.value),disabled:t==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"garmentType",children:"Garment Type"}),e.jsx(m,{id:"garmentType",value:s.garmentType,onChange:a=>c("garmentType",a.target.value),disabled:t==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"totalQuantity",children:"Total Quantity"}),e.jsx(m,{id:"totalQuantity",type:"number",value:s.totalQuantity,onChange:a=>c("totalQuantity",parseInt(a.target.value)),disabled:t==="view"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority"}),e.jsxs(T,{value:s.priority,onValueChange:a=>c("priority",a),disabled:t==="view",children:[e.jsx(S,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"low",children:"Low"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(T,{value:s.status,onValueChange:a=>c("status",a),disabled:t==="view",children:[e.jsx(S,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"draft",children:"Draft"}),e.jsx(n,{value:"active",children:"Active"}),e.jsx(n,{value:"on_hold",children:"On Hold"}),e.jsx(n,{value:"completed",children:"Completed"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Target Completion Date"}),e.jsxs(K,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(o,{variant:"outline",disabled:t==="view",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),de(new Date(s.targetCompletionDate),"PPP")]})}),e.jsx(X,{className:"w-auto p-0",children:e.jsx(Z,{selected:new Date(s.targetCompletionDate),onSelect:a=>a&&c("targetCompletionDate",a),mode:"single"})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",className:"w-full min-h-[100px] p-3 border rounded-md",value:s.notes,onChange:a=>c("notes",a.target.value),disabled:t==="view",placeholder:"Add any additional notes or instructions..."})]})]})]}),y==="stages"&&e.jsxs(u,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Production Stages"}),e.jsx(_,{children:"Configure the manufacturing workflow"})]}),t!=="view"&&e.jsxs(o,{onClick:z,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Stage"]})]})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:s.stages.map((a,i)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:a.sequence}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:[a.name," (",a.nameNepali,")"]}),e.jsx(w,{className:a.status==="completed"?"bg-green-100 text-green-800":a.status==="in_progress"?"bg-blue-100 text-blue-800":a.status==="blocked"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:a.status.replace("_"," ").toUpperCase()})]})]}),t!=="view"&&e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>Y(a.id),children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Stage Name"}),e.jsx(m,{value:a.name,onChange:l=>g(a.id,{name:l.target.value}),disabled:t==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Machine Type"}),e.jsxs(T,{value:a.machineType,onValueChange:l=>g(a.id,{machineType:l}),disabled:t==="view",children:[e.jsx(S,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"cutting",children:"Cutting"}),e.jsx(n,{value:"overlock",children:"Overlock"}),e.jsx(n,{value:"flatlock",children:"Flatlock"}),e.jsx(n,{value:"buttonhole",children:"Buttonhole"}),e.jsx(n,{value:"button_attach",children:"Button Attach"}),e.jsx(n,{value:"embroidery",children:"Embroidery"}),e.jsx(n,{value:"quality_check",children:"Quality Check"}),e.jsx(n,{value:"finishing",children:"Finishing"}),e.jsx(n,{value:"pressing",children:"Pressing"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Estimated Hours"}),e.jsx(m,{type:"number",step:"0.5",value:a.estimatedHours,onChange:l=>g(a.id,{estimatedHours:parseFloat(l.target.value)}),disabled:t==="view"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(r,{children:"Notes"}),e.jsx("textarea",{className:"w-full mt-1 p-2 border rounded",rows:2,value:a.notes,onChange:l=>g(a.id,{notes:l.target.value}),disabled:t==="view",placeholder:"Stage-specific notes or instructions..."})]})]},a.id))})})]})]})};export{Be as BundleLifecycleManager,Be as default};
