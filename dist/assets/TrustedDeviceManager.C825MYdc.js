import{j as e}from"./query-vendor.DpsghfSz.js";import{r as o}from"./react-vendor.CfKEcsXX.js";import{w as v,B as l,C as c,b as i,I as F,c as b,d as T,k as O,a as N}from"./index.B3OoR7j1.js";import{t as f}from"./index.LBReXyrD.js";import{E as $,F as D,y,G as k,U as q,e as H,B as U,H as _,k as G,l as J,T as K,z as P}from"./ui-vendor.D5U9TC-3.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const te=()=>{const[x,C]=o.useState([]),[m,w]=o.useState(""),[a,g]=o.useState(new Set),[h,p]=o.useState("all"),[n,I]=o.useState(null);o.useEffect(()=>{u(),j()},[]);const u=()=>{const s=JSON.parse(localStorage.getItem("tsaerp_trusted_devices")||"[]");C(s)},j=()=>{const s=v.getSecuritySummary();I(s)},S=()=>{let s=x;return h==="trusted"?s=s.filter(t=>t.isTrusted&&t.isActive):h==="inactive"&&(s=s.filter(t=>!t.isActive||!t.isTrusted)),m&&(s=s.filter(t=>t.operatorName.toLowerCase().includes(m.toLowerCase())||t.operatorId.toLowerCase().includes(m.toLowerCase())||t.deviceId.toLowerCase().includes(m.toLowerCase()))),s.sort((t,r)=>new Date(r.lastLoginDate).getTime()-new Date(t.lastLoginDate).getTime())},A=async(s,t,r)=>{try{v.revokeTrust(t,s),u(),j(),f.success(`ðŸ”’ Revoked trust for ${r}'s device`)}catch{f.error("Failed to revoke device trust")}},L=async()=>{if(a.size===0)return;const s=x.filter(t=>a.has(t.deviceId));for(const t of s)v.revokeTrust(t.operatorId,t.deviceId);u(),j(),g(new Set),f.success(`ðŸ”’ Revoked trust for ${s.length} devices`)},R=(s,t)=>{const r=new Set(a);t?r.add(s):r.delete(s),g(r)},z=s=>{if(s){const t=S();g(new Set(t.map(r=>r.deviceId)))}else g(new Set)},B=s=>{const t=s.userAgent?.toLowerCase()||"";return t.includes("mobile")||t.includes("android")||t.includes("iphone")?e.jsx(P,{className:"w-4 h-4"}):e.jsx(k,{className:"w-4 h-4"})},M=s=>s.isTrusted&&s.isActive?e.jsx(N,{className:"bg-green-100 text-green-800",children:"Trusted"}):s.isActive?e.jsx(N,{className:"bg-yellow-100 text-yellow-800",children:"Building Trust"}):e.jsx(N,{className:"bg-gray-100 text-gray-800",children:"Inactive"}),E=s=>{const t=Math.floor((Date.now()-new Date(s).getTime())/864e5);return t===0?"Today":`${t} days ago`},d=S();return e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Trusted Device Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage operator devices and security settings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",leftIcon:e.jsx($,{className:"w-4 h-4"}),onClick:()=>u(),children:"Refresh"}),a.size>0&&e.jsxs(l,{variant:"danger",leftIcon:e.jsx(D,{className:"w-4 h-4"}),onClick:L,children:["Revoke Selected (",a.size,")"]})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(i,{className:"flex items-center p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.trustedDevices}),e.jsx("p",{className:"text-sm text-gray-500",children:"Trusted Devices"})]})]})})}),e.jsx(c,{children:e.jsx(i,{className:"flex items-center p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalDevices}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Devices"})]})]})})}),e.jsx(c,{children:e.jsx(i,{className:"flex items-center p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.operators.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"Active Operators"})]})]})})}),e.jsx(c,{children:e.jsx(i,{className:"flex items-center p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:[n.oldestTrust?Math.floor((Date.now()-new Date(n.oldestTrust).getTime())/(1e3*60*60*24)):0," days"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Oldest Trust"})]})]})})})]}),e.jsx(c,{children:e.jsx(i,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{leftIcon:e.jsx(U,{className:"w-4 h-4"}),placeholder:"Search by operator name, ID, or device...",value:m,onChange:s=>w(s.target.value),clearable:!0,onClear:()=>w("")})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:h==="all"?"primary":"outline",size:"sm",onClick:()=>p("all"),children:["All (",x.length,")"]}),e.jsxs(l,{variant:h==="trusted"?"primary":"outline",size:"sm",onClick:()=>p("trusted"),children:["Trusted (",x.filter(s=>s.isTrusted&&s.isActive).length,")"]}),e.jsxs(l,{variant:h==="inactive"?"primary":"outline",size:"sm",onClick:()=>p("inactive"),children:["Inactive (",x.filter(s=>!s.isActive||!s.isTrusted).length,")"]})]})]})})}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Device List (",d.length,")"]}),d.length>0&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.size===d.length&&d.length>0,onChange:s=>z(s.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Select All"})]})]})}),e.jsx(i,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No devices found"}),e.jsx("p",{className:"text-sm",children:"No trusted devices match your current filters."})]}):e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:O("flex items-center gap-4 p-4 border rounded-lg transition-all duration-200",a.has(s.deviceId)?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[e.jsx("input",{type:"checkbox",checked:a.has(s.deviceId),onChange:t=>R(s.deviceId,t.target.checked),className:"rounded border-gray-300"}),e.jsx("div",{className:"flex-shrink-0",children:B(s.fingerprint)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:s.operatorName}),M(s),s.isTrusted&&s.isActive&&e.jsx(_,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",s.operatorId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Logins:"})," ",s.successfulLogins,"/",s.loginCount]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),E(s.lastLoginDate)]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 font-mono truncate",children:["Device: ",s.deviceId," â€¢ ",s.fingerprint.platform]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.isTrusted&&s.isActive&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>A(s.deviceId,s.operatorId,s.operatorName),leftIcon:e.jsx(D,{className:"w-3 h-3"}),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:"Revoke"})})]},s.deviceId))})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(T,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(J,{className:"w-5 h-5"}),"Security Actions"]})}),e.jsxs(i,{children:[e.jsx("div",{className:"flex gap-4",children:e.jsx(l,{variant:"outline",leftIcon:e.jsx(K,{className:"w-4 h-4"}),onClick:()=>{confirm("Are you sure you want to clear ALL trusted devices? This will require all operators to build trust again.")&&(v.clearAllTrustedDevices(),u(),j(),f.success("ðŸ”’ All trusted devices cleared"))},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:"Clear All Trusted Devices"})}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Security Note:"})," Revoking device trust will require the operator to login normally 5 more times before automatic login is re-enabled."]})})]})]})]})};export{te as default};
