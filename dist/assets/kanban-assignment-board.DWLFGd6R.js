import{j as e}from"./query-vendor.DpsghfSz.js";import{r as l}from"./react-vendor.CfKEcsXX.js";import{a as o,B as x,C as d,q as A}from"./index.B3OoR7j1.js";import{u as P}from"./useI18n.Cd33OMab.js";import{L as B}from"./LoadingSpinner.rP8tyFue.js";import{EnhancedBundleService as j}from"./enhanced-bundle-service.CeWC5GFY.js";import{F as L}from"./ClockIcon.B0z2Gpg3.js";import{F as $}from"./CurrencyDollarIcon.n5hpspjn.js";import{F as k}from"./PlayIcon.C6pbtimh.js";import{F as K}from"./UserIcon.BzFG2rMW.js";import{F as E}from"./ArrowRightIcon.DKQtkxcN.js";import"./ui-vendor.D5U9TC-3.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const se=({userRole:M})=>{const{currentLocale:N}=P(),[O,b]=l.useState(!0),[h,T]=l.useState([]),[i,g]=l.useState(null),[m,v]=l.useState(null),[c,p]=l.useState([{id:"pending",title:"Pending Assignment",titleNepali:"à¤…à¤¸à¤¾à¤‡à¤¨à¤®à¥‡à¤¨à¥à¤Ÿ à¤¬à¤¾à¤à¤•à¥€",color:"bg-gray-50 border-gray-200",operations:[]},{id:"assigned",title:"Assigned",titleNepali:"à¤…à¤¸à¤¾à¤‡à¤¨ à¤—à¤°à¤¿à¤à¤•à¥‹",color:"bg-blue-50 border-blue-200",operations:[]},{id:"in_progress",title:"In Progress",titleNepali:"à¤šà¤²à¤¿à¤°à¤¹à¥‡à¤•à¥‹",color:"bg-yellow-50 border-yellow-200",operations:[]},{id:"completed",title:"Completed",titleNepali:"à¤¸à¤•à¤¿à¤à¤•à¥‹",color:"bg-green-50 border-green-200",operations:[]}]);l.useEffect(()=>{f()},[]);const f=async()=>{b(!0);try{const[s,a]=await Promise.all([j.getPendingOperations({limit:20}),j.getAvailableOperators()]);if(s.success&&s.data&&s.data.length>0){console.log("ðŸ“Š Kanban: Loaded operations from Firebase:",s.data);const t=[...c];t[0].operations=s.data,p(t)}else{console.log("âš ï¸ Kanban: No operations data received, creating sample data...",s);try{(await j.createSampleData()).success&&(console.log("âœ… Sample data created, reloading..."),setTimeout(()=>f(),1e3))}catch(t){console.error("Failed to create sample data:",t)}}a.success&&a.data&&T(a.data)}catch(s){console.error("Failed to load kanban data:",s)}finally{b(!1)}},y=s=>N==="ne"&&s.nameNepali||s.name,w=s=>N==="ne"?s.titleNepali:s.title,C=(s,a)=>{v(a),s.dataTransfer.effectAllowed="move"},F=(s,a)=>{if(s.preventDefault(),!m)return;let t=null;const r=c.map((n,I)=>{const D=n.operations.findIndex(u=>u.id===m);return D!==-1?(t=n.operations[D],{...n,operations:n.operations.filter(u=>u.id!==m)}):n});if(t){const n=r.findIndex(I=>I.id===a);n!==-1&&r[n].operations.push(t)}p(r),v(null)},R=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},S=(s,a)=>{const t=c.map(r=>r.id==="pending"?{...r,operations:r.operations.filter(n=>n.id!==s.id)}:r.id==="assigned"?{...r,operations:[...r.operations,{...s,assignedTo:a.name}]}:r);p(t),g(null)};return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(B,{label:"Loading Kanban board..."})}):e.jsxs("div",{className:"p-4 space-y-6 max-w-full overflow-x-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:"ðŸ“‹ Kanban Assignment Board"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visual workflow management - drag operations between columns"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:"outline",className:"px-3 py-1",children:[h.length," Operators Available"]}),e.jsx(x,{size:"sm",onClick:f,children:"ðŸ”„ Refresh"})]})]}),e.jsxs(d,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"How to Use Kanban Board:"})]}),e.jsxs("div",{className:"text-blue-800 text-sm space-y-1",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Drag operations"})," between columns to update their status"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Click on an operation"})," to assign it to an operator"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Move left to right:"})," Pending â†’ Assigned â†’ In Progress â†’ Completed"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 min-h-96",children:c.map(s=>e.jsxs(d,{className:`p-4 ${s.color} border-2 border-dashed`,onDrop:a=>F(a,s.id),onDragOver:R,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w(s)}),e.jsx(o,{variant:"secondary",className:"text-xs",children:s.operations.length})]}),e.jsx("div",{className:"space-y-3",children:s.operations.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“­"}),e.jsx("p",{className:"text-sm",children:"No operations"})]}):s.operations.map(a=>e.jsx(d,{draggable:!0,onDragStart:t=>C(t,a.id),onClick:()=>g(a),className:`p-3 cursor-move hover:shadow-lg transition-all ${m===a.id?"opacity-50":""} ${i?.id===a.id?"ring-2 ring-blue-500":""}`,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:y(a)}),a.assignedTo&&e.jsxs(o,{variant:"outline",className:"text-xs",children:["ðŸ‘¤ ",a.assignedTo]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-800 font-medium",children:["ðŸ“¦ ",e.jsx("strong",{children:a.bundleInfo.bundleNumber})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["ðŸ·ï¸ Batch: ",a.bundleInfo.batchNumber||"B001"," â€¢ ",a.bundleInfo.quantity||50," pieces"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),a.smvMinutes,"min/piece"]}),e.jsxs("div",{className:"flex items-center text-blue-600 font-medium",children:["â±ï¸ Total: ",Math.round((a.bundleInfo.quantity||50)*a.smvMinutes/60),"h"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"$",a.pricePerPiece,"/piece"]}),e.jsxs("div",{className:"flex items-center text-green-700 font-bold",children:["ðŸ’° $",((a.bundleInfo.quantity||50)*a.pricePerPiece).toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-xs",children:[e.jsx("div",{className:"text-gray-700 font-medium mb-1",children:"ðŸ” Last Done By:"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ‘· Maya Patel"}),e.jsx("span",{className:"text-yellow-600",children:"â­ 9.2/10"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"ðŸ“… 2 days ago"}),e.jsx("span",{className:"text-blue-600",children:"âš¡ 94% efficiency"})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(o,{variant:"outline",className:"text-xs",children:["ðŸ”§ ",a.machineType]}),e.jsx(o,{variant:a.bundleInfo.priority==="high"||a.bundleInfo.priority==="urgent"?"destructive":"secondary",className:"text-xs",children:a.bundleInfo.priority==="high"?"ðŸ”¥ HIGH":a.bundleInfo.priority==="urgent"?"âš¡ URGENT":a.bundleInfo.priority==="low"?"ðŸ“‹ LOW":"âž– NORMAL"})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-gray-100",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“… Due: ",a.bundleInfo.dueDate?new Date(a.bundleInfo.dueDate).toLocaleDateString():"Today"]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(x,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",title:"View Details",children:e.jsx(A,{className:"h-3 w-3"})}),s.id==="assigned"&&e.jsx(x,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",title:"Start Work",children:e.jsx(k,{className:"h-3 w-3"})})]})]})]})},a.id))})]},s.id))}),i&&e.jsxs(d,{className:"p-4 bg-green-50 border-green-200 border-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"Assign Operation to Operator"}),e.jsxs("p",{className:"text-sm text-green-800",children:["Selected: ",e.jsx("strong",{children:y(i)})," - ",i.bundleInfo.bundleNumber]})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>g(null),className:"text-green-700",children:"âœ• Cancel"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:h.filter(s=>s.status==="available"&&s.machineType===i.machineType).map(s=>e.jsx(d,{className:"p-3 cursor-pointer hover:shadow-md transition-all border border-green-200",onClick:()=>S(i,s),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[e.jsxs("span",{children:[s.efficiency,"% efficiency"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[s.currentWorkload," active"]})]})]}),e.jsx(E,{className:"h-4 w-4 text-green-600"})]})},s.id))}),h.filter(s=>s.status==="available"&&s.machineType===i.machineType).length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsxs("p",{className:"text-sm",children:["No compatible operators available for ",i.machineType," machine"]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:c.map(s=>e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.operations.length}),e.jsx("p",{className:"text-sm text-gray-600",children:w(s)})]},s.id))})]})};export{se as KanbanAssignmentBoard,se as default};
