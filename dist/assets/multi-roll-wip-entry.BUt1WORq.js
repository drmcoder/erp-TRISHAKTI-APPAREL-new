import{j as e}from"./query-vendor.BbCCZTU0.js";import{r as d}from"./react-vendor.BcnQP8kQ.js";import{a as B,C as b,e as y,f as C,d as w,B as j}from"./index.BnZjV7b3.js";import{I as m}from"./Input.D8gd7mOf.js";import{L as o}from"./label.BNDYRuzi.js";import{S as V}from"./select.BqvOc8nJ.js";import{F as M}from"./CubeIcon.GiNCwurg.js";import{F as J}from"./PlusIcon.C8HC3Ss7.js";import{F as U}from"./TrashIcon.DGI7XY7r.js";import{F as $}from"./DocumentDuplicateIcon.D0-8m2Wo.js";import{F as Z}from"./ScissorsIcon.CEEGcgg5.js";import{F as D}from"./CalculatorIcon.DgIxNmEr.js";import"./ui-vendor.B7YYMSVe.js";import"./utils-vendor.B0NEtgzl.js";function K({title:S,titleId:P,...c},r){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":P},c),S?d.createElement("title",{id:P},S):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z"}))}const Y=d.forwardRef(K),ee=[{id:"front",name:"Front Panel",nameNepali:"अगाडिको भाग",quantityPerGarment:1,cuttingTime:.5},{id:"back",name:"Back Panel",nameNepali:"पछाडिको भाग",quantityPerGarment:1,cuttingTime:.5},{id:"sleeve_left",name:"Left Sleeve",nameNepali:"बायाँ बाहुला",quantityPerGarment:1,cuttingTime:.3},{id:"sleeve_right",name:"Right Sleeve",nameNepali:"दायाँ बाहुला",quantityPerGarment:1,cuttingTime:.3},{id:"neck_rib",name:"Neck Rib",nameNepali:"घाँटीको रिब",quantityPerGarment:1,cuttingTime:.2}],te=["Blue","Green","Black","White","Red","Navy","Grey"],ge=({onSave:S,onCancel:P,initialData:c})=>{const[r,u]=d.useState(()=>({id:c?.id||`batch_${Date.now()}`,batchNumber:c?.batchNumber||"",date:c?.date||new Date,articleNumber:c?.articleNumber||"",articleName:c?.articleName||"",garmentParts:c?.garmentParts||[...ee],rolls:c?.rolls||[],colorBatches:c?.colorBatches||[],bundles:c?.bundles||[],totalGarments:c?.totalGarments||0,totalParts:c?.totalParts||0,estimatedCuttingTime:c?.estimatedCuttingTime||0,status:c?.status||"draft"})),[k,I]=d.useState("1:1:1:1"),[p,L]=d.useState(0),g=d.useMemo(()=>{const t=r.colorBatches.reduce((l,n)=>l+n.totalGarments,0),s=r.garmentParts.reduce((l,n)=>l+n.quantityPerGarment*t,0),a=r.garmentParts.reduce((l,n)=>l+n.cuttingTime*n.quantityPerGarment*t,0);return{totalGarments:t,totalParts:s,estimatedCuttingTime:a}},[r.colorBatches,r.garmentParts]);d.useEffect(()=>{u(t=>({...t,totalGarments:g.totalGarments,totalParts:g.totalParts,estimatedCuttingTime:g.estimatedCuttingTime}))},[g]);const F=d.useCallback(t=>{const s=[];if(t.includes(":")){const a=t.split(":").map(n=>parseInt(n.trim())||0),l=["L","XL","2XL","3XL"];a.forEach((n,x)=>{l[x]&&n>0&&s.push({size:l[x],ratio:n,actualQuantity:0})})}return s},[]),z=d.useCallback(()=>{const t={id:`roll_${Date.now()}`,rollNumber:"",weight:0,color:"",fabricType:"",layers:0,length:0,width:60,supplier:"",receivedDate:new Date};u(s=>({...s,rolls:[...s.rolls,t]}))},[]),h=d.useCallback((t,s)=>{u(a=>({...a,rolls:a.rolls.map(l=>l.id===t?{...l,...s}:l)}))},[]),q=d.useCallback(t=>{u(s=>({...s,rolls:s.rolls.filter(a=>a.id!==t)}))},[]),A=d.useCallback(()=>{const t=[],s=F(k),a=r.rolls.reduce((l,n)=>(l[n.color]||(l[n.color]=[]),l[n.color].push(n),l),{});Object.entries(a).forEach(([l,n])=>{const x=n.reduce((i,f)=>i+f.layers,0),N=s.reduce((i,f)=>i+f.ratio,0),R=s.map(i=>({...i,actualQuantity:Math.floor(x*i.ratio/N)})),v=R.reduce((i,f)=>i+(f.actualQuantity||0),0),T={};r.garmentParts.forEach(i=>{T[i.name]=v*i.quantityPerGarment}),t.push({id:`batch_${l}_${Date.now()}`,color:l,rollIds:n.map(i=>i.id),totalLayers:x,sizeRatios:R,totalGarments:v,parts:T})}),u(l=>({...l,colorBatches:t}))},[r.rolls,r.garmentParts,k,F]),_=d.useCallback(()=>{const t=[];let s=1;r.colorBatches.forEach(a=>{a.sizeRatios.forEach(l=>{!l.actualQuantity||l.actualQuantity===0||r.garmentParts.forEach(n=>{const x=l.actualQuantity*n.quantityPerGarment,N=25,R=Math.ceil(x/N);for(let v=0;v<R;v++){const T=x-v*N,i=Math.min(N,T);t.push({id:`bundle_${s++}`,bundleNumber:`B${String(s).padStart(3,"0")}`,color:a.color,size:l.size,partName:n.name,quantity:i,rollSource:a.rollIds.join(","),layerRange:`1-${a.totalLayers}`,operation:Q(n.name),estimatedTime:i*n.cuttingTime,status:"pending"})}})})}),u(a=>({...a,bundles:t}))},[r.colorBatches,r.garmentParts]),Q=t=>({"Front Panel":"Cutting → Shoulder Join","Back Panel":"Cutting → Shoulder Join","Left Sleeve":"Cutting → Side Seam","Right Sleeve":"Cutting → Side Seam","Neck Rib":"Cutting → Neck Attach"})[t]||"Cutting",O=t=>{t.preventDefault(),S(r)},G=()=>e.jsxs(b,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Roll Management"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Add multiple fabric rolls with their specifications"})]}),e.jsxs(j,{type:"button",onClick:z,size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Roll"]})]}),e.jsx(w,{className:"space-y-6",children:r.rolls.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No rolls added yet"}),e.jsx("p",{className:"text-sm",children:"Add fabric rolls to start planning production"})]}):r.rolls.map((t,s)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold",children:["Roll ",s+1]}),e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:()=>q(t.id),className:"text-red-600 hover:text-red-800",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Roll Number *"}),e.jsx(m,{value:t.rollNumber,onChange:a=>h(t.id,{rollNumber:a.target.value}),placeholder:"e.g., Roll A"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Weight (kg) *"}),e.jsx(m,{type:"number",value:t.weight||"",onChange:a=>h(t.id,{weight:parseFloat(a.target.value)||0}),placeholder:"e.g., 21"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Color *"}),e.jsxs(V,{value:t.color,onValueChange:a=>h(t.id,{color:a}),children:[e.jsx("option",{value:"",children:"Select color"}),te.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Layers *"}),e.jsx(m,{type:"number",value:t.layers||"",onChange:a=>h(t.id,{layers:parseInt(a.target.value)||0}),placeholder:"e.g., 30"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Fabric Type"}),e.jsx(m,{value:t.fabricType,onChange:a=>h(t.id,{fabricType:a.target.value}),placeholder:"e.g., Cotton"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Length (m)"}),e.jsx(m,{type:"number",value:t.length||"",onChange:a=>h(t.id,{length:parseFloat(a.target.value)||0}),placeholder:"e.g., 100"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Width (inches)"}),e.jsx(m,{type:"number",value:t.width||"",onChange:a=>h(t.id,{width:parseFloat(a.target.value)||0}),placeholder:"e.g., 60"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Supplier"}),e.jsx(m,{value:t.supplier,onChange:a=>h(t.id,{supplier:a.target.value}),placeholder:"Supplier name"})]})]})]},t.id))})]}),X=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Size Ratio Configuration"]})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(o,{children:"Size Ratio Pattern"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(m,{value:k,onChange:t=>I(t.target.value),placeholder:"e.g., 1:2:2:1 for L:XL:2XL:3XL",className:"flex-1"}),e.jsxs(j,{type:"button",onClick:A,variant:"outline",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Calculate"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Format: L:XL:2XL:3XL ratio (e.g., 1:1:1:1 for equal, 1:2:2:1 for weighted)"})]})})]}),r.colorBatches.length>0&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(C,{children:"Color Batch Summary"})}),e.jsx(w,{className:"space-y-4",children:r.colorBatches.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:t.color.toLowerCase()}}),t.color," Color Batch"]}),e.jsxs(B,{variant:"secondary",children:[t.totalLayers," layers • ",t.totalGarments," garments"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:t.sizeRatios.map(s=>e.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-semibold",children:s.size}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.actualQuantity," pcs"]})]},s.size))}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Parts Breakdown:"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-2 text-sm",children:Object.entries(t.parts).map(([s,a])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-gray-600",children:[a," pcs"]})]},s))})]})]},t.id))})]})]}),W=()=>e.jsxs(b,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Production Bundles"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Generated bundles ready for production line assignment"})]}),e.jsxs(j,{type:"button",onClick:_,variant:"outline",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Generate Bundles"]})]}),e.jsx(w,{children:r.bundles.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No bundles generated yet"}),e.jsx("p",{className:"text-sm",children:"Generate bundles from your color batches"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.bundles.slice(0,9).map(t=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(B,{variant:"outline",children:t.bundleNumber}),e.jsx(B,{variant:"secondary",style:{backgroundColor:`${t.color.toLowerCase()}20`},children:t.color})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Size:"})," ",t.size]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Part:"})," ",t.partName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",t.quantity," pcs"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Operation:"})," ",t.operation]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Est. Time:"})," ",t.estimatedTime.toFixed(1),"min"]})]})]},t.id))}),r.bundles.length>9&&e.jsxs("div",{className:"text-center text-gray-500 text-sm",children:["+",r.bundles.length-9," more bundles"]}),e.jsxs("div",{className:"mt-4 pt-4 border-t bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Bundle Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Total Bundles"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:r.bundles.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Total Garments"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:g.totalGarments})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Total Parts"}),e.jsx("div",{className:"text-xl font-bold text-purple-600",children:g.totalParts})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Est. Time"}),e.jsxs("div",{className:"text-xl font-bold text-orange-600",children:[Math.ceil(g.estimatedCuttingTime/60),"h"]})]})]})]})]})})]}),H=()=>{switch(p){case 0:return G();case 1:return X();case 2:return W();default:return G()}},E=["Rolls","Ratios","Bundles"];return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Multi-Roll WIP Entry System"}),e.jsx("p",{className:"text-gray-600",children:"Complete garment manufacturing workflow with layering and bundle management"})]}),e.jsx(B,{variant:"secondary",children:r.status.replace("_"," ").toUpperCase()})]}),e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(C,{children:"Batch Information"})}),e.jsxs(w,{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Batch Number *"}),e.jsx(m,{value:r.batchNumber,onChange:t=>u(s=>({...s,batchNumber:t.target.value})),placeholder:"e.g., BATCH-001"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Article Number *"}),e.jsx(m,{value:r.articleNumber,onChange:t=>u(s=>({...s,articleNumber:t.target.value})),placeholder:"e.g., TSA-TSHIRT-001"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Article Name *"}),e.jsx(m,{value:r.articleName,onChange:t=>u(s=>({...s,articleName:t.target.value})),placeholder:"e.g., Basic Cotton T-Shirt"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Production Date"}),e.jsx(m,{type:"date",value:r.date.toISOString().split("T")[0],onChange:t=>u(s=>({...s,date:new Date(t.target.value)}))})]})]})]}),e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"flex space-x-8",children:E.map((t,s)=>e.jsxs("button",{type:"button",onClick:()=>L(s),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${s===p?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s+1,". ",t]},t))})}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[H(),e.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{type:"button",variant:"outline",onClick:P,children:"Cancel"}),p>0&&e.jsx(j,{type:"button",variant:"outline",onClick:()=>L(p-1),children:"Previous"})]}),e.jsx("div",{className:"flex gap-3",children:p<E.length-1?e.jsx(j,{type:"button",onClick:()=>L(p+1),children:"Next"}):e.jsx(j,{type:"submit",children:"Save WIP Entry"})})]})]})]})};export{ge as MultiRollWIPEntry,ge as default};
