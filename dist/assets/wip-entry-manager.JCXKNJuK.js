const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.CUWf0ERd.js","assets/query-vendor.DpsghfSz.js","assets/react-vendor.CfKEcsXX.js","assets/ui-vendor.D450QVBF.js","assets/firebase-vendor.D8xw0AXf.js","assets/utils-vendor.B0NEtgzl.js","assets/index.CF9gheD0.css"])))=>i.map(i=>d[i]);
import{_ as P,C as N,a as S}from"./index.CUWf0ERd.js";import{j as e}from"./query-vendor.DpsghfSz.js";import{r as h}from"./react-vendor.CfKEcsXX.js";import{L as V}from"./LoadingSpinner.DUO60hBS.js";import{f as c,g as B}from"./firebase-data-display.B6MPT4-A.js";import"./ui-vendor.D450QVBF.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const z=({userRole:l,userData:v})=>{const[p,E]=h.useState([]),[s,d]=h.useState(!0),[y,f]=h.useState(null),[i,a]=h.useState(null);h.useEffect(()=>{n()},[]);const n=async()=>{d(!0);try{const{collection:t,getDocs:j,query:m,orderBy:x}=await P(async()=>{const{collection:g,getDocs:o,query:r,orderBy:u}=await import("./firebase-vendor.D8xw0AXf.js").then(b=>b.al);return{collection:g,getDocs:o,query:r,orderBy:u}},[]),{db:_}=await P(async()=>{const{db:g}=await import("./index.CUWf0ERd.js").then(o=>o.O);return{db:g}},__vite__mapDeps([0,1,2,3,4,5,6])),C=t(_,"production_bundles"),k=m(C,x("createdAt","desc")),w=await j(k);if(w.empty)E([]);else{const g=w.docs.map(o=>{const r=o.data();return{id:o.id,bundleNumber:r.bundleNumber||`BND-${o.id.slice(-8)}`,articleNumber:r.articleNumber||r.articleId,articleStyle:r.articleStyle||r.style,targetPieces:r.targetPieces||r.quantity,quantity:r.quantity||r.targetPieces,priority:r.priority,status:r.status,createdAt:r.createdAt?.toDate?.()||new Date,operations:r.operations||[],createdBy:r.createdBy,editHistory:r.editHistory||[]}});E(g)}}catch(t){console.error("Error loading WIP entries:",t),E([])}d(!1)},I=async(t,j,m)=>{try{const{doc:x,updateDoc:_,arrayUnion:C,serverTimestamp:k}=await P(async()=>{const{doc:u,updateDoc:b,arrayUnion:H,serverTimestamp:A}=await import("./firebase-vendor.D8xw0AXf.js").then(W=>W.al);return{doc:u,updateDoc:b,arrayUnion:H,serverTimestamp:A}},[]),{db:w}=await P(async()=>{const{db:u}=await import("./index.CUWf0ERd.js").then(b=>b.O);return{db:u}},__vite__mapDeps([0,1,2,3,4,5,6])),g=Object.entries(j).map(([u,b])=>({field:u,oldValue:t[u],newValue:b})),o={id:`edit_${Date.now()}`,editedAt:new Date,editedBy:D(l),changes:g,reason:m},r=x(w,"production_bundles",t.id);await _(r,{...j,editHistory:C(o),lastModified:k(),lastModifiedBy:D(l)}),await n(),f(null),alert(`âœ… WIP Entry ${t.bundleNumber} updated successfully!`)}catch(x){console.error("Error updating WIP entry:",x),alert("âŒ Failed to update WIP entry. Please try again.")}},D=t=>{if(v?.name)return v.name;switch(t){case"operator":return"Operator";case"supervisor":return"Supervisor";case"admin":return"Admin User";default:return"Unknown User"}};return s?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(V,{}),e.jsx("p",{className:"ml-3",children:"Loading WIP entries..."})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["ðŸ“š Edit History - ",i.bundleNumber]}),e.jsx("button",{onClick:()=>a(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"â† Back to WIP Entries"})]}),e.jsxs(N,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Bundle Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Bundle:"}),e.jsx("p",{className:"font-medium",children:i.bundleNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Article:"}),e.jsx("p",{className:"font-medium",children:c(i.articleNumber)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Style:"}),e.jsx("p",{className:"font-medium",children:c(i.articleStyle)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Pieces:"}),e.jsx("p",{className:"font-medium",children:c(i.targetPieces)})]})]})]}),i.editHistory&&i.editHistory.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["ðŸ“ Edit History (",i.editHistory.length," edits)"]}),i.editHistory.map((t,j)=>e.jsxs(N,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.editedBy}),e.jsx("p",{className:"text-sm text-gray-500",children:t.editedAt instanceof Date?t.editedAt.toLocaleString():new Date().toLocaleString()})]}),e.jsxs(S,{variant:"outline",children:["Edit #",i.editHistory.length-j]})]}),t.reason&&e.jsx("div",{className:"mb-3 p-2 bg-blue-50 rounded",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Reason:"})," ",t.reason]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Changes made:"}),t.changes.map((m,x)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[m.field,":"]}),e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs",children:c(m.oldValue,{fallbackValue:"Empty"})}),e.jsx("span",{className:"text-gray-400",children:"â†’"}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:c(m.newValue,{fallbackValue:"Empty"})})]},x))]})]},t.id))]}):e.jsxs(N,{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Edit History"}),e.jsx("p",{className:"text-gray-600",children:"This WIP entry has not been modified since creation."})]})]}):y?e.jsx(L,{entry:y,onSave:I,onCancel:()=>f(null),userRole:l}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ðŸ“ WIP Entry Management"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(S,{variant:"outline",children:[p.length," entries found"]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"ðŸ”„ Refresh"})]})]}),p.length===0?e.jsxs(N,{className:"p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No WIP Entries Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:B("bundles",!1)}),e.jsxs("p",{className:"text-sm text-blue-600",children:["ðŸ’¡ Create WIP entries using the ",e.jsx("strong",{children:"WIP Entry"})," form, then manage them here!"]})]}):e.jsx("div",{className:"grid gap-4",children:p.map(t=>e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.bundleNumber}),e.jsxs("p",{className:"text-gray-600",children:[c(t.articleStyle,{fallbackValue:"Article"})," - ",c(t.targetPieces)," pieces"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Created by ",c(t.createdBy)," on ",t.createdAt.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",className:t.status==="completed"?"bg-green-50 text-green-700":t.status==="in_progress"?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700",children:c(t.status,{fallbackValue:"created"})}),t.editHistory&&t.editHistory.length>0&&e.jsxs(S,{variant:"outline",className:"bg-orange-50 text-orange-700",children:[t.editHistory.length," edits"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Article:"}),e.jsx("p",{className:"font-medium",children:c(t.articleNumber)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Priority:"}),e.jsx("p",{className:"font-medium",children:c(t.priority,{fallbackValue:"normal"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Operations:"}),e.jsx("p",{className:"font-medium",children:t.operations?.length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Modified:"}),e.jsx("p",{className:"font-medium",children:t.createdAt.toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>f(t),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-medium",children:"âœï¸ Edit"}),e.jsx("button",{onClick:()=>a(t),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm font-medium",children:"ðŸ“š View History"}),t.operations&&t.operations.length>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[t.operations.length," operations configured"]})]})]},t.id))})]})},L=({entry:l,onSave:v,onCancel:p,userRole:E})=>{const[s,d]=h.useState({bundleNumber:l.bundleNumber,articleNumber:l.articleNumber||"",articleStyle:l.articleStyle||"",targetPieces:l.targetPieces||0,priority:l.priority||"normal",status:l.status||"created"}),[y,f]=h.useState(""),i=a=>{if(a.preventDefault(),!y.trim()){alert("Please provide a reason for editing this WIP entry.");return}const n={};if(s.bundleNumber!==l.bundleNumber&&(n.bundleNumber=s.bundleNumber),s.articleNumber!==l.articleNumber&&(n.articleNumber=s.articleNumber),s.articleStyle!==l.articleStyle&&(n.articleStyle=s.articleStyle),s.targetPieces!==l.targetPieces&&(n.targetPieces=s.targetPieces),s.priority!==l.priority&&(n.priority=s.priority),s.status!==l.status&&(n.status=s.status),Object.keys(n).length===0){alert("No changes detected.");return}v(l,n,y)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"âœï¸ Edit WIP Entry"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"â† Cancel"})]}),e.jsx(N,{className:"p-6",children:e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bundle Number"}),e.jsx("input",{type:"text",value:s.bundleNumber,onChange:a=>d({...s,bundleNumber:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Article Number"}),e.jsx("input",{type:"text",value:s.articleNumber,onChange:a=>d({...s,articleNumber:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Article Style"}),e.jsx("input",{type:"text",value:s.articleStyle,onChange:a=>d({...s,articleStyle:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Pieces"}),e.jsx("input",{type:"number",value:s.targetPieces,onChange:a=>d({...s,targetPieces:parseInt(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{value:s.priority,onChange:a=>d({...s,priority:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:a=>d({...s,status:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for Edit ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:y,onChange:a=>f(a.target.value),placeholder:"Please explain why you are editing this WIP entry...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,required:!0})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:"ðŸ’¾ Save Changes"}),e.jsx("button",{type:"button",onClick:p,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium",children:"Cancel"})]})]})})]})};export{z as WipEntryManager,z as default};
