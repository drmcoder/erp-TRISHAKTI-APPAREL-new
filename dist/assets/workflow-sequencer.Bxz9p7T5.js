import{j as e}from"./query-vendor.NFs8Lf8Y.js";import{r as j,c as p}from"./react-vendor.BcnQP8kQ.js";import{c as g,b as o,B as R,n as y,F as v,G as T}from"./index.B__xpDQO.js";import{F as S}from"./ClockIcon.DbOxfhcH.js";import{F as w}from"./PlayIcon.qCwfGLYk.js";import{F as N}from"./ArrowRightIcon.xKte5yv4.js";import"./ui-vendor.BnTQXQPs.js";import"./utils-vendor.B0NEtgzl.js";import"./firebase-vendor.m6WcKfT_.js";const H=({operations:s,onExecutePlan:r,onUpdateOperationStatus:i})=>{const[c,d]=j.useState(null),a=j.useMemo(()=>C(s),[s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Workflow Execution Plan"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:"outline",children:[a.groups.length," Groups"]}),e.jsxs(o,{variant:"secondary",children:[Math.round(a.parallelizationRatio*100),"% Parallel"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Operations"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 flex items-center justify-center",children:[e.jsx(S,{className:"h-5 w-5 mr-1"}),a.totalEstimatedTime]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Minutes (Optimized)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:a.groups.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Execution Groups"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:a.criticalPath.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Critical Path Ops"})]})]}),r&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(R,{onClick:()=>r(a),className:"flex items-center space-x-2",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"Execute Workflow"})]})})]}),e.jsx("div",{className:"space-y-4",children:a.groups.map((n,m)=>e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:n.type==="parallel"?"default":"secondary",children:["Group ",n.groupNumber]}),e.jsx(o,{variant:"outline",children:n.type==="parallel"?"Parallel":"Sequential"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[n.estimatedTime," minutes"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n.status==="completed"&&e.jsx(y,{className:"h-5 w-5 text-green-500"}),n.status==="in_progress"&&e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})]})]}),n.type==="parallel"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:n.operations.map(t=>e.jsx(b,{operation:t,isSelected:c===t.id,onClick:()=>d(t.id),onStatusChange:i,isCriticalPath:a.criticalPath.includes(t.id)},t.id))}):e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:n.operations.map((t,l)=>e.jsxs(p.Fragment,{children:[e.jsx(b,{operation:t,isSelected:c===t.id,onClick:()=>d(t.id),onStatusChange:i,isCriticalPath:a.criticalPath.includes(t.id),compact:!0}),l<n.operations.length-1&&e.jsx(N,{className:"h-4 w-4 text-gray-400"})]},t.id))})]},n.groupNumber))}),e.jsxs(g,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(v,{className:"h-5 w-5 text-orange-500 mr-2"}),"Critical Path Analysis"]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-orange-800",children:"The critical path determines the minimum time needed to complete all operations. Delays in critical path operations will delay the entire workflow."})}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.criticalPath.map((n,m)=>{const t=s.find(l=>l.id===n);return t?e.jsxs(p.Fragment,{children:[e.jsxs(o,{variant:"destructive",className:"cursor-pointer",children:[t.operationName," (",t.SAM,"m)"]}),m<a.criticalPath.length-1&&e.jsx(N,{className:"h-4 w-4 text-red-500"})]},n):null})})]})]})},b=({operation:s,isSelected:r,onClick:i,onStatusChange:c,isCriticalPath:d,compact:a=!1})=>{const n=t=>{switch(t){case"completed":return"bg-green-50 border-green-200 text-green-800";case"in_progress":return"bg-blue-50 border-blue-200 text-blue-800";case"ready":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"blocked":return"bg-red-50 border-red-200 text-red-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},m=t=>{switch(t){case"completed":return e.jsx(y,{className:"h-4 w-4 text-green-600"});case"in_progress":return e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"});case"ready":return e.jsx(w,{className:"h-4 w-4 text-yellow-600"});case"blocked":return e.jsx(v,{className:"h-4 w-4 text-red-600"});default:return e.jsx(T,{className:"h-4 w-4 text-gray-600"})}};return e.jsxs("div",{className:`
        border rounded-lg p-3 cursor-pointer transition-all
        ${n(s.status)}
        ${r?"ring-2 ring-blue-500":""}
        ${d?"border-l-4 border-l-red-500":""}
        ${a?"min-w-0":"min-w-[200px]"}
      `,onClick:i,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[m(s.status),e.jsx("span",{className:`font-medium ${a?"text-xs":"text-sm"}`,children:s.operationName})]}),d&&e.jsx(o,{variant:"destructive",className:"text-xs",children:"Critical"})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[s.operationCode," â€¢ ",s.machineType]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{children:[s.SAM," min"]}),e.jsx(o,{variant:"outline",className:"text-xs",children:s.skillRequired})]}),s.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Depends on: ",s.dependencies.join(", ")]})]}),c&&e.jsx("div",{className:"mt-2 flex space-x-1",children:["ready","in_progress","completed"].map(t=>e.jsx("button",{onClick:l=>{l.stopPropagation(),c(s.id,t)},className:`
                text-xs px-2 py-1 rounded
                ${s.status===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
              `,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]})};function C(s){const r=[],i=new Set;new Map(s.map(m=>[m.id,m]));let c=1,d=0;for(;i.size<s.length;){const m=s.filter(l=>!i.has(l.id)&&l.dependencies.every(u=>i.has(u)));if(m.length===0)break;M(m).forEach(l=>{const u=l.length>1&&l.every((x,f)=>l.slice(f+1).every(P=>F(x,P))),h=u?Math.max(...l.map(x=>x.SAM)):l.reduce((x,f)=>x+f.SAM,0);r.push({groupNumber:c++,operations:l,type:u?"parallel":"sequential",estimatedTime:h,status:"pending"}),d+=h,l.forEach(x=>i.add(x.id))})}const a=E(s),n=k(r);return{groups:r,totalEstimatedTime:d,criticalPath:a,parallelizationRatio:n}}function M(s){if(s.length<=1)return[s];const r=[],i=new Set;return s.forEach(c=>{if(i.has(c.id))return;const d=[c];i.add(c.id),s.forEach(a=>{i.has(a.id)||(c.canRunParallel.includes(a.id)||a.canRunParallel.includes(c.id)||c.machineType!==a.machineType&&!c.dependencies.includes(a.id)&&!a.dependencies.includes(c.id))&&(d.push(a),i.add(a.id))}),r.push(d)}),r}function F(s,r,i){return s.canRunParallel.includes(r.id)||r.canRunParallel.includes(s.id)?!0:!(s.dependencies.includes(r.id)||r.dependencies.includes(s.id)||s.machineType===r.machineType&&s.machineType!=="Manual")}function E(s){const r=new Map(s.map(t=>[t.id,t])),i=new Set,c=[];function d(t){if(i.has(t))return 0;const l=r.get(t);return l?(i.add(t),Math.max(0,...l.dependencies.map(h=>d(h)))+l.SAM):0}let a=0,n="";s.forEach(t=>{i.clear();const l=d(t.id);l>a&&(a=l,n=t.id)});function m(t){const l=r.get(t);if(!l)return;c.unshift(t);let u=0,h="";l.dependencies.forEach(x=>{i.clear();const f=d(x);f>u&&(u=f,h=x)}),h&&m(h)}return n&&m(n),c}function k(s){const r=s.filter(i=>i.type==="parallel").length;return s.length>0?r/s.length:0}export{H as WorkflowSequencer};
