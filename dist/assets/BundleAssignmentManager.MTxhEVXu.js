import{j as e}from"./query-vendor.DpsghfSz.js";import{r as l}from"./react-vendor.CfKEcsXX.js";import{C as c,c as b,d as f,e as V,b as d,a as o,B as L}from"./index.CLAiwwTT.js";import{L as x}from"./label.D0ghwUEZ.js";import{S as O,a as A,b as _,c as M,d as r}from"./select.D3_Pn-VW.js";import{T as G,a as I,b as B,c as R}from"./tabs.Bt9VKIUG.js";import{e as q}from"./enhanced-production-service.DSXA7MeX.js";import{t as v}from"./index.LBReXyrD.js";import{U as Y,P as E,E as J,d as K,q as D,n as Q,s as Z}from"./ui-vendor.EZF4ucWh.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";import"./utils.k9sMftog.js";const ee=[{id:"op1",name:"राम बहादुर (Ram Bahadur)",machineTypes:["overlock","flatlock"],skillLevel:"advanced",status:"available"},{id:"op2",name:"सीता देवी (Sita Devi)",machineTypes:["single_needle"],skillLevel:"expert",status:"available"},{id:"op3",name:"हरि श्रेष्ठ (Hari Shrestha)",machineTypes:["overlock"],skillLevel:"intermediate",status:"busy",currentWork:"LOT001-Blue-XL-1"},{id:"op4",name:"गीता तामाङ (Geeta Tamang)",machineTypes:["single_needle","buttonhole"],skillLevel:"advanced",status:"available"},{id:"op5",name:"कमल राई (Kamal Rai)",machineTypes:["flatlock","finishing"],skillLevel:"basic",status:"available"}],se={single_needle:"bg-blue-100 text-blue-800",overlock:"bg-green-100 text-green-800",flatlock:"bg-purple-100 text-purple-800",buttonhole:"bg-orange-100 text-orange-800",button_attach:"bg-pink-100 text-pink-800",cutting:"bg-gray-100 text-gray-800",finishing:"bg-indigo-100 text-indigo-800"},u={single_needle:"सिंगल निडल",overlock:"ओभरलक",flatlock:"फ्ल्यालक",buttonhole:"बटन होल",button_attach:"बटन एट्याच",cutting:"काटने",finishing:"फिनिशिङ"},y={available:"bg-green-100 text-green-800",busy:"bg-yellow-100 text-yellow-800",break:"bg-blue-100 text-blue-800",offline:"bg-red-100 text-red-800"},ae={waiting:"bg-gray-100 text-gray-800",ready:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",skipped:"bg-red-100 text-red-800"},je=()=>{const[F,z]=l.useState([]),[p,U]=l.useState(ee),[te,le]=l.useState([]),[i,S]=l.useState(null),[t,T]=l.useState(null),[h,W]=l.useState("all"),[g,X]=l.useState("all"),[$,k]=l.useState(!1);l.useEffect(()=>{w()},[]);const w=async()=>{try{k(!0),z([{id:"b1",bundleNumber:"LOT001-Blue-XL-1",lotNumber:"LOT001",articleNumber:"8082",color:"Blue",size:"XL",pieces:30,currentStep:1,status:"ready",assignedOperators:[],createdAt:new Date,processSteps:[{stepNumber:1,operation:"Collar Making",operationNepali:"कलर बनाउने",machineType:"single_needle",pricePerPiece:2.5,estimatedMinutes:4,canRunParallel:!0,dependencies:[],status:"ready",completedPieces:0},{stepNumber:2,operation:"Placket Making",operationNepali:"प्लेकेट बनाउने",machineType:"single_needle",pricePerPiece:2,estimatedMinutes:3,canRunParallel:!0,dependencies:[],status:"ready",completedPieces:0},{stepNumber:3,operation:"Shoulder Join",operationNepali:"काँध जोड्ने",machineType:"overlock",pricePerPiece:1.5,estimatedMinutes:2,canRunParallel:!1,dependencies:[1,2],status:"waiting",completedPieces:0}]},{id:"b2",bundleNumber:"LOT001-Green-2XL-2",lotNumber:"LOT001",articleNumber:"8082",color:"Green",size:"2XL",pieces:28,currentStep:1,status:"ready",assignedOperators:[],createdAt:new Date,processSteps:[{stepNumber:1,operation:"Collar Making",operationNepali:"कलर बनाउने",machineType:"single_needle",pricePerPiece:2.5,estimatedMinutes:4,canRunParallel:!0,dependencies:[],status:"ready",completedPieces:0}]}])}catch(s){console.error("Error loading data:",s),v.error("Failed to load bundles")}finally{k(!1)}},H=async(s,a,n)=>{try{const m=p.find(j=>j.id===n);if(!m)return;await q.assignBundleStepToOperator(s.id,a.stepNumber,n,m.name),v.success(`Assigned ${a.operation} to ${m.name}`),U(j=>j.map(N=>N.id===n?{...N,status:"busy",currentWork:s.bundleNumber}:N)),w(),S(null),T(null)}catch(m){console.error("Error assigning step:",m),v.error("Failed to assign work")}},P=s=>p.filter(a=>a.machineTypes.includes(s.machineType)&&a.status==="available"),C=F.filter(s=>!(h!=="all"&&s.status!==h||g!=="all"&&!s.processSteps.some(n=>n.machineType===g&&(n.status==="ready"||n.status==="waiting"))));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(c,{children:e.jsxs(b,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Bundle Assignment Manager"]}),e.jsx(V,{children:"Assign production bundles and operations to available operators"})]})}),e.jsxs(G,{defaultValue:"bundles",className:"space-y-4",children:[e.jsxs(I,{className:"grid w-full grid-cols-2",children:[e.jsx(B,{value:"bundles",children:"Bundle Assignment"}),e.jsx(B,{value:"operators",children:"Operator Status"})]}),e.jsxs(R,{value:"bundles",className:"space-y-4",children:[e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{children:"Status:"}),e.jsxs(O,{value:h,onValueChange:W,children:[e.jsx(A,{className:"w-40",children:e.jsx(_,{})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"ready",children:"Ready"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{children:"Machine:"}),e.jsxs(O,{value:g,onValueChange:X,children:[e.jsx(A,{className:"w-40",children:e.jsx(_,{})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Machines"}),e.jsx(r,{value:"single_needle",children:"Single Needle"}),e.jsx(r,{value:"overlock",children:"Overlock"}),e.jsx(r,{value:"flatlock",children:"Flatlock"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[C.length," bundles found"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Production Bundles"]}),$?e.jsx(c,{children:e.jsxs(d,{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading bundles..."})]})}):e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx(c,{className:`cursor-pointer transition-colors ${i?.id===s.id?"ring-2 ring-primary":""}`,onClick:()=>S(s),children:e.jsxs(d,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.bundleNumber}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.color," ",s.size," - ",s.pieces," pieces"]})]}),e.jsx(o,{className:y[s.status]||"bg-gray-100 text-gray-800",children:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Step ",s.currentStep]}),e.jsxs("span",{className:"text-xs",children:["Ready: ",s.processSteps.filter(a=>a.status==="ready").length]})]}),e.jsx(L,{size:"sm",variant:"ghost",children:e.jsx(J,{className:"h-4 w-4"})})]})]})},s.id))})]}),e.jsx("div",{className:"space-y-4",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-semibold flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Process Steps - ",i.bundleNumber]}),e.jsx("div",{className:"space-y-2",children:i.processSteps.map(s=>e.jsx(c,{className:`cursor-pointer ${t?.stepNumber===s.stepNumber?"ring-2 ring-primary":""} ${s.status==="ready"?"border-green-200":""}`,onClick:()=>T(s),children:e.jsxs(d,{className:"pt-3 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary text-primary-foreground text-xs font-bold flex items-center justify-center",children:s.stepNumber}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.operation}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.operationNepali})]})]}),e.jsx(o,{className:ae[s.status],children:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{className:se[s.machineType],children:u[s.machineType]}),e.jsxs("div",{className:"text-sm",children:["Rs. ",s.pricePerPiece," × ",i.pieces," = Rs. ",(s.pricePerPiece*i.pieces).toFixed(2)]})]}),s.dependencies.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx(D,{className:"h-3 w-3 inline mr-1"}),"Depends on steps: ",s.dependencies.join(", ")]}),s.assignedOperator&&e.jsxs("div",{className:"mt-2 text-xs text-green-600",children:[e.jsx(Q,{className:"h-3 w-3 inline mr-1"}),"Assigned to operator"]})]})},s.stepNumber))}),t&&t.status==="ready"&&!t.assignedOperator&&e.jsxs(c,{className:"border-blue-200 bg-blue-50",children:[e.jsx(b,{className:"pb-3",children:e.jsxs(f,{className:"text-sm",children:["Assign ",t.operation," to Operator"]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-3",children:[P(t).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(o,{className:y[s.status],children:s.status}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Skills: ",s.machineTypes.map(a=>u[a]).join(", ")]})]})]}),e.jsxs(L,{size:"sm",onClick:()=>H(i,t,s.id),children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Assign"]})]},s.id)),P(t).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(D,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{children:"No available operators for this machine type"}),e.jsxs("p",{className:"text-xs",children:["Required: ",u[t.machineType]]})]})]})})]})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Select a bundle to view its process steps"}),e.jsx("p",{className:"text-sm",children:"Click on any bundle from the left panel"})]})})]})]}),e.jsx(R,{value:"operators",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(s=>e.jsxs(c,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm",children:s.name}),e.jsx(o,{className:y[s.status],children:s.status})]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"Machine Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.machineTypes.map(a=>e.jsx(o,{variant:"outline",className:"text-xs",children:u[a]},a))})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"Skill Level"}),e.jsx("div",{className:"text-sm font-medium capitalize",children:s.skillLevel})]}),s.currentWork&&e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"Current Work"}),e.jsx("div",{className:"text-sm font-mono",children:s.currentWork})]})]})]},s.id))})})]})]})};export{je as BundleAssignmentManager,je as default};
