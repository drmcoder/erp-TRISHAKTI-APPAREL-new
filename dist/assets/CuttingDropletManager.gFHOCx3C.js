import{j as e}from"./query-vendor.DpsghfSz.js";import{r as N}from"./react-vendor.CfKEcsXX.js";import{h as A,s as v,r as h,l as x,x as Z,C as j,c as y,d as S,e as J,b as C,I as g,a as U,B as F}from"./index.CUWf0ERd.js";import{L as d}from"./label.a8PjD9uJ.js";import{S as I,a as K,b as _,c as G,d as O}from"./select.mP8pEsqY.js";import{c as R,e as z,s as L}from"./firebase-vendor.D8xw0AXf.js";import{t as u}from"./index.LBReXyrD.js";import{O as ee,Q as se,m as te,M as re,L as ae,P as le,v as oe,o as ce}from"./ui-vendor.D450QVBF.js";import"./utils-vendor.B0NEtgzl.js";class ie{async createCuttingDroplet(t){try{return{id:(await R(z(A,"cuttingDroplets"),{...t,createdAt:L()})).id,...t,createdAt:new Date}}catch(c){throw console.error("Error creating cutting droplet:",c),c}}async createBundlesFromCutting(t){return[]}}const $=new ie;class ne{static async testFirestore(){try{console.log("ðŸ§ª Testing Firestore connection...");const t=await R(z(A,"test"),{message:"TSA Production System Test",timestamp:L(),test:!0});return console.log("âœ… Firestore write successful:",t.id),!0}catch(t){return console.error("âŒ Firestore test failed:",t),!1}}static async testRealtimeDatabase(){try{console.log("ðŸ§ª Testing Realtime Database connection..."),await v(h(x,"test/connection"),{message:"TSA Production System Live Test",timestamp:Date.now(),status:"connected"});const t=await Z(h(x,"test/connection"));return t.exists()?(console.log("âœ… Realtime Database test successful:",t.val()),!0):(console.error("âŒ Realtime Database read failed: No data"),!1)}catch(t){return console.error("âŒ Realtime Database test failed:",t),!1}}static async testTSAProductionFlow(){try{console.log("ðŸ§ª Testing TSA Production Flow...");const t={lotNumber:"TEST001",articleNumber:"8082",garmentType:"polo",status:"cutting",colorSizeData:[{color:"Blue",rollsUsed:2,kgUsed:5.5,layers:20,sizes:[{size:"XL",pieces:30,bundlesCreated:0},{size:"2XL",pieces:30,bundlesCreated:0}],totalPieces:60}],createdAt:L()},c=await R(z(A,"cuttingDroplets"),t);return console.log("âœ… Cutting droplet created:",c.id),await v(h(x,`live_production/cutting_droplets/${c.id}`),{id:c.id,lotNumber:"TEST001",articleNumber:"8082",status:"cutting",totalPieces:60,lastUpdated:Date.now()}),console.log("âœ… Live production status updated"),await v(h(x,"live_production/operators/test_operator"),{operatorId:"test_operator",operatorName:"Test Operator",status:"available",machineType:null,currentBundle:null,lastActivity:Date.now()}),console.log("âœ… Operator status updated"),!0}catch(t){return console.error("âŒ TSA Production Flow test failed:",t),!1}}static async runAllTests(){console.log("ðŸš€ Starting TSA Production System Database Tests..."),console.log("");const t={firestore:await this.testFirestore(),realtime:await this.testRealtimeDatabase(),production:await this.testTSAProductionFlow()};return console.log(""),console.log("ðŸ“Š Test Results:"),console.log("================"),console.log(`Firestore:        ${t.firestore?"âœ… PASSED":"âŒ FAILED"}`),console.log(`Realtime DB:      ${t.realtime?"âœ… PASSED":"âŒ FAILED"}`),console.log(`Production Flow:  ${t.production?"âœ… PASSED":"âŒ FAILED"}`),console.log(""),Object.values(t).every(b=>b)?(console.log("ðŸŽ‰ All tests PASSED! TSA Production System is ready."),console.log(""),console.log("âœ… Database Architecture Active:"),console.log("   - Firestore: Structured data, complex queries"),console.log("   - Realtime DB: Live updates, real-time dashboards"),console.log(""),console.log("ðŸ”„ Your TSA Production Workflow:"),console.log("   1. Management â†’ Cutting Entry (Firestore + RT DB)"),console.log("   2. System â†’ Bundle Creation (Firestore + RT DB)"),console.log("   3. Supervisor â†’ Bundle Assignment (Firestore + RT DB)"),console.log("   4. Operators â†’ Piece Tracking (Firestore + RT DB)"),console.log("   5. Live Dashboard â†’ Real-time Updates (RT DB)")):(console.log("âŒ Some tests FAILED. Please check your Firebase configuration."),console.log(""),console.log("ðŸ”§ Troubleshooting:"),console.log("   1. Check Firebase project configuration"),console.log("   2. Verify authentication is working"),console.log("   3. Check database rules permissions"),console.log("   4. Ensure environment variables are set correctly")),[{name:"firestore",status:t.firestore?"success":"error",message:t.firestore?"Firestore connectivity passed":"Firestore connectivity failed"},{name:"realtime",status:t.realtime?"success":"error",message:t.realtime?"Realtime DB connectivity passed":"Realtime DB connectivity failed"},{name:"production",status:t.production?"success":"error",message:t.production?"Production flow test passed":"Production flow test failed"}]}static async cleanupTestData(){try{console.log("ðŸ§¹ Cleaning up test data..."),await v(h(x,"test"),null),await v(h(x,"live_production/operators/test_operator"),null),console.log("âœ… Test data cleanup completed")}catch(t){console.error("âŒ Cleanup failed:",t)}}}const de=["Blue","Green","Black","White","Red","Navy","Gray","Yellow","Pink","Purple"],M=["S","M","L","XL","2XL","3XL"],ue=[{value:"tshirt",label:"T-Shirt (3233#)",example:"3233#"},{value:"polo",label:"Polo T-Shirt (8082#)",example:"8082#"},{value:"shirt",label:"Shirt",example:"5512#"},{value:"pants",label:"Pants",example:"7890#"}],ve=()=>{const[r,t]=N.useState({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"polo",totalRolls:0,totalKg:0,colorSizeData:[],createdBy:"management",status:"cutting"}),[c,b]=N.useState(["Blue","Green","Black"]),[B,T]=N.useState(!1),[k,E]=N.useState(!1);N.useEffect(()=>{V()},[c]);const V=()=>{const s=c.map(a=>{const l=r.colorSizeData?.find(i=>i.color===a);return{color:a,rollsUsed:l?.rollsUsed||0,kgUsed:l?.kgUsed||0,layers:l?.layers||20,sizes:M.map(i=>{const m=l?.sizes.find(f=>f.size===i);return{size:i,pieces:m?.pieces||0,bundlesCreated:0}}),totalPieces:l?.totalPieces||0}});t(a=>({...a,colorSizeData:s}))},w=(s,a,l)=>{if(!r.colorSizeData)return;const i=r.colorSizeData.map(o=>{if(o.color===s){const n={...o,[a]:l};return(a==="layers"||a==="sizes")&&(n.totalPieces=n.sizes.reduce((p,P)=>p+P.pieces,0)),n}return o}),m=i.reduce((o,n)=>o+n.rollsUsed,0),f=i.reduce((o,n)=>o+n.kgUsed,0);t(o=>({...o,colorSizeData:i,totalRolls:m,totalKg:f}))},X=(s,a,l)=>{if(!r.colorSizeData)return;const i=r.colorSizeData.map(o=>{if(o.color===s){const n=o.sizes.map(p=>p.size===a?{...p,pieces:l}:p);return{...o,sizes:n,totalPieces:n.reduce((p,P)=>p+P.pieces,0)}}return o}),m=i.reduce((o,n)=>o+n.rollsUsed,0),f=i.reduce((o,n)=>o+n.kgUsed,0);t(o=>({...o,colorSizeData:i,totalRolls:m,totalKg:f}))},q=s=>{c.includes(s)||b([...c,s])},W=s=>{c.length>1&&b(c.filter(a=>a!==s))},Y=async()=>{if(!r.lotNumber||!r.articleNumber||!r.garmentType){u.error("Please fill all required fields");return}const s=r.colorSizeData?.reduce((a,l)=>a+l.totalPieces,0)||0;if(s===0){u.error("Please enter piece quantities");return}try{E(!0);const a={lotNumber:r.lotNumber,articleNumber:r.articleNumber,articleName:r.articleName||r.articleNumber,garmentType:r.garmentType,totalRolls:r.totalRolls,totalKg:r.totalKg,colorSizeData:r.colorSizeData,createdBy:r.createdBy,status:"cutting"},l=await $.createCuttingDroplet(a);u.success(`Cutting droplet ${l.lotNumber} created successfully! Total: ${s} pieces`),t({lotNumber:`LOT${Date.now()}`,articleNumber:"",articleName:"",garmentType:"polo",totalRolls:0,totalKg:0,colorSizeData:[],createdBy:"management",status:"cutting"}),b(["Blue","Green","Black"])}catch(a){console.error("Error saving cutting droplet:",a),u.error("Failed to create cutting droplet")}finally{E(!1)}},Q=async()=>{if(!r.lotNumber){u.error("Please save the cutting droplet first");return}try{T(!0);const s=await $.createBundlesFromCutting("temp_id");u.success(`Created ${s.length} production bundles ready for sewing line`)}catch{u.error("Failed to create bundles")}finally{T(!1)}},H=async()=>{try{T(!0),u.info("Testing Firebase connection..."),await ne.runAllTests(),u.success("Firebase test completed! Check console for results.")}catch{u.error("Firebase test failed! Check console for details.")}finally{T(!1)}},D=r.colorSizeData?.reduce((s,a)=>s+a.totalPieces,0)||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{children:e.jsxs(y,{children:[e.jsxs(S,{className:"flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Cutting Droplet Entry"]}),e.jsx(J,{children:"Enter WIP Excel data from cutting department - rolls, colors, sizes, and piece quantities"})]})}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx(se,{className:"h-5 w-5 mr-2"}),"Lot Information"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lotNumber",children:"Lot Number*"}),e.jsx(g,{id:"lotNumber",value:r.lotNumber||"",onChange:s=>t(a=>({...a,lotNumber:s.target.value})),placeholder:"LOT001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"articleNumber",children:"Article Number*"}),e.jsx(g,{id:"articleNumber",value:r.articleNumber||"",onChange:s=>t(a=>({...a,articleNumber:s.target.value})),placeholder:"8082"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Garment Type*"}),e.jsxs(I,{value:r.garmentType,onValueChange:s=>t(a=>({...a,garmentType:s})),children:[e.jsx(K,{children:e.jsx(_,{})}),e.jsx(G,{children:ue.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"articleName",children:"Article Name"}),e.jsx(g,{id:"articleName",value:r.articleName||"",onChange:s=>t(a=>({...a,articleName:s.target.value})),placeholder:"Polo T-Shirt"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Total Rolls"}),e.jsx(g,{value:r.totalRolls||0,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Total KG"}),e.jsx(g,{value:r.totalKg||0,disabled:!0,className:"bg-muted"})]})]})]})]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Color Configuration"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Available Colors"}),e.jsxs(I,{onValueChange:q,children:[e.jsx(K,{className:"w-48",children:e.jsx(_,{placeholder:"Add color"})}),e.jsx(G,{children:de.filter(s=>!c.includes(s)).map(s=>e.jsx(O,{value:s,children:s},s))})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsxs(U,{variant:"outline",className:"flex items-center",children:[s,c.length>1&&e.jsx("button",{onClick:()=>W(s),className:"ml-2 text-xs hover:text-red-500",children:e.jsx(re,{className:"h-3 w-3"})})]},s))})]})]}),e.jsx("div",{className:"space-y-4",children:r.colorSizeData?.map((s,a)=>e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx("div",{className:`w-4 h-4 rounded-full mr-2 ${s.color.toLowerCase()==="blue"?"bg-blue-500":s.color.toLowerCase()==="green"?"bg-green-500":s.color.toLowerCase()==="black"?"bg-black":s.color.toLowerCase()==="red"?"bg-red-500":"bg-gray-500"}`}),s.color," Color Data"]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Rolls Used"}),e.jsx(g,{type:"number",min:"0",value:s.rollsUsed,onChange:l=>w(s.color,"rollsUsed",parseFloat(l.target.value)||0),placeholder:"Number of fabric rolls"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"KG Used"}),e.jsx(g,{type:"number",min:"0",step:"0.1",value:s.kgUsed,onChange:l=>w(s.color,"kgUsed",parseFloat(l.target.value)||0),placeholder:"Fabric weight in KG"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Layers"}),e.jsx(g,{type:"number",min:"1",value:s.layers,onChange:l=>w(s.color,"layers",parseInt(l.target.value)||20),placeholder:"Number of layers cut"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(d,{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Size Quantities (Pieces per size)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:M.map(l=>{const i=s.sizes.find(m=>m.size===l);return e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-sm",children:l}),e.jsx(g,{type:"number",min:"0",value:i?.pieces||0,onChange:m=>X(s.color,l,parseInt(m.target.value)||0),placeholder:"0",className:"text-center"})]},l)})}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsxs("span",{className:"font-medium",children:["Total ",s.color," Pieces:"]}),e.jsxs(U,{variant:"secondary",className:"text-lg font-bold",children:[s.totalPieces," pcs"]})]})]})]})]},s.color))}),e.jsxs(j,{className:"border-green-200 bg-green-50",children:[e.jsx(y,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Cutting Summary"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalRolls}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Rolls"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalKg?.toFixed(1)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total KG"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Colors"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Pieces"})]})]})})]}),e.jsx(j,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(F,{variant:"outline",onClick:H,disabled:B,children:"ðŸ§ª Test Firebase"}),e.jsxs(F,{variant:"outline",onClick:Q,disabled:B||D===0,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Create Bundles for Sewing Line"]}),e.jsx(F,{onClick:Y,disabled:k||D===0,className:"bg-green-600 hover:bg-green-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Save Cutting Droplet"]})})]})})})]})};export{ve as CuttingDropletManager,ve as default};
