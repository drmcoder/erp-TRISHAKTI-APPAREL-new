import{j as e}from"./query-vendor.BbCCZTU0.js";import{r as l}from"./react-vendor.BcnQP8kQ.js";import{a as r,C as j,F as B,B as b,c as K}from"./index.BnZjV7b3.js";import{I as M}from"./Input.D8gd7mOf.js";import{L as P}from"./LoadingSpinner.-iQp5F13.js";import{E as Q,F as U}from"./empty-state.CKTdz-Ar.js";import{i as V,j as X,e as Z,k as _}from"./use-work-assignments.HpLChT7p.js";import{F as I}from"./MagnifyingGlassIcon.BaFANGzr.js";import{F as ee}from"./ChartBarIcon.BgzBpEol.js";import{F as T}from"./SparklesIcon.biZhyhbn.js";import{F as se}from"./ClockIcon.DbOxfhcH.js";import{F as ae}from"./CurrencyRupeeIcon.CCku5vMm.js";import"./ui-vendor.B7YYMSVe.js";import"./utils-vendor.B0NEtgzl.js";const fe=({operatorId:u,operatorName:W,operatorSkills:v,maxConcurrentWork:N,onRequestSubmitted:z})=>{const[c,O]=l.useState(""),[h,E]=l.useState("all"),[o,p]=l.useState(null),[R,w]=l.useState(""),{data:C,isLoading:D}=V(u),{data:L,isLoading:Y}=X(u),{data:S}=Z(u),g=_(),q=C?.success?C.data||[]:[],F=L?.success?L.data||[]:[],y=S?.success?S.data?.items||[]:[],d=l.useMemo(()=>q.map(s=>{const a=F.find(i=>i.id===s.id),t=A(s,v);return{...s,recommendationScore:a?.recommendationScore,recommendationReasons:a?.recommendationReasons,estimatedCompletion:a?.estimatedCompletion,compatibilityLevel:t.level,isRecommended:!!a&&a.recommendationScore>75}}),[q,F,v]),n=l.useMemo(()=>{let s=d;if(c){const a=c.toLowerCase();s=s.filter(t=>t.operation.toLowerCase().includes(a)||t.machineType.toLowerCase().includes(a)||t.bundleId.toLowerCase().includes(a))}switch(h){case"recommended":s=s.filter(a=>a.isRecommended);break;case"compatible":s=s.filter(a=>a.compatibilityLevel==="perfect"||a.compatibilityLevel==="good");break}return s.sort((a,t)=>{if(a.isRecommended&&!t.isRecommended)return-1;if(!a.isRecommended&&t.isRecommended)return 1;const i=a.recommendationScore||0,m=t.recommendationScore||0;if(i!==m)return m-i;const x={perfect:4,good:3,acceptable:2,challenging:1};return x[t.compatibilityLevel]-x[a.compatibilityLevel]})},[d,c,h]),k=async s=>{try{await g.mutateAsync({workItemId:s.id,operatorId:u,reason:R||`Self-assignment request for ${s.operation}`}),p(null),w(""),z?.(s.id)}catch(a){console.error("Failed to create assignment request:",a)}};function A(s,a){const t=[];let i=0;a.primaryMachine===s.machineType?(i+=30,t.push("Primary machine match")):a.machineTypes.includes(s.machineType)?(i+=20,t.push("Machine compatible")):(i-=20,t.push("Machine type mismatch"));const m=["beginner","intermediate","advanced","expert"],x=m.indexOf(a.skillLevel),$=m.indexOf(s.skillLevelRequired);if(x>=$?(i+=25,x===$?t.push("Perfect skill level match"):t.push("Overqualified (good for quality)")):(i-=15,t.push("Requires higher skill level")),a.specializations?.length){const J=G(s.operation);a.specializations.includes(J)&&(i+=15,t.push("Specialization match"))}return i>=60?{level:"perfect",reasons:t}:i>=40?{level:"good",reasons:t}:i>=20?{level:"acceptable",reasons:t}:{level:"challenging",reasons:t}}function G(s){const a=s.toLowerCase();return a.includes("cut")?"cutting":a.includes("sew")||a.includes("stitch")?"sewing":a.includes("embroi")?"embroidery":a.includes("finish")||a.includes("press")?"finishing":"general"}const H=s=>{switch(s){case"perfect":return"border-green-500 bg-green-50";case"good":return"border-blue-500 bg-blue-50";case"acceptable":return"border-yellow-500 bg-yellow-50";case"challenging":return"border-red-500 bg-red-50";default:return"border-gray-200"}},f=y.length<N;return D||Y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Available Work"}),e.jsxs("p",{className:"text-gray-600",children:["Browse and request work assignments â€¢ ",W]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(r,{variant:f?"success":"warning",children:[y.length,"/",N," assignments"]})})]}),!f&&e.jsx(j,{className:"p-4 border-orange-200 bg-orange-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-800 font-medium",children:"At Maximum Capacity"}),e.jsxs("p",{className:"text-orange-700 text-sm",children:["You're currently assigned to ",y.length," work items. Complete some assignments to take on new work."]})]})]})}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(M,{placeholder:"Search by operation, machine type, or bundle...",value:c,onChange:s=>O(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("select",{value:h,onChange:s=>E(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsxs("option",{value:"all",children:["All Work (",d.length,")"]}),e.jsxs("option",{value:"recommended",children:["ðŸŒŸ Recommended (",d.filter(s=>s.isRecommended).length,")"]}),e.jsxs("option",{value:"compatible",children:["âœ… Compatible (",d.filter(s=>s.compatibilityLevel==="perfect"||s.compatibilityLevel==="good").length,")"]})]})})]})}),e.jsx("div",{children:n.length===0?e.jsx(Q,{icon:ee,title:"No work items found",description:c||h!=="all"?"Try adjusting your search or filters":"No work items are currently available for self-assignment"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(s=>e.jsxs(j,{className:`p-4 transition-all duration-200 hover:shadow-md ${H(s.compatibilityLevel)} ${s.isRecommended?"ring-2 ring-blue-400":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.operation}),s.isRecommended&&e.jsx(T,{className:"h-4 w-4 text-blue-500"})]}),e.jsx(r,{variant:s.isRecommended?"primary":"secondary",className:"text-xs",children:s.compatibilityLevel})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(U,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.machineType})]}),e.jsx(r,{variant:"outline",className:"text-xs",children:s.skillLevelRequired})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[s.estimatedDuration,"min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:["â‚¹",(s.ratePerPiece*s.targetPieces).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Bundle: ",s.bundleId]}),e.jsxs("span",{className:"text-gray-600",children:[s.targetPieces," pieces"]})]})]}),s.isRecommended&&s.recommendationReasons&&e.jsxs("div",{className:"mb-4 p-2 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-1",children:[e.jsx(T,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"AI Recommendation"}),e.jsxs(r,{variant:"primary",className:"text-xs",children:[s.recommendationScore,"% match"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.recommendationReasons.slice(0,2).map((a,t)=>e.jsx(r,{variant:"outline",className:"text-xs",children:a},t))})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:A(s,v).reasons.slice(0,3).map((a,t)=>e.jsx(r,{variant:"outline",className:`text-xs ${a.includes("mismatch")||a.includes("higher skill")?"text-red-600 border-red-300":"text-green-600 border-green-300"}`,children:a},t))})}),s.estimatedCompletion&&e.jsx("div",{className:"mb-4 text-xs text-gray-600",children:e.jsxs("span",{children:["Est. completion: ",s.estimatedCompletion.toLocaleDateString()]})}),e.jsx(b,{onClick:()=>p(s.id),disabled:!f||g.isPending,className:"w-full",variant:s.isRecommended?"default":"outline",children:f?"Request Assignment":"At Capacity"}),s.isBlocked&&e.jsxs("div",{className:"mt-2 flex items-center space-x-1 text-red-600",children:[e.jsx(B,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:["Blocked: ",s.blockingReason]})]})]},s.id))})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(j,{className:"max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Request Assignment"}),e.jsx(b,{variant:"ghost",onClick:()=>p(null),className:"p-1",children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Request assignment for this work item? Your request will be reviewed by a supervisor."}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded border",children:[e.jsx("p",{className:"font-medium text-gray-900",children:n.find(s=>s.id===o)?.operation}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.find(s=>s.id===o)?.machineType," â€¢",n.find(s=>s.id===o)?.targetPieces," pieces"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (optional)"}),e.jsx(M,{placeholder:"Why do you want this assignment?",value:R,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(b,{variant:"ghost",onClick:()=>p(null),className:"flex-1",children:"Cancel"}),e.jsx(b,{onClick:()=>{const s=n.find(a=>a.id===o);k(s)},disabled:g.isPending,className:"flex-1",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Submitting..."})]}):"Submit Request"})]})]})})]})};export{fe as SelfAssignmentInterface};
