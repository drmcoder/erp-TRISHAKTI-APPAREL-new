import{j as e}from"./query-vendor.DpsghfSz.js";import{r as n}from"./react-vendor.CfKEcsXX.js";import{w as O,B as g,C as x,b as m,c as S,d as T,a as j,k as E,I as ee}from"./index.CUWf0ERd.js";import{R as se,D as te,i as ae,x as z,y as I,z as P,F as H,b as C,G as M,H as ie,J as re,C as le,E as ce}from"./ui-vendor.D450QVBF.js";import"./firebase-vendor.D8xw0AXf.js";import"./utils-vendor.B0NEtgzl.js";const pe=()=>{const[u,w]=n.useState([]),[ne,oe]=n.useState(""),[o,D]=n.useState("30d"),[f,k]=n.useState(""),[b,B]=n.useState(null),[y,N]=n.useState([]),[v,U]=n.useState(!0),[A,F]=n.useState(new Date);n.useEffect(()=>(R(),W()),[]);const R=async()=>{try{const s=await O.getTrustedDevices();w(s),F(new Date)}catch(s){console.error("Failed to load login data from Firebase:",s),w([])}},W=()=>{const s=setInterval(async()=>{v&&(await q(),G(),F(new Date))},3e4);return()=>clearInterval(s)},q=async()=>{try{const s=await O.getTrustedDevices(),t=s.filter(a=>a.lastLoginDate.getTime()>A.getTime());if(t.length>0){const a=t.map(i=>({id:`login_${Date.now()}_${i.deviceId}`,type:"new_login",severity:"info",message:`ðŸ” New login detected: ${i.operatorName}`,timestamp:new Date,operatorId:i.operatorId,deviceId:i.deviceId,trusted:i.isTrusted}));N(i=>[...a,...i].slice(0,50)),w(s)}}catch(s){console.error("Failed to check for new logins:",s)}},G=()=>{const s=u.flatMap(i=>i.loginHistory.filter(r=>new Date(r.timestamp).getTime()>Date.now()-6e5).map(r=>({...r,deviceId:i.deviceId,operatorName:i.operatorName}))),t=s.filter(i=>!i.success);if(t.length>5){const i={id:`suspicious_${Date.now()}`,type:"suspicious_activity",severity:"warning",message:`${t.length} failed login attempts in last 10 minutes`,timestamp:new Date,details:t};N(r=>[i,...r].slice(0,50))}const a=new Map;s.forEach(i=>{a.has(i.operatorId)||a.set(i.operatorId,new Set),a.get(i.operatorId).add(i.deviceId)}),a.forEach((i,r)=>{if(i.size>2){const c={id:`multi_device_${Date.now()}_${r}`,type:"multi_device_login",severity:"warning",message:`Operator logged in from ${i.size} different devices recently`,timestamp:new Date,operatorId:r,deviceCount:i.size};N(l=>[c,...l].slice(0,50))}})},h=n.useMemo(()=>{const s=new Map,t=new Date;return t.setDate(t.getDate()-(o==="7d"?7:o==="30d"?30:90)),u.forEach(a=>{const i=a.operatorId;s.has(i)||s.set(i,{operatorId:i,operatorName:a.operatorName,totalLogins:0,successfulLogins:0,failedLogins:0,loginDates:[],averageLoginsPerDay:0,loginStreak:0,lastLoginDate:new Date(a.lastLoginDate),deviceCount:0,trustedDevices:0,loginTimes:Array.from({length:24},(l,d)=>({hour:d,count:0})),loginDays:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(l=>({day:l,count:0})),suspiciousActivity:!1});const r=s.get(i);r.deviceCount++,a.isTrusted&&r.trustedDevices++,a.loginHistory.filter(l=>new Date(l.timestamp)>=t).forEach(l=>{if(r.totalLogins++,l.success){r.successfulLogins++,r.loginDates.push(new Date(l.timestamp));const d=new Date(l.timestamp).getHours();r.loginTimes[d].count++;const V=new Date(l.timestamp).getDay(),Y=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][V],$=r.loginDays.find(Z=>Z.day===Y);$&&$.count++}else r.failedLogins++});const c=Math.max(1,(Date.now()-t.getTime())/(1e3*60*60*24));r.averageLoginsPerDay=r.successfulLogins/c,r.loginStreak=J(r.loginDates),r.suspiciousActivity=K(r)}),Array.from(s.values()).filter(a=>!f||a.operatorName.toLowerCase().includes(f.toLowerCase())||a.operatorId.toLowerCase().includes(f.toLowerCase())).sort((a,i)=>i.totalLogins-a.totalLogins)},[u,o,f]),L=n.useMemo(()=>{const s=new Map,t=new Date;return t.setDate(t.getDate()-(o==="7d"?7:o==="30d"?30:90)),u.forEach(a=>{a.loginHistory.filter(i=>new Date(i.timestamp)>=t).forEach(i=>{const r=new Date(i.timestamp).toISOString().split("T")[0];s.has(r)||s.set(r,{date:r,successful:0,failed:0,operators:[]});const c=s.get(r);i.success?c.successful++:c.failed++,c.operators.includes(a.operatorId)||c.operators.push(a.operatorId)})}),Array.from(s.values()).sort((a,i)=>a.date.localeCompare(i.date))},[u,o]),J=s=>{if(s.length===0)return 0;const t=[...new Set(s.map(r=>r.toISOString().split("T")[0]))];t.sort();let a=1,i=1;for(let r=1;r<t.length;r++){const c=new Date(t[r-1]);(new Date(t[r]).getTime()-c.getTime())/(1e3*60*60*24)===1?(a++,i=Math.max(i,a)):a=1}return i},K=(s,t)=>s.failedLogins>10||s.deviceCount>5||s.averageLoginsPerDay>10,Q=s=>s>5?"bg-red-100 text-red-800":s>2?"bg-yellow-100 text-yellow-800":s>1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",_=s=>new Date(s).toLocaleDateString(),p=n.useMemo(()=>{const s=h.length,t=h.reduce((l,d)=>l+d.totalLogins,0),a=h.reduce((l,d)=>l+d.successfulLogins,0),i=h.reduce((l,d)=>l+d.failedLogins,0),r=h.filter(l=>l.suspiciousActivity).length,c=s>0?t/s:0;return{totalOperators:s,totalLogins:t,totalSuccessful:a,totalFailed:i,suspiciousOperators:r,averageLoginsPerOperator:c,successRate:t>0?a/t*100:0}},[h]);return e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ðŸ›¡ï¸ TSA Intelligence Hub"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Advanced Security Analytics & Real-Time Login Intelligence Platform"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",leftIcon:e.jsx(se,{className:"w-4 h-4"}),onClick:()=>R(),children:"Refresh"}),e.jsx(g,{variant:"outline",leftIcon:e.jsx(te,{className:"w-4 h-4"}),children:"Export Data"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:p.totalOperators}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Operators"})]})]})})}),e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:p.totalLogins}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Logins"})]})]})})}),e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-green-700",children:p.totalSuccessful}),e.jsx("p",{className:"text-xs text-gray-500",children:"Successful"})]})]})})}),e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-red-700",children:p.totalFailed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Failed"})]})]})})}),e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-6 h-6 text-purple-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[p.successRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Success Rate"})]})]})})}),e.jsx(x,{children:e.jsx(m,{className:"flex items-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-6 h-6 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-orange-700",children:p.suspiciousOperators}),e.jsx("p",{className:"text-xs text-gray-500",children:"Suspicious"})]})]})})})]}),e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Real-Time Security Alerts",y.length>0&&e.jsx(j,{className:"bg-red-100 text-red-800",children:y.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>U(!v),className:v?"text-green-600":"text-gray-600",children:v?"â— Live":"â—‹ Paused"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>N([]),children:"Clear All"})]})]})}),e.jsxs(m,{children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No security alerts"}),e.jsx("p",{className:"text-sm",children:"System monitoring active"})]}):y.map(s=>e.jsxs("div",{className:E("p-3 rounded-lg border-l-4 flex items-start justify-between",s.severity==="warning"?"bg-yellow-50 border-yellow-400":s.severity==="error"?"bg-red-50 border-red-400":"bg-blue-50 border-blue-400"),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.type==="new_login"&&e.jsx(I,{className:"w-4 h-4 text-blue-600"}),s.type==="suspicious_activity"&&e.jsx(C,{className:"w-4 h-4 text-yellow-600"}),s.type==="multi_device_login"&&e.jsx(ie,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.message})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.timestamp.toLocaleTimeString()}),s.operatorId&&e.jsxs(j,{className:"mt-1 text-xs",children:["ID: ",s.operatorId]})]}),e.jsx("button",{onClick:()=>N(t=>t.filter(a=>a.id!==s.id)),className:"text-gray-400 hover:text-gray-600 ml-2",children:e.jsx(X,{className:"w-4 h-4"})})]},s.id))}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:["Last refresh: ",A.toLocaleTimeString()]}),e.jsxs("span",{children:["Monitoring: ",v?"Active":"Paused"]})]})]})]}),e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Daily Login Trends (",o,")"]})}),e.jsxs(m,{children:[e.jsx("div",{className:"h-64 flex items-end justify-between gap-1 bg-gray-50 p-4 rounded",children:L.slice(-14).map((s,t)=>e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-1 mb-2",children:[e.jsx("div",{className:"w-full bg-green-500 rounded-t",style:{height:`${Math.max(4,s.successful/Math.max(...L.map(a=>a.successful+a.failed))*150)}px`}}),s.failed>0&&e.jsx("div",{className:"w-full bg-red-500 rounded-b",style:{height:`${Math.max(2,s.failed/Math.max(...L.map(a=>a.successful+a.failed))*150)}px`}})]}),e.jsxs("div",{className:"text-xs text-gray-600 text-center",children:[e.jsx("div",{className:"font-medium",children:s.successful+s.failed}),e.jsxs("div",{children:[_(s.date).split("/")[1],"/",_(s.date).split("/")[0]]})]})]},s.date))}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"Successful Logins"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Failed Logins"})]})]})]})]}),e.jsx(x,{children:e.jsx(m,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ee,{leftIcon:e.jsx(re,{className:"w-4 h-4"}),placeholder:"Search operators...",value:f,onChange:s=>k(s.target.value),clearable:!0,onClear:()=>k("")})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:o==="7d"?"primary":"outline",size:"sm",onClick:()=>D("7d"),children:"7 Days"}),e.jsx(g,{variant:o==="30d"?"primary":"outline",size:"sm",onClick:()=>D("30d"),children:"30 Days"}),e.jsx(g,{variant:o==="90d"?"primary":"outline",size:"sm",onClick:()=>D("90d"),children:"90 Days"})]})]})})}),e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Operator Login Frequency (",h.length," operators)"]})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:E("flex items-center gap-4 p-4 border rounded-lg cursor-pointer transition-all duration-200",b===s.operatorId?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>B(b===s.operatorId?null:s.operatorId),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.operatorName}),e.jsxs(j,{className:Q(s.averageLoginsPerDay),children:[s.averageLoginsPerDay.toFixed(1),"/day"]}),s.suspiciousActivity&&e.jsxs(j,{className:"bg-red-100 text-red-800 flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),"Suspicious"]}),s.trustedDevices>0&&e.jsxs(j,{className:"bg-green-100 text-green-800 flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),s.trustedDevices," trusted"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsx("span",{className:"ml-1 font-medium",children:s.totalLogins})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Success:"}),e.jsx("span",{className:"ml-1 font-medium text-green-600",children:s.successfulLogins})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Failed:"}),e.jsx("span",{className:"ml-1 font-medium text-red-600",children:s.failedLogins})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Devices:"}),e.jsx("span",{className:"ml-1 font-medium",children:s.deviceCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Streak:"}),e.jsxs("span",{className:"ml-1 font-medium",children:[s.loginStreak," days"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-gray-500 text-xs",children:[Math.floor((Date.now()-s.lastLoginDate.getTime())/(1e3*60*60*24))," days ago"]})]})]})]}),e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(ce,{className:"w-4 h-4"})})]}),b===s.operatorId&&e.jsxs("div",{className:"ml-4 mt-3 p-4 bg-gray-50 rounded-lg space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Login Time Distribution (24h)"}),e.jsx("div",{className:"flex items-end gap-1 h-16 bg-white p-2 rounded",children:s.loginTimes.map(t=>e.jsx("div",{className:"flex-1 bg-blue-500 rounded-t",style:{height:t.count>0?`${Math.max(4,t.count/Math.max(...s.loginTimes.map(a=>a.count))*50)}px`:"2px"},title:`${t.hour}:00 - ${t.count} logins`},t.hour))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"00"}),e.jsx("span",{children:"06"}),e.jsx("span",{children:"12"}),e.jsx("span",{children:"18"}),e.jsx("span",{children:"24"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Weekly Login Pattern"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:s.loginDays.map(t=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-full bg-green-500 rounded mb-1",style:{height:`${Math.max(8,t.count/Math.max(...s.loginDays.map(a=>a.count))*40)}px`}}),e.jsx("div",{className:"text-xs text-gray-600",children:t.day}),e.jsx("div",{className:"text-xs font-medium",children:t.count})]},t.day))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Recent Login Activity"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:u.filter(t=>t.operatorId===s.operatorId).flatMap(t=>t.loginHistory.slice(-10)).sort((t,a)=>new Date(a.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(0,10).map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-white rounded",children:[t.success?e.jsx(I,{className:"w-3 h-3 text-green-600"}):e.jsx(P,{className:"w-3 h-3 text-red-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleString()}),e.jsx(j,{className:t.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:t.success?"Success":"Failed"})]},a))})]})]})]},s.operatorId))})})]})]})};export{pe as default};
