const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.B__xpDQO.js","assets/query-vendor.NFs8Lf8Y.js","assets/react-vendor.BcnQP8kQ.js","assets/ui-vendor.BnTQXQPs.js","assets/utils-vendor.B0NEtgzl.js","assets/firebase-vendor.m6WcKfT_.js","assets/index.B7mSI82B.css"])))=>i.map(i=>d[i]);
import{j as e,d as W}from"./query-vendor.NFs8Lf8Y.js";import{r as T}from"./react-vendor.BcnQP8kQ.js";import{I as w,B as E,b as I,c as A,_,L as C}from"./index.B__xpDQO.js";import{F as K}from"./ArrowLeftIcon.BArH4jor.js";import{F as Y}from"./CpuChipIcon.DcT1uL6Q.js";import{F as X}from"./ClockIcon.DbOxfhcH.js";import{F as Z}from"./CurrencyRupeeIcon.CCku5vMm.js";import{F as Q}from"./StarIcon.B5IJFdRf.js";import{p as ee}from"./utils-vendor.B0NEtgzl.js";import{q as se,i as q,a as te,S as re,e as ae,D as ne,b as ie}from"./ui-vendor.BnTQXQPs.js";import"./firebase-vendor.m6WcKfT_.js";const le=({template:a,onSave:p,onCancel:r})=>{const[t,s]=T.useState({templateName:a?.templateName||"",templateCode:a?.templateCode||"",category:a?.category||"",operations:a?.operations||[],notes:a?.notes||"",setupInstructions:a?.setupInstructions||""}),[n,m]=T.useState([]),[o,h]=T.useState({name:"",nameNepali:"",description:"",machineType:"",smvMinutes:0,pricePerPiece:0,processingType:"sequential",sequenceOrder:t.operations.length+1,prerequisites:[],qualityCheckRequired:!1,defectTolerance:5,isOptional:!1,notes:""}),f=t.operations.reduce((i,l)=>i+l.smvMinutes,0),u=t.operations.reduce((i,l)=>i+l.pricePerPiece,0),j=()=>f>30||t.operations.length>10?"expert":f>20||t.operations.length>7?"complex":f>10||t.operations.length>5?"medium":"simple",y=()=>{const i=[];return o.name?.trim()||i.push("Operation name is required"),o.machineType?.trim()||i.push("Machine type is required"),(!o.smvMinutes||o.smvMinutes<=0)&&i.push("SMV must be greater than 0"),(!o.pricePerPiece||o.pricePerPiece<=0)&&i.push("Price must be greater than 0"),i},v=()=>{const i=y();if(m(i),i.length===0){const l={id:`op_${Date.now()}`,name:o.name.trim(),nameNepali:o.nameNepali?.trim()||"",description:o.description?.trim(),machineType:o.machineType,smvMinutes:o.smvMinutes,pricePerPiece:o.pricePerPiece,processingType:o.processingType,sequenceOrder:t.operations.length+1,prerequisites:o.prerequisites||[],qualityCheckRequired:o.qualityCheckRequired||!1,defectTolerance:o.defectTolerance||5,isOptional:o.isOptional||!1,notes:o.notes?.trim()};s(x=>({...x,operations:[...x.operations,l]})),h({name:"",nameNepali:"",description:"",machineType:"",smvMinutes:0,pricePerPiece:0,processingType:"sequential",sequenceOrder:t.operations.length+2,prerequisites:[],qualityCheckRequired:!1,defectTolerance:5,isOptional:!1,notes:""}),m([])}},S=i=>{s(l=>({...l,operations:l.operations.filter(x=>x.id!==i)}))},d=i=>{i.preventDefault(),t.templateName&&t.templateCode&&t.category&&t.operations.length>0&&p({templateName:t.templateName,templateCode:t.templateCode,category:t.category,operations:t.operations,totalSmv:f,totalPricePerPiece:u,complexityLevel:j(),isActive:!0,notes:t.notes,setupInstructions:t.setupInstructions})};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:a?"Edit Sewing Template":"Create New Sewing Template"}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name *"}),e.jsx(w,{value:t.templateName,onChange:i=>s(l=>({...l,templateName:i.target.value})),placeholder:"Enter template name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Code *"}),e.jsx(w,{value:t.templateCode,onChange:i=>s(l=>({...l,templateCode:i.target.value})),placeholder:"e.g., TSHIRT_BASIC",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsx(w,{value:t.category,onChange:i=>s(l=>({...l,category:i.target.value})),placeholder:"e.g., T-Shirt, Polo",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,value:t.notes,onChange:i=>s(l=>({...l,notes:i.target.value})),placeholder:"Template notes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Setup Instructions"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,value:t.setupInstructions,onChange:i=>s(l=>({...l,setupInstructions:i.target.value})),placeholder:"Setup instructions"})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Template Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Operations:"}),e.jsx("span",{className:"font-medium ml-1",children:t.operations.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total SMV:"}),e.jsxs("span",{className:"font-medium ml-1",children:[f," min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Cost:"}),e.jsxs("span",{className:"font-medium ml-1",children:["Rs. ",u]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Complexity:"}),e.jsx("span",{className:"font-medium ml-1 capitalize",children:j()})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Operations"}),t.operations.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"space-y-3",children:t.operations.map((i,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["#",i.sequenceOrder]}),e.jsx("h4",{className:"font-medium text-gray-900",children:i.name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[i.smvMinutes," SMV"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Rs. ",i.pricePerPiece]}),e.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-800 rounded",children:i.machineType})]}),i.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 ml-8",children:i.description})]}),e.jsx(E,{type:"button",variant:"outline",size:"sm",onClick:()=>S(i.id),className:"text-red-600 hover:text-red-700",children:"Remove"})]},i.id))})}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Add New Operation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation Name *"}),e.jsx(w,{value:o.name||"",onChange:i=>{h(l=>({...l,name:i.target.value})),n.length>0&&m([])},placeholder:"e.g., Shoulder Join"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SMV (auto) *"}),e.jsx(w,{type:"number",min:"0.1",step:"0.1",value:o.smvMinutes||"",onChange:i=>{h(l=>({...l,smvMinutes:parseFloat(i.target.value)||0})),n.length>0&&m([])},placeholder:"Auto-calculated",title:"Auto-calculated from price Ã— 1.9, but editable"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (Rs.) *"}),e.jsx(w,{type:"number",min:"0.1",step:"0.1",value:o.pricePerPiece||"",onChange:i=>{const l=parseFloat(i.target.value)||0,x=l>0?parseFloat((l*1.9).toFixed(2)):0;h(N=>({...N,pricePerPiece:l,smvMinutes:x})),n.length>0&&m([])},placeholder:"2.5"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Machine Type *"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:o.machineType||"",onChange:i=>{h(l=>({...l,machineType:i.target.value})),n.length>0&&m([])},children:[e.jsx("option",{value:"",children:"Select Machine Type"}),e.jsx("option",{value:"overlock",children:"Overlock"}),e.jsx("option",{value:"flatlock",children:"Flatlock"}),e.jsx("option",{value:"singleNeedle",children:"Single Needle"}),e.jsx("option",{value:"doubleNeedle",children:"Double Needle"}),e.jsx("option",{value:"kansai",children:"Kansai"}),e.jsx("option",{value:"buttonhole",children:"Buttonhole"}),e.jsx("option",{value:"buttonAttach",children:"Button Attach"}),e.jsx("option",{value:"iron",children:"Iron/Press"}),e.jsx("option",{value:"cutting",children:"Cutting Machine"}),e.jsx("option",{value:"manual",children:"Manual Work"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Processing Type"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:o.processingType||"sequential",onChange:i=>h(l=>({...l,processingType:i.target.value})),children:[e.jsx("option",{value:"sequential",children:"Sequential"}),e.jsx("option",{value:"parallel",children:"Parallel"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.qualityCheckRequired||!1,onChange:i=>h(l=>({...l,qualityCheckRequired:i.target.checked})),className:"mr-2"}),"Quality Check Required"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.isOptional||!1,onChange:i=>h(l=>({...l,isOptional:i.target.checked})),className:"mr-2"}),"Optional"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Defect Tolerance (%)"}),e.jsx(w,{type:"number",min:"0",max:"100",value:o.defectTolerance||5,onChange:i=>h(l=>({...l,defectTolerance:parseInt(i.target.value)||5})),placeholder:"5"})]})]}),n.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 list-disc list-inside",children:n.map((i,l)=>e.jsx("li",{children:i},l))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:v,className:"w-full md:w-auto",children:"Add Operation"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SMV will auto-calculate from price (Price Ã— 1.9), but you can edit it manually"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsx(E,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:!t.templateName||!t.templateCode||!t.category||t.operations.length===0,children:a?"Update Template":"Create Template"})]})]})]})},ce=({template:a,onBack:p,onEdit:r})=>{const t=s=>s?s.seconds?new Date(s.seconds*1e3).toLocaleDateString():s instanceof Date?s.toLocaleDateString():new Date(s).toLocaleDateString():"N/A";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(E,{variant:"outline",onClick:p,className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.templateName}),e.jsx("p",{className:"text-sm text-gray-500",children:a.templateCode})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{variant:a.isActive?"success":"secondary",children:a.isActive?"Active":"Inactive"}),e.jsx(E,{onClick:r,children:"Edit Template"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(A,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Template Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx("p",{className:"text-sm text-gray-900",children:a.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Version"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["v",a.version]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complexity"}),e.jsx(I,{variant:"secondary",children:a.complexityLevel})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Times Used"}),e.jsx("p",{className:"text-sm text-gray-900",children:a.timesUsed||0})]})]}),a.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.notes})]}),a.setupInstructions&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Setup Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.setupInstructions})]})]}),e.jsxs(A,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Sewing Operations (",a.operations.length,")"]}),e.jsx("div",{className:"space-y-3",children:a.operations.map((s,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:["#",s.sequenceOrder]}),e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.nameNepali,")"]})]}),e.jsx(I,{variant:s.processingType==="parallel"?"success":"secondary",children:s.processingType})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Machine:"}),e.jsx("span",{className:"font-medium",children:s.machineType})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(X,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"SMV:"}),e.jsxs("span",{className:"font-medium",children:[s.smvMinutes,"min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsxs("span",{className:"font-medium",children:["Rs. ",s.pricePerPiece]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Quality:"}),e.jsx("span",{className:`font-medium ${s.qualityCheckRequired?"text-orange-600":"text-green-600"}`,children:s.qualityCheckRequired?"Required":"Optional"})]})]}),s.prerequisites&&s.prerequisites.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Prerequisites: "}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.prerequisites.map((m,o)=>e.jsx(I,{variant:"outline",size:"sm",children:m},o))})]}),s.notes&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-xs text-gray-500",children:s.notes})})]},s.id))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Operations:"}),e.jsx("span",{className:"font-semibold",children:a.operations.length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total SMV:"}),e.jsxs("span",{className:"font-semibold",children:[a.totalSmv," min"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Cost:"}),e.jsxs("span",{className:"font-semibold",children:["Rs. ",a.totalPricePerPiece]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Parallel Ops:"}),e.jsx("span",{className:"font-semibold",children:a.operations.filter(s=>s.processingType==="parallel").length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sequential Ops:"}),e.jsx("span",{className:"font-semibold",children:a.operations.filter(s=>s.processingType==="sequential").length})]})]})]}),e.jsxs(A,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Machine Types"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(a.operations.map(s=>s.machineType))).map((s,n)=>e.jsx(I,{variant:"outline",children:s},n))})]}),e.jsxs(A,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Metadata"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"ml-2",children:t(a.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Updated:"}),e.jsx("span",{className:"ml-2",children:t(a.updatedAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Created By:"}),e.jsx("span",{className:"ml-2",children:a.createdBy})]})]})]})]})]})]})},U={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://erp-for-tsa.web.app/api",VITE_APP_NAME:"TSA Production ERP",VITE_APP_VERSION:"1.0.0",VITE_AUTO_REFRESH_INTERVAL:"60000",VITE_BUILD_SOURCEMAP:"false",VITE_DEBUG_MODE:"false",VITE_ENABLE_ANALYTICS:"true",VITE_ENABLE_DEV_TOOLS:"false",VITE_ENABLE_ERROR_REPORTING:"true",VITE_ENABLE_MOCK_DATA:"false",VITE_ENABLE_OFFLINE_MODE:"true",VITE_ENABLE_PERFORMANCE_MONITORING:"true",VITE_ENABLE_PUSH_NOTIFICATIONS:"true",VITE_ENABLE_PWA:"true",VITE_ENVIRONMENT:"production",VITE_FIREBASE_API_KEY:"AIzaSyB8Z4GdoLZsBW6bfmAh_BSTftpTRUXPZMw",VITE_FIREBASE_APP_ID:"1:271232983905:web:7d06c8f5ec269824759b20",VITE_FIREBASE_AUTH_DOMAIN:"erp-for-tsa.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://erp-for-tsa-default-rtdb.firebaseio.com",VITE_FIREBASE_MEASUREMENT_ID:"G-6CYWPS4N0G",VITE_FIREBASE_MESSAGING_SENDER_ID:"271232983905",VITE_FIREBASE_PROJECT_ID:"erp-for-tsa",VITE_FIREBASE_STORAGE_BUCKET:"erp-for-tsa.firebasestorage.app",VITE_HOST:"0.0.0.0",VITE_LEGACY_SUPPORT:"true",VITE_LOG_LEVEL:"error",VITE_OPEN:"true",VITE_PORT:"3000",VITE_USER_NODE_ENV:"production",VITE_USE_FIREBASE_EMULATORS:"false"},O=new Map,P=a=>{const p=O.get(a);return p?Object.fromEntries(Object.entries(p.stores).map(([r,t])=>[r,t.getState()])):{}},oe=(a,p,r)=>{if(a===void 0)return{type:"untracked",connection:p.connect(r)};const t=O.get(r.name);if(t)return{type:"tracked",store:a,...t};const s={connection:p.connect(r),stores:{}};return O.set(r.name,s),{type:"tracked",store:a,...s}},de=(a,p)=>{if(p===void 0)return;const r=O.get(a);r&&(delete r.stores[p],Object.keys(r.stores).length===0&&O.delete(a))},me=a=>{var p,r;if(!a)return;const t=a.split(`
`),s=t.findIndex(m=>m.includes("api.setState"));if(s<0)return;const n=((p=t[s+1])==null?void 0:p.trim())||"";return(r=/.+ (.+) .+/.exec(n))==null?void 0:r[1]},ue=(a,p={})=>(r,t,s)=>{const{enabled:n,anonymousActionType:m,store:o,...h}=p;let f;try{f=(n??(U?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!f)return a(r,t,s);const{connection:u,...j}=oe(o,f,h);let y=!0;s.setState=((d,i,l)=>{const x=r(d,i);if(!y)return x;const N=l===void 0?{type:m||me(new Error().stack)||"anonymous"}:typeof l=="string"?{type:l}:l;return o===void 0?(u?.send(N,t()),x):(u?.send({...N,type:`${o}/${N.type}`},{...P(h.name),[o]:s.getState()}),x)}),s.devtools={cleanup:()=>{u&&typeof u.unsubscribe=="function"&&u.unsubscribe(),de(h.name,o)}};const v=(...d)=>{const i=y;y=!1,r(...d),y=i},S=a(s.setState,t,s);if(j.type==="untracked"?u?.init(S):(j.stores[j.store]=s,u?.init(Object.fromEntries(Object.entries(j.stores).map(([d,i])=>[d,d===j.store?S:i.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let d=!1;const i=s.dispatch;s.dispatch=(...l)=>{(U?"production":void 0)!=="production"&&l[0].type==="__setState"&&!d&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),d=!0),i(...l)}}return u.subscribe(d=>{var i;switch(d.type){case"ACTION":if(typeof d.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return M(d.payload,l=>{if(l.type==="__setState"){if(o===void 0){v(l.state);return}Object.keys(l.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const x=l.state[o];if(x==null)return;JSON.stringify(s.getState())!==JSON.stringify(x)&&v(x);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(l)});case"DISPATCH":switch(d.payload.type){case"RESET":return v(S),o===void 0?u?.init(s.getState()):u?.init(P(h.name));case"COMMIT":if(o===void 0){u?.init(s.getState());return}return u?.init(P(h.name));case"ROLLBACK":return M(d.state,l=>{if(o===void 0){v(l),u?.init(s.getState());return}v(l[o]),u?.init(P(h.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return M(d.state,l=>{if(o===void 0){v(l);return}JSON.stringify(s.getState())!==JSON.stringify(l[o])&&v(l[o])});case"IMPORT_STATE":{const{nextLiftedState:l}=d.payload,x=(i=l.computedStates.slice(-1)[0])==null?void 0:i.state;if(!x)return;v(o===void 0?x:x[o]),u?.send(null,l);return}case"PAUSE_RECORDING":return y=!y}return}}),S},xe=ue,M=(a,p)=>{let r;try{r=JSON.parse(a)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}r!==void 0&&p(r)};function he(a,p){let r;try{r=a()}catch{return}return{getItem:s=>{var n;const m=h=>h===null?null:JSON.parse(h,void 0),o=(n=r.getItem(s))!=null?n:null;return o instanceof Promise?o.then(m):m(o)},setItem:(s,n)=>r.setItem(s,JSON.stringify(n,void 0)),removeItem:s=>r.removeItem(s)}}const V=a=>p=>{try{const r=a(p);return r instanceof Promise?r:{then(t){return V(t)(r)},catch(t){return this}}}catch(r){return{then(t){return this},catch(t){return V(t)(r)}}}},pe=(a,p)=>(r,t,s)=>{let n={storage:he(()=>localStorage),partialize:d=>d,version:0,merge:(d,i)=>({...i,...d}),...p},m=!1;const o=new Set,h=new Set;let f=n.storage;if(!f)return a((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),r(...d)},t,s);const u=()=>{const d=n.partialize({...t()});return f.setItem(n.name,{state:d,version:n.version})},j=s.setState;s.setState=(d,i)=>(j(d,i),u());const y=a((...d)=>(r(...d),u()),t,s);s.getInitialState=()=>y;let v;const S=()=>{var d,i;if(!f)return;m=!1,o.forEach(x=>{var N;return x((N=t())!=null?N:y)});const l=((i=n.onRehydrateStorage)==null?void 0:i.call(n,(d=t())!=null?d:y))||void 0;return V(f.getItem.bind(f))(n.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==n.version){if(n.migrate){const N=n.migrate(x.state,x.version);return N instanceof Promise?N.then(k=>[!0,k]):[!0,N]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var N;const[k,L]=x;if(v=n.merge(L,(N=t())!=null?N:y),r(v,!0),k)return u()}).then(()=>{l?.(v,void 0),v=t(),m=!0,h.forEach(x=>x(v))}).catch(x=>{l?.(void 0,x)})};return s.persist={setOptions:d=>{n={...n,...d},d.storage&&(f=d.storage)},clearStorage:()=>{f?.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>S(),hasHydrated:()=>m,onHydrate:d=>(o.add(d),()=>{o.delete(d)}),onFinishHydration:d=>(h.add(d),()=>{h.delete(d)})},n.skipHydration||S(),v||y},fe=pe,ge=a=>(p,r,t)=>(t.setState=(s,n,...m)=>{const o=typeof s=="function"?ee(s):s;return p(o,n,...m)},a(t.setState,r,t)),ve=ge,B=1440*60*1e3,ye=720*60*60*1e3,je=W()(xe(fe(ve((a,p)=>({user:null,isAuthenticated:!1,isLoading:!1,error:null,sessionExpiry:null,login:async r=>{a(t=>{t.isLoading=!0,t.error=null});try{const{AuthService:t}=await _(async()=>{const{AuthService:n}=await import("./index.B__xpDQO.js").then(m=>m.M);return{AuthService:n}},__vite__mapDeps([0,1,2,3,4,5,6])),s=await t.login(r);if(s.success&&s.data){const{TokenService:n}=await _(async()=>{const{TokenService:f}=await import("./token-service.DZhubGLP.js");return{TokenService:f}},[]),{accessToken:m,refreshToken:o}=n.initializeTokens(s.data),h=r.rememberMe?ye:B;a(f=>{f.user=s.data,f.isAuthenticated=!0,f.isLoading=!1,f.sessionExpiry=Date.now()+h}),console.log("Login successful for:",s.data.name),console.log("JWT tokens initialized")}else a(n=>{n.isLoading=!1,n.error=s.error||"Login failed"})}catch(t){a(s=>{s.isLoading=!1,s.error=t instanceof Error?t.message:"Login failed"})}},logout:async()=>{a(r=>{r.isLoading=!0});try{const{AuthService:r}=await _(async()=>{const{AuthService:n}=await import("./index.B__xpDQO.js").then(m=>m.M);return{AuthService:n}},__vite__mapDeps([0,1,2,3,4,5,6])),t=await r.logout(p().user?.id),{TokenService:s}=await _(async()=>{const{TokenService:n}=await import("./token-service.DZhubGLP.js");return{TokenService:n}},[]);s.clearTokens(),t.success?(a(n=>{n.user=null,n.isAuthenticated=!1,n.isLoading=!1,n.error=null,n.sessionExpiry=null}),console.log("Logout successful - JWT tokens cleared")):a(n=>{n.isLoading=!1,n.error=t.error||"Logout failed"})}catch(r){a(t=>{t.isLoading=!1,t.error=r instanceof Error?r.message:"Logout failed"})}},refreshUser:async()=>{const{user:r}=p();if(r){a(t=>{t.isLoading=!0});try{const{AuthService:t}=await _(async()=>{const{AuthService:n}=await import("./index.B__xpDQO.js").then(m=>m.M);return{AuthService:n}},__vite__mapDeps([0,1,2,3,4,5,6])),s=await t.getUserById(r.id,r.role);s.success&&s.data?(a(n=>{n.user=s.data,n.isLoading=!1}),console.log("User data refreshed for:",s.data.name)):a(n=>{n.isLoading=!1,n.error=s.error||"Failed to refresh user"})}catch(t){a(s=>{s.isLoading=!1,s.error=t instanceof Error?t.message:"Failed to refresh user"})}}},clearError:()=>{a(r=>{r.error=null})},updateUserProfile:r=>{a(t=>{t.user&&Object.assign(t.user,r)})},checkSession:()=>{const{sessionExpiry:r,user:t}=p();if(!t||!r)return!1;const s=Date.now()<r;return s||p().logout(),s},extendSession:()=>{a(r=>{r.sessionExpiry&&(r.sessionExpiry=Date.now()+B)})},initializeFromTokens:async()=>{try{const{TokenService:r}=await _(async()=>{const{TokenService:n}=await import("./token-service.DZhubGLP.js");return{TokenService:n}},[]),t=r.getUserFromToken(),s=r.getSessionExpiry();if(t&&s&&s>Date.now())a(n=>{n.user=t,n.isAuthenticated=!0,n.sessionExpiry=s,n.isLoading=!1}),console.log("Session restored from tokens");else{if((await r.refreshAccessToken()).success){const o=r.getUserFromToken(),h=r.getSessionExpiry();if(o&&h){a(f=>{f.user=o,f.isAuthenticated=!0,f.sessionExpiry=h,f.isLoading=!1}),console.log("Session refreshed from refresh token");return}}const{TokenService:m}=await _(async()=>{const{TokenService:o}=await import("./token-service.DZhubGLP.js");return{TokenService:o}},[]);m.clearTokens(),a(o=>{o.user=null,o.isAuthenticated=!1,o.sessionExpiry=null,o.isLoading=!1})}}catch(r){console.error("Error initializing from tokens:",r);const{TokenService:t}=await _(async()=>{const{TokenService:s}=await import("./token-service.DZhubGLP.js");return{TokenService:s}},[]);t.clearTokens(),a(s=>{s.user=null,s.isAuthenticated=!1,s.sessionExpiry=null,s.isLoading=!1})}},autoRefreshToken:async()=>{const{TokenService:r}=await _(async()=>{const{TokenService:s}=await import("./token-service.DZhubGLP.js");return{TokenService:s}},[]);await r.autoRefreshToken()||p().logout()}})),{name:"tsa-auth-store",partialize:a=>({user:a.user,isAuthenticated:a.isAuthenticated,sessionExpiry:a.sessionExpiry})}),{name:"AuthStore"})),Oe=()=>{const[a,p]=T.useState([]),[r,t]=T.useState([]),[s,n]=T.useState(!0),[m,o]=T.useState(""),[h,f]=T.useState("all"),[u,j]=T.useState("list"),[y,v]=T.useState(null),[S,d]=T.useState(null),{user:i}=je();T.useEffect(()=>{l()},[]),T.useEffect(()=>{x()},[a,m,h]);const l=async()=>{try{n(!0);const c=await C.getActiveTemplates();c.success&&c.data?p(c.data):d(c.error||"Failed to load templates")}catch(c){d("Failed to load templates"),console.error("Error loading templates:",c)}finally{n(!1)}},x=()=>{let c=[...a];m&&(c=c.filter(g=>g.templateName.toLowerCase().includes(m.toLowerCase())||g.templateCode.toLowerCase().includes(m.toLowerCase())||g.category.toLowerCase().includes(m.toLowerCase()))),h!=="all"&&(c=c.filter(g=>g.category===h)),t(c)},N=()=>{v(null),j("create")},k=c=>{v(c),j("edit")},L=c=>{v(c),j("view")},G=async c=>{if(confirm(`Are you sure you want to delete template "${c.templateName}"?`))try{const g=await C.deleteTemplate(c.id);g.success?await l():d(g.error||"Failed to delete template")}catch(g){d("Failed to delete template"),console.error("Error deleting template:",g)}},z=async c=>{try{const g={templateName:`${c.templateName} (Copy)`,templateCode:`${c.templateCode}_COPY`,articleCode:c.articleCode,articleName:c.articleName,articleNameNepali:c.articleNameNepali,garmentType:c.garmentType,operations:c.operations.map(b=>({name:b.name,nameNepali:b.nameNepali,description:b.description,machineType:b.machineType,estimatedTimeMinutes:b.estimatedTimeMinutes,skillLevelRequired:b.skillLevelRequired,pricePerPiece:b.pricePerPiece,pricePerMinute:b.pricePerMinute,dependencies:[...b.dependencies],canRunParallel:b.canRunParallel,parallelGroup:b.parallelGroup,qualityCheckRequired:b.qualityCheckRequired,defectTolerance:b.defectTolerance,isOptional:b.isOptional,notes:b.notes})),complexityLevel:c.complexityLevel,notes:c.notes,setupInstructions:c.setupInstructions,qualityNotes:c.qualityNotes},R=await C.createTemplate(g,i?.id||"system");R.success?await l():d(R.error||"Failed to duplicate template")}catch(g){d("Failed to duplicate template"),console.error("Error duplicating template:",g)}},J=async c=>{try{const g=await C.exportTemplate(c.id);if(g.success&&g.data){const R=JSON.stringify(g.data,null,2),b=new Blob([R],{type:"application/json"}),F=URL.createObjectURL(b),D=document.createElement("a");D.href=F,D.download=`${c.templateCode}_template.json`,D.click(),URL.revokeObjectURL(F)}}catch(g){d("Failed to export template"),console.error("Error exporting template:",g)}},$=async c=>{try{const g=u==="edit"&&y?await C.updateTemplate(y.id,c,i?.id||"system"):await C.createTemplate(c,i?.id||"system");g.success?(j("list"),l()):d(g.error||"Failed to save template")}catch(g){d("Failed to save template"),console.error("Error saving template:",g)}},H=c=>{switch(c){case"simple":return"success";case"medium":return"warning";case"complex":return"danger";case"expert":return"destructive";default:return"secondary"}};return u==="create"||u==="edit"?e.jsx("div",{className:"p-6",children:e.jsx(le,{template:y,onSave:$,onCancel:()=>j("list")})}):u==="view"&&y?e.jsx("div",{className:"p-6",children:e.jsx(ce,{template:y,onEdit:()=>j("edit"),onClose:()=>j("list")})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Sewing Template Manager"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage sewing templates for different garment types"})]}),S&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"text-red-800",children:S}),e.jsx("button",{onClick:()=>d(null),className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"Dismiss"})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(w,{type:"text",placeholder:"Search templates...",value:m,onChange:c=>o(c.target.value),className:"pl-10"})]}),e.jsxs("select",{value:h,onChange:c=>f(c.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Garment Types"}),e.jsx("option",{value:"tshirt",children:"T-Shirt"}),e.jsx("option",{value:"polo",children:"Polo Shirt"}),e.jsx("option",{value:"dress",children:"Dress"}),e.jsx("option",{value:"pants",children:"Pants"}),e.jsx("option",{value:"shirt",children:"Shirt"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs(E,{onClick:N,className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Create Template"]})]}),s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:r.map(c=>e.jsxs(A,{className:"p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:c.templateName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Code: ",c.templateCode]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Article: ",c.articleCode," - ",c.articleName]})]}),e.jsx(I,{color:H(c.complexityLevel),children:c.complexityLevel})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Operations:"}),e.jsx("span",{className:"font-medium",children:c.operations.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Est. Time:"}),e.jsxs("span",{className:"font-medium",children:[c.totalEstimatedTime," min"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Est. Cost:"}),e.jsxs("span",{className:"font-medium",children:["Rs. ",c.totalEstimatedCost]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Times Used:"}),e.jsx("span",{className:"font-medium",children:c.timesUsed})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>L(c),className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),"View"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>k(c),className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),"Edit"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>z(c),className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),"Copy"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>J(c),className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),"Export"]}),e.jsxs(E,{variant:"outline",size:"sm",color:"danger",onClick:()=>G(c),className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),"Delete"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Version ",c.version]}),e.jsx("span",{className:`px-2 py-1 rounded-full ${c.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.isActive?"Active":"Inactive"})]})})]},c.id))}),!s&&r.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No templates found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m||h!=="all"?"Try adjusting your search or filter criteria.":"Create your first sewing template to get started."}),!m&&h==="all"&&e.jsxs(E,{onClick:N,className:"flex items-center gap-2 mx-auto",children:[e.jsx(q,{className:"w-4 h-4"}),"Create First Template"]})]}),!s&&r.length>0&&e.jsxs("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Template Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Templates"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.filter(c=>c.isActive).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active Templates"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.length>0?Math.round(r.reduce((c,g)=>c+(g.totalSmv||0),0)/r.length):0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg. SMV (min)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["Rs. ",r.length>0?Math.round(r.reduce((c,g)=>c+(g.totalPricePerPiece||0),0)/r.length):0]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg. Cost per Piece"})]})]})]})]})};export{Oe as SewingTemplateManager,Oe as default};
